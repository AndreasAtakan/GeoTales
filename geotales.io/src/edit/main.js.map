{"mappings":"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","sources":["edit/js/main.js","edit/js/helpers.js","edit/js/generate.js","edit/js/scenes.js","edit/js/textboxes.js","edit/js/map/map.js","edit/js/map/layers.js"],"sourcesContent":["/*******************************************************************************\n* Copyright (C) Nordfjord EDB AS - All Rights Reserved                         *\n*                                                                              *\n* Unauthorized copying of this file, via any medium is strictly prohibited     *\n* Proprietary and confidential                                                 *\n* Written by Andreas Atakan <aca@geotales.io>, January 2022                  *\n*******************************************************************************/\n\n\"use strict\";\n\nimport {\n\timport_data,\n\texport_data,\n\tsave_data,\n\tunsaved_changes,\n\tinit_basemaps\n} from \"./helpers.js\";\n\nimport { Scenes } from \"./scenes.js\";\nimport { Textboxes } from \"./textboxes.js\";\n\nimport \"./map/map.js\";\n\n\nwindow.onload = function(ev) {\n\n\t// Disable mobile pinch-zoom\n\tdocument.addEventListener(\"touchmove\", function(ev) {\n\t\tif(ev.scale !== 1) { ev.preventDefault(); }\n\t}, false);\n\n\t// Set up window resize start/end events\n\tlet resizeTimer = false;\n\t$(window).on(\"resize\", function(ev) {\n\t\tif( !resizeTimer ) { $(window).trigger(\"resizestart\"); }\n\t\tclearTimeout(resizeTimer);\n\t\tresizeTimer = setTimeout(function() {\n\t\t\tresizeTimer = false;\n\t\t\t$(window).trigger(\"resizeend\");\n\t\t}, 250);\n\t}).on(\"resizeend\", function() { _MAP.setAspectRatio(); });\n\n\n\n\t_SCENES = new Scenes();\n\n\t$(\"#sceneRow\").keydown(ev => { if([\"ArrowUp\", \"ArrowDown\", \"ArrowRight\", \"ArrowLeft\", \"Space\"].indexOf(ev.code) > -1) { ev.preventDefault(); } });\n\t$(\"#sceneRow\").keyup(ev => {\n\t\tlet keycode = ev.code;\n\t\tif(keycode == \"ArrowLeft\") { ev.preventDefault(); _SCENES.prev(); }\n\t\tif(keycode == \"ArrowRight\") { ev.preventDefault(); _SCENES.next(); }\n\t\tif([\"ArrowUp\", \"ArrowDown\", \"ArrowRight\", \"ArrowLeft\", \"Space\"].indexOf(keycode) > -1) { ev.preventDefault(); }\n\t});\n\n\t$(\"#sceneRow button#add\").click(ev => { _SCENES.add(); });\n\t$(\"#sceneRow button#recapture\").click(ev => { _SCENES.capture(); });\n\t$(\"#sceneWarningModal button#delete\").click(ev => { _SCENES.delete(); $(\"#sceneWarningModal\").modal(\"hide\"); });\n\n\n\t_TEXTBOXES = new Textboxes();\n\n\n\t_MAP = L.map(\"map\", {\n\t\tcenter: [ 49, 14 ],\n\t\tzoom: window.innerWidth < 575.98 ? 3 : 5,\n\t\tzoomControl: false,\n\t\tmaxZoom: 18,\n\t\tdoubleClickZoom: false,\n\t\tzoomAnimationThreshold: 100,\n\t\twheelPxPerZoomLevel: 1500,\n\t\tkeyboard: false,\n\t\ttap: false,\n\t\tboxZoom: false,\n\t\t//touchZoom: false,\n\t\t//worldCopyJump: true\n\n\t\tcontextmenu: true,\n\t\tcontextmenuItems: [\n\t\t\t{ text: \"Copy coordinates\", callback: ev => { navigator.clipboard.writeText( `${ev.latlng.lat}, ${ev.latlng.lng}` ); } },\n\t\t\t{ text: \"Center map here\", callback: ev => { _MAP.panTo(ev.latlng); } },\n\t\t\t\"-\",\n\t\t\t{ text: \"Zoom in\", icon: \"assets/zoom-in.png\", callback: ev => { _MAP.zoomIn(); } },\n\t\t\t{ text: \"Zoom out\", icon: \"assets/zoom-out.png\", callback: ev => { _MAP.zoomOut(); } }\n\t\t]\n\t});\n\n\tdocument.addEventListener(\"_setup\", ev => {\n\t\t_MAP.setup(); _TEXTBOXES.setup(); _SCENES.setup();\n\t});\n\tdocument.addEventListener(\"_reset\", ev => {\n\t\t_SCENES.reset(); _TEXTBOXES.reset(); _MAP.reset();\n\t});\n\n\n\n\t$(\"#optionsModal input#animationSpeed\").change(function(ev) { _OPTIONS.animationspeed = $(this).val() * 1000; });\n\t$(\"#optionsModal input#panningSpeed\").change(function(ev) { _OPTIONS.panningspeed = $(this).val() || null; });\n\t$(\"#optionsModal select#aspectRatio\").change(function(ev) { _MAP.setAspectRatio( eval( this.value ) ); });\n\t$(\"#optionsModal input#objectsOptIn\").change(function(ev) { _OPTIONS.objectOptIn = this.checked; });\n\n\n\n\tinit_basemaps();\n\n\t$(\"#basemapModal input#basemapFile\").change(ev => {\n\t\tlet file = $(ev.target)[0].files[0];\n\t\tif(!file) { return; }\n\n\t\t$(\"#loadingModal\").modal(\"show\");\n\n\t\tlet data = new FormData();\n\t\tdata.append(\"op\", \"create\");\n\t\tdata.append(\"type\", \"basemap\");\n\t\tdata.append(\"image\", file);\n\n\t\t$.ajax({\n\t\t\ttype: \"POST\",\n\t\t\turl: \"api/upload.php\",\n\t\t\tdata: data,\n\t\t\tcontentType: false,\n\t\t\tprocessData: false,\n\t\t\tsuccess: async function(result, status, xhr) {\n\t\t\t\tawait _MAP.setBasemap({ type: \"image\", img: result });\n\t\t\t\t_SCENES.setBasemap();\n\t\t\t\t_BASEMAPS.push({\n\t\t\t\t\tname: \"\",\n\t\t\t\t\ttiles: { type: \"image\", img: result },\n\t\t\t\t\tpreview: result\n\t\t\t\t});\n\t\t\t\tsetTimeout(function() { $(\"#loadingModal\").modal(\"hide\"); }, 750);\n\t\t\t},\n\t\t\terror: function(xhr, status, error) {\n\t\t\t\tconsole.error(xhr.status, error);\n\t\t\t\tsetTimeout(function() { $(\"#loadingModal\").modal(\"hide\"); $(\"#errorModal\").modal(\"show\"); }, 750);\n\t\t\t}\n\t\t});\n\t});\n\n\t$(\"#basemapModal button#basemapFetch\").click(ev => {\n\t\tlet url = $(\"#basemapModal input#basemapLink\").val();\n\t\tif(!url) { return; }\n\n\t\tlet protocol = url.split(/\\:/ig)[0];\n\t\tif(protocol == \"mapbox\") {\n\t\t\tlet username = url.split(/mapbox\\:\\/\\/styles\\//ig)[1].split(/\\//ig)[0], styleID = url.split(/mapbox\\:\\/\\/styles\\//ig)[1].split(/\\//ig)[1],\n\t\t\t\tkey = $(\"#basemapModal input#basemapKey\").val();\n\t\t\tif(!key) { return; }\n\n\t\t\turl = `https://api.mapbox.com/styles/v1/${username}/${styleID}/tiles/256/{z}/{x}/{y}?access_token=${key}`;\n\t\t}\n\n\t\t_MAP.setBasemap({ type: \"tiles\", url: url });\n\t\t_SCENES.setBasemap();\n\t});\n\n\t$(\"#basemapModal button#wmsAdd\").click(ev => {\n\t\tlet url = $(\"#basemapModal input#wmsLink\").val(),\n\t\t\tlayers = $(\"#basemapModal input#wmsLayer\").val(),\n\t\t\tformat = $(\"#basemapModal select#wmsFormat\").val(),\n\t\t\tversion = $(\"#basemapModal select#wmsVersion\").val();\n\t\tif(!url || !layers) { return; }\n\n\t\t_MAP.setWMS({\n\t\t\ttype: \"wms\",\n\t\t\turl: url,\n\t\t\tlayers: layers,\n\t\t\tformat: format,\n\t\t\tversion: version,\n\t\t\ttransparent: format == \"image/png\"\n\t\t});\n\t\t_SCENES.setWMS();\n\t});\n\t$(\"#basemapModal button#wmsRemove\").click(ev => {\n\t\t_MAP.setWMS(null);\n\t\t_SCENES.setWMS();\n\t});\n\n\n\n\t$(\"#projectFileInput\").change(ev => {\n\t\tlet file = $(ev.target)[0].files[0];\n\t\tif(!file) { return; }\n\n\t\tlet fr = new FileReader();\n\t\tfr.onload = function() { import_data( \"project\", JSON.parse( fr.result ) ); };\n\t\tfr.readAsText(file);\n\t});\n\t$(\"#geojsonImportModal button#import\").click(ev => {\n\t\t$(\"#geojsonImportModal\").modal(\"hide\");\n\n\t\tlet file = $(\"#geojsonImportModal input#fileInput\")[0].files[0];\n\t\tif(!file) { return; }\n\n\t\tlet options = {\n\t\t\tlineColor: $(\"#geojsonImportModal #lineColor\").val(),\n\t\t\tlineThickness: $(\"#geojsonImportModal #lineThickness\").val() || 3,\n\t\t\tlineTransparency: $(\"#geojsonImportModal #lineTransparency\").val(),\n\t\t\tfillColor: $(\"#geojsonImportModal #fillColor\").val(),\n\t\t\tfillTransparency: $(\"#geojsonImportModal #fillTransparency\").val() || 0.8\n\t\t};\n\n\t\tlet fr = new FileReader();\n\t\tfr.onload = function() { import_data( \"geojson\", JSON.parse( fr.result ), options ); };\n\t\tfr.readAsText(file);\n\t});\n\t$(\"#gedcomImportModal button#import\").click(ev => {\n\t\t$(\"#gedcomImportModal\").modal(\"hide\");\n\n\t\tlet file = $(\"#gedcomImportModal input#fileInput\")[0].files[0];\n\t\tif(!file) { return; }\n\n\t\tlet options = {};\n\n\t\tlet fr = new FileReader();\n\t\tfr.onload = function() { import_data( \"gedcom\", fr.result, options ); };\n\t\tfr.readAsText(file);\n\t});\n\n\n\t$(\"button#export\").click(ev => {\n\t\texport_data( $(ev.target).data(\"type\") || null );\n\t});\n\n\t$(\"a#save\").click(ev => {\n\t\t$(\"#loadingModal\").modal(\"show\");\n\t\tsave_data(function() { $(\"#loadingModal\").modal(\"hide\"); });\n\t});\n\tsetInterval(save_data, 5 * 60 * 1000);\n\n\n\t$(\"#loadingModal\").modal(\"show\");\n\t$.ajax({\n\t\ttype: \"GET\",\n\t\turl: \"api/map.php\",\n\t\tdata: {\n\t\t\t\"op\": \"read\",\n\t\t\t\"id\": _ID,\n\t\t\t\"password\": \"\"\n\t\t},\n\t\tdataType: \"json\",\n\t\tsuccess: function(result, status, xhr) {\n\t\t\tif(result.data) { import_data( \"project\", JSON.parse(result.data) ); }\n\t\t\t$(`div#sceneRow,\n\t\t\t   div#mapRow,\n\t\t\t   .navbar .navbarContent li`).click(ev => { unsaved_changes(); });\n\n\t\t\tsetTimeout(function() { $(\"#loadingModal\").modal(\"hide\"); }, 750);\n\t\t},\n\t\terror: function(xhr, status, error) {\n\t\t\tconsole.error(xhr.status, error);\n\t\t\tsetTimeout(function() { $(\"#loadingModal\").modal(\"hide\"); $(\"#errorModal\").modal(\"show\"); }, 750);\n\t\t}\n\t});\n\n\t$.ajax({\n\t\ttype: \"GET\",\n\t\turl: \"api/upload.php\",\n\t\tdata: { \"op\": \"get\" },\n\t\tdataType: \"json\",\n\t\tsuccess: function(result, status, xhr) {\n\t\t\tfor(let r of result) {\n\t\t\t\tif(r.type == \"icon\") { _ICONS.unshift(r.ref); }\n\t\t\t\telse\n\t\t\t\tif(r.type == \"basemap\") {\n\t\t\t\t\t_BASEMAPS.push({\n\t\t\t\t\t\tname: \"\",\n\t\t\t\t\t\ttiles: { type: \"image\", img: r.ref },\n\t\t\t\t\t\tpreview: r.ref\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\terror: function(xhr, status, error) {\n\t\t\tconsole.error(xhr.status, error);\n\t\t}\n\t});\n\n};\n","/*******************************************************************************\n* Copyright (C) Nordfjord EDB AS - All Rights Reserved                         *\n*                                                                              *\n* Unauthorized copying of this file, via any medium is strictly prohibited     *\n* Proprietary and confidential                                                 *\n* Written by Andreas Atakan <aca@geotales.io>, January 2022                  *\n*******************************************************************************/\n\n\"use strict\";\n\nimport { generate_basemaps } from \"./generate.js\";\n\n\nexport function uuid(a) {\n\treturn a ? (a^Math.random()*16>>a/4).toString(16) : ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, uuid);\n}\n\n\n\nfunction import_project(data) {\n\t_OPTIONS = data.options;\n\t$(\"#optionsModal input#animationSpeed\").val(_OPTIONS.animationspeed / 1000);\n\t$(\"#optionsModal input#panningSpeed\").val(_OPTIONS.panningspeed || null);\n\t$(\"#optionsModal input#objectsOptIn\").prop(\"checked\", _OPTIONS.objectOptIn);\n\n\tif(data.scenes.length <= 0) { return; }\n\n\tif(_SCENES.store.length <= 0) { document.dispatchEvent( new Event(\"_setup\") ); }\n\n\t_SCENES.importData(data.scenes);\n\t_TEXTBOXES.importData(data.textboxes);\n\t_MAP.importData(data.objects);\n\n\t_SCENES.current();\n}\nfunction import_geojson(data, options) {\n\tfor(let f of data.features) {\n\t\tlet o;\n\t\tlet t = a => {\n\t\t\tif(Array.isArray(a[0])) { for(let v of a) { t(v); } }\n\t\t\telse{ a.reverse(); }\n\t\t};\n\t\tlet pos = f.geometry.coordinates; t(pos);\n\n\t\tif(f.properties.type == \"avatar\") {\n\t\t\to = {\n\t\t\t\tid:\t\t\t\t\tuuid(),\n\t\t\t\tsceneId:\t\t\t_SCENES.active,\n\t\t\t\ttype:\t\t\t\t\"avatar\",\n\t\t\t\tpos:\t\t\t\tpos,\n\t\t\t\tlabel:\t\t\t\tf.properties.label,\n\t\t\t\ticon:\t\t\t\tf.properties.icon,\n\t\t\t\tratio:\t\t\t\tf.properties.ratio,\n\t\t\t\trounded:\t\t\tf.properties.rounded,\n\t\t\t\tangle:\t\t\t\tf.properties.angle,\n\t\t\t\tborderColor:\t\tf.properties.borderColor,\n\t\t\t\tborderThickness:\tf.properties.borderThickness,\n\t\t\t\tblur:\t\t\t\tf.properties.overlayBlur,\n\t\t\t\tgrayscale:\t\t\tf.properties.overlayGrayscale,\n\t\t\t\tbrightness:\t\t\tf.properties.overlayBrightness,\n\t\t\t\ttransparency:\t\tf.properties.overlayTransparency\n\t\t\t};\n\t\t}else\n\t\tif(f.properties.type == \"polyline\"\n\t\t|| f.geometry.type == \"LineString\"\n\t\t|| f.geometry.type == \"MultiLineString\") {\n\t\t\to = {\n\t\t\t\tid:\t\t\t\tuuid(),\n\t\t\t\tsceneId:\t\t_SCENES.active,\n\t\t\t\ttype:\t\t\t\"polyline\",\n\t\t\t\tpos:\t\t\tpos,\n\t\t\t\tlabel:\t\t\tf.properties.label,\n\t\t\t\tdashed:\t\t\tf.properties.dashed,\n\t\t\t\tcolor:\t\t\tf.properties.color || options.lineColor,\n\t\t\t\tthickness:\t\tf.properties.thickness || options.lineThickness,\n\t\t\t\ttransparency:\tf.properties.transparency || options.lineTransparency\n\t\t\t};\n\t\t}else\n\t\tif(f.properties.type == \"polygon\"\n\t\t|| f.properties.type == \"rectangle\"\n\t\t|| f.geometry.type == \"Polygon\"\n\t\t|| f.geometry.type == \"MultiPolygon\") {\n\t\t\to = {\n\t\t\t\tid:\t\t\t\t\tuuid(),\n\t\t\t\tsceneId:\t\t\t_SCENES.active,\n\t\t\t\ttype:\t\t\t\t\"polygon\",\n\t\t\t\tpos:\t\t\t\tpos,\n\t\t\t\tlabel:\t\t\t\tf.properties.label,\n\t\t\t\tdashed:\t\t\t\tf.properties.dashed,\n\t\t\t\tlineColor:\t\t\tf.properties.lineColor || options.lineColor,\n\t\t\t\tlineThickness:\t\tf.properties.lineThickness || options.lineThickness,\n\t\t\t\tlineTransparency:\tf.properties.lineTransparency || options.lineTransparency,\n\t\t\t\tfillColor:\t\t\tf.properties.fillColor || options.fillColor,\n\t\t\t\tfillTransparency:\tf.properties.fillTransparency || options.fillTransparency\n\t\t\t};\n\t\t}else\n\t\tif(f.properties.type == \"circle\"\n\t\t|| f.geometry.type == \"Point\") {\n\t\t\to = {\n\t\t\t\tid:\t\t\t\t\tuuid(),\n\t\t\t\tsceneId:\t\t\t_SCENES.active,\n\t\t\t\ttype:\t\t\t\t\"circle\",\n\t\t\t\tpos:\t\t\t\tpos,\n\t\t\t\tradius:\t\t\t\tf.properties.radius || 4000 * (_MAP.getMaxZoom() - _MAP.getZoom()),\n\t\t\t\tlabel:\t\t\t\tf.properties.label,\n\t\t\t\tdashed:\t\t\t\tf.properties.dashed,\n\t\t\t\tlineColor:\t\t\tf.properties.lineColor || options.lineColor,\n\t\t\t\tlineThickness:\t\tf.properties.lineThickness || options.lineThickness,\n\t\t\t\tlineTransparency:\tf.properties.lineTransparency || options.lineTransparency,\n\t\t\t\tfillColor:\t\t\tf.properties.fillColor || options.fillColor,\n\t\t\t\tfillTransparency:\tf.properties.fillTransparency || options.fillTransparency\n\t\t\t};\n\t\t}\n\t\telse{ continue; }\n\n\t\tlet object = _MAP.createObject(o);\n\t\t_MAP.addLayer( object );\n\t\t_MAP.fire(\"_addedlayer\", { layer: object });\n\t\t_MAP.objects.push( _MAP.extractObject(object) );\n\t}\n}\nfunction import_gedcom(data, options) {\n\t//\n}\nexport function import_data(type, data, options) {\n\tswitch(type) {\n\t\tcase \"project\": import_project(data); break;\n\t\tcase \"geojson\": import_geojson(data, options); break;\n\t\tcase \"gedcom\": import_gedcom(data, options); break;\n\t\tdefault: console.error(\"data-import type invalid\"); break;\n\t}\n}\n\n\nfunction export_project() {\n\treturn JSON.stringify({\n\t\toptions: _OPTIONS,\n\t\tscenes: _SCENES.exportData(),\n\t\ttextboxes: _TEXTBOXES.exportData(),\n\t\tobjects: _MAP.exportData()\n\t});\n}\nfunction export_geojson() {\n\tlet r = [];\n\tfor(let o of _MAP.getLayers()) { r.push( o.__toGeoJSON() ); }\n\treturn JSON.stringify({\n\t\t\"type\": \"FeatureCollection\",\n\t\t\"features\": r\n\t});\n}\nlet running = false;\nexport function export_data(type) {\n\tif(running) { return; } running = true;\n\n\tlet el = document.createElement(\"a\");\n\n\tlet f = v => v < 10 && v >= 0 ? `0${v}` : `${v}`;\n\tlet date = new Date();\n\tlet y = date.getFullYear(), m = f(date.getMonth() + 1), d = f(date.getDate()), H = f(date.getHours()), M = f(date.getMinutes()), S = f(date.getSeconds());\n\tlet filename = `${_TITLE} - ${y}.${m}.${d} - ${H}.${M}.${S}`;\n\n\tlet data;\n\tswitch(type) {\n\t\tcase \"project\":\n\t\t\tfilename += \".geotales\";\n\t\t\tdata = \"data:application/json;charset=utf-8,\" + encodeURIComponent( export_project() );\n\t\t\tbreak;\n\n\t\tcase \"geojson\":\n\t\t\tfilename += \".geojson\";\n\t\t\tdata = \"data:application/geo+json;charset=utf-8,\" + encodeURIComponent( export_geojson() );\n\t\t\tbreak;\n\n\t\tdefault: return;\n\t}\n\n\tel.setAttribute(\"href\", data);\n\tel.setAttribute(\"download\", filename);\n\tel.style.display = \"none\";\n\n\tdocument.body.appendChild(el);\n\t$(el).ready(() => { el.click(); document.body.removeChild(el); running = false; });\n}\n\nexport function save_data(callback) {\n\t$.ajax({\n\t\ttype: \"POST\",\n\t\turl: \"api/map.php\",\n\t\tdata: {\n\t\t\t\"op\": \"write\",\n\t\t\t\"id\": _ID,\n\t\t\t\"data\": export_project(),\n\t\t\t\"preview\": _MAP.getCenterBasemapTile()\n\t\t},\n\t\tdataType: \"json\",\n\t\tsuccess: function(result, status, xhr) {\n\t\t\tsaved_changes();\n\t\t\tsetTimeout(function() { if(callback) { callback(); } }, 750);\n\t\t},\n\t\terror: function(xhr, status, error) {\n\t\t\tconsole.error(xhr.status, error);\n\t\t\tsetTimeout(function() { $(\"#loadingModal\").modal(\"hide\"); $(\"#errorModal\").modal(\"show\"); }, 750);\n\t\t}\n\t});\n}\n\n\n\nexport function unsaved_changes() {\n\t$(window).off(\"beforeunload\");\n\t$(window).on(\"beforeunload\", ev => {\n\t\tev.preventDefault();\n\n\t\tlet m = \"Unsaved changes could be lost. Are you sure you want to close?\";\n\t\tev.returnValue = m;\n\t\treturn m;\n\t});\n}\n\nexport function saved_changes() {\n\t$(window).off(\"beforeunload\");\n}\n\n\n\nexport function flash_map() {\n\t$(\"div#map\").addClass(\"snapshot\");\n\tsetTimeout(function() { $(\"div#map\").removeClass(\"snapshot\"); }, 240);\n}\n\n\n\nexport function get_basemap(url) {\n\tfor(let b of _BASEMAPS) {\n\t\tif(b.tiles._url == url) { return b; }\n\t}\n\treturn null;\n}\n\nfunction bind_basemaps() {\n\t$(\"#basemapModal #basemaps\").off(\"click\");\n\t$(\"#basemapModal #basemaps\").click(async function(ev) {\n\t\tlet index = $(ev.target).data(\"basemap\");\n\t\tif(!index && index !== 0) { return; }\n\n\t\tawait _MAP.setBasemap( _BASEMAPS[index].tiles );\n\t\t_SCENES.setBasemap();\n\t});\n\n\t$(\"#basemapModal button#uploadBasemap\").click(function(ev) {\n\t\t$(\"#basemapModal input#basemapFile\").click();\n\t});\n}\nexport function init_basemaps() {\n\tgenerate_basemaps(false); bind_basemaps();\n}\nexport function init_img_basemaps() {\n\tgenerate_basemaps(true); bind_basemaps();\n}\n\n\n\nexport function get_aspect_ratio_dimentions(w, h, r) {\n\tlet _w = r * h;\n\tif(_w <= w) {\n\t\treturn [_w, h];\n\t}else{\n\t\treturn [w, w / r];\n\t}\n}\n","/*******************************************************************************\n* Copyright (C) Nordfjord EDB AS - All Rights Reserved                         *\n*                                                                              *\n* Unauthorized copying of this file, via any medium is strictly prohibited     *\n* Proprietary and confidential                                                 *\n* Written by Andreas Atakan <aca@geotales.io>, January 2022                  *\n*******************************************************************************/\n\n\"use strict\";\n\n\nexport function new_scene(id, prevId) {\n\n\tlet cont = `\n\t\t<li class=\"list-group-item p-1 my-1\" id=\"${id}\" data-id=\"${id}\">\n\t\t\t<div class=\"input-group input-group-sm\">\n\t\t\t\t<button type=\"button\" class=\"btn btn-outline-light\" id=\"reorder\" title=\"Change ordering\">\n\t\t\t\t\t<i class=\"fas fa-bars\"></i>\n\t\t\t\t</button>\n\t\t\t\t<input type=\"text\" class=\"form-control\" id=\"title\" aria-label=\"Title\" aria-describedby=\"num\" />\n\t\t\t\t<span class=\"input-group-text\" id=\"num\"></span>\n\t\t\t</div>\n\t\t</li>\n\t`;\n\n\tif(prevId) { $(`li[data-id=\"${prevId}\"]`).after(cont); }\n\telse{ $(\"ul#scenes\").append(cont); }\n\n}\n\n\n\nexport function generate_basemaps(isUpload) {\n\tlet html = ``;\n\n\tfor(let i = 0; i < _BASEMAPS.length; i++) {\n\t\tlet b = _BASEMAPS[i];\n\t\tif(b.name !== \"\" && isUpload) { continue; }\n\t\thtml += `\n\t\t\t<div class=\"col\">\n\t\t\t\t<div class=\"card mt-2\">\n\t\t\t\t\t<div class=\"card-body\">\n\t\t\t\t\t\t<h6 class=\"card-title mb-0\">${b.name}</h6>\n\t\t\t\t\t</div>\n\t\t\t\t\t<img class=\"card-img-bottom\" id=\"basemaps\" src=\"${b.preview}\" alt=\"${b.name}\" data-basemap=\"${i}\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\tif(isUpload) {\n\t\thtml += `\n\t\t\t<div class=\"col\">\n\t\t\t\t<div class=\"card mt-2\">\n\t\t\t\t\t<div class=\"card-body\">\n\t\t\t\t\t\t<div class=\"d-grid\">\n\t\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-outline-secondary\" id=\"uploadBasemap\">+</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t$(isUpload ?\n\t\t\"#basemapModal #imgBasemapChoose\" :\n\t\t\"#basemapModal #basemapChoose\").html(html);\n}\n\n\n\nexport function avatar_popup() {\n\n\treturn `\n\t\t<form class=\"container-fluid objectPopup\" id=\"avatarPopup\">\n\t\t\t<div class=\"row\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<input type=\"text\" class=\"form-control form-control-sm\" id=\"label\" aria-label=\"label\" placeholder=\"Label\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"row my-3\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<div class=\"input-group input-group-sm\">\n\t\t\t\t\t\t<div class=\"input-group-text\">\n\t\t\t\t\t\t\t<input type=\"checkbox\" class=\"form-check-input mt-0\" id=\"rounded\" value=\"\" aria-label=\"Rounded\" title=\"Rounded\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<input type=\"number\" min=\"10\" max=\"500\" step=\"1\" class=\"form-control\" id=\"size\" placeholder=\"Size\" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"row my-3\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<div class=\"accordion\" id=\"iconAccordion\">\n\t\t\t\t\t\t<div class=\"accordion-item\">\n\t\t\t\t\t\t\t<h2 class=\"accordion-header\" id=\"iconAccordionHeading\">\n\t\t\t\t\t\t\t\t<button class=\"accordion-button collapsed py-1 px-2\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#iconAccordionCollapse\" aria-expanded=\"false\" aria-controls=\"iconAccordionCollapse\">\n\t\t\t\t\t\t\t\t\tIcon\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</h2>\n\t\t\t\t\t\t\t<div id=\"iconAccordionCollapse\" class=\"accordion-collapse collapse\" aria-labelledby=\"iconAccordionHeading\" data-bs-parent=\"#iconAccordion\">\n\t\t\t\t\t\t\t\t<div class=\"accordion-body py-1\" style=\"max-height: 80px; overflow-y: auto;\">\n\t\t\t\t\t\t\t\t\t<div class=\"row row-cols-5\" id=\"iconChoose\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"col\">\n\t\t\t\t\t\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-sm btn-outline-secondary\" id=\"iconAdd\" title=\"Add icon\">+</button>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t  </div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"row my-3\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<div class=\"input-group input-group-sm\">\n\t\t\t\t\t\t<input type=\"color\" class=\"form-control form-control-color\" id=\"color\" value=\"#563d7c\" title=\"Choose color\" />\n\t\t\t\t\t\t<input type=\"number\" min=\"0\" max=\"10\" class=\"form-control\" id=\"thickness\" placeholder=\"Thickness\" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"row my-3\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<div class=\"input-group input-group-sm\">\n\t\t\t\t\t\t<input type=\"number\" min=\"0\" max=\"3\" step=\"0.1\" class=\"form-control\" id=\"blur\" placeholder=\"Blur\" />\n\t\t\t\t\t\t<input type=\"number\" min=\"0\" max=\"1\" step=\"0.1\" class=\"form-control\" id=\"grayscale\" placeholder=\"Grayscale\" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"input-group input-group-sm\">\n\t\t\t\t\t\t<input type=\"number\" min=\"0\" max=\"6\" step=\"1\" class=\"form-control\" id=\"brightness\" placeholder=\"Brightness\" />\n\t\t\t\t\t\t<input type=\"number\" min=\"0\" max=\"0.9\" step=\"0.1\" class=\"form-control\" id=\"transparency\" placeholder=\"Transparency\" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"row mb-2\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<input type=\"number\" class=\"form-control form-control-sm\" id=\"animationSpeed\" min=\"0.1\" max=\"10\" step=\"0.1\" aria-label=\"Animation speed\" placeholder=\"Animation speed (sec.)\" title=\"This objects animation speed to next scene\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"row\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<button type=\"button\" class=\"btn btn-sm btn-outline-secondary py-0\" id=\"makeGlobal\" title=\"Save options globally\">\n\t\t\t\t\t\t<i class=\"fas fa-save\"></i> <strong>*</strong>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</form>\n\t`;\n\n}\n\nexport function polyline_popup() {\n\n\treturn `\n\t\t<form class=\"container-fluid objectPopup\" id=\"shapePopup\">\n\t\t\t<div class=\"row\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<input type=\"text\" class=\"form-control form-control-sm\" id=\"label\" aria-label=\"label\" placeholder=\"Label\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"row my-3\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<div class=\"input-group input-group-sm\">\n\t\t\t\t\t\t<input type=\"color\" class=\"form-control form-control-color\" id=\"lineColor\" value=\"#563d7c\" title=\"Choose color\" />\n\t\t\t\t\t\t<input type=\"number\" min=\"2\" max=\"10\" class=\"form-control\" id=\"lineThickness\" placeholder=\"Thickness\" />\n\t\t\t\t\t\t<input type=\"number\" min=\"0\" max=\"0.9\" step=\"0.1\" class=\"form-control\" id=\"lineTransparency\" placeholder=\"Transparency\" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"form-check mt-1\">\n\t\t\t\t\t\t<input class=\"form-check-input\" type=\"checkbox\" value=\"\" id=\"dashed\">\n\t\t\t\t\t\t<label class=\"form-check-label\" for=\"dashed\">Dashed</label>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"row mb-2\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<input type=\"number\" class=\"form-control form-control-sm\" id=\"animationSpeed\" min=\"0.1\" max=\"10\" step=\"0.1\" aria-label=\"Animation speed\" placeholder=\"Animation speed (sec.)\" title=\"This objects animation speed to next scene\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"row\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<button type=\"button\" class=\"btn btn-sm btn-outline-secondary py-0\" id=\"makeGlobal\" title=\"Save options globally\">\n\t\t\t\t\t\t<i class=\"fas fa-save\"></i> <strong>*</strong>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</form>\n\t`;\n\n}\n\nexport function polygon_popup() {\n\n\treturn `\n\t\t<form class=\"container-fluid objectPopup\" id=\"shapePopup\">\n\t\t\t<div class=\"row\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<input type=\"text\" class=\"form-control form-control-sm\" id=\"label\" aria-label=\"label\" placeholder=\"Label\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"row my-3\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<div class=\"input-group input-group-sm\">\n\t\t\t\t\t\t<input type=\"color\" class=\"form-control form-control-color\" id=\"lineColor\" value=\"#563d7c\" title=\"Choose color\" />\n\t\t\t\t\t\t<input type=\"number\" min=\"2\" max=\"10\" class=\"form-control\" id=\"lineThickness\" placeholder=\"Thickness\" />\n\t\t\t\t\t\t<input type=\"number\" min=\"0\" max=\"0.9\" step=\"0.1\" class=\"form-control\" id=\"lineTransparency\" placeholder=\"Transparency\" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"form-check mt-1\">\n\t\t\t\t\t\t<input class=\"form-check-input\" type=\"checkbox\" value=\"\" id=\"dashed\">\n\t\t\t\t\t\t<label class=\"form-check-label\" for=\"dashed\">Dashed</label>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"row my-3\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<div class=\"input-group input-group-sm\">\n\t\t\t\t\t\t<input type=\"color\" class=\"form-control form-control-color\" id=\"fillColor\" value=\"#563d7c\" title=\"Choose color\" />\n\t\t\t\t\t\t<input type=\"number\" min=\"0\" max=\"1\" step=\"0.1\" class=\"form-control\" id=\"fillTransparency\" placeholder=\"Transparency\" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"row mb-2\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<input type=\"number\" class=\"form-control form-control-sm\" id=\"animationSpeed\" min=\"0.1\" max=\"10\" step=\"0.1\" aria-label=\"Animation speed\" placeholder=\"Animation speed (sec.)\" title=\"This objects animation speed to next scene\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"row\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<button type=\"button\" class=\"btn btn-sm btn-outline-secondary py-0\" id=\"makeGlobal\" title=\"Save options globally\">\n\t\t\t\t\t\t<i class=\"fas fa-save\"></i> <strong>*</strong>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</form>\n\t`;\n\n}\n","/*******************************************************************************\n* Copyright (C) Nordfjord EDB AS - All Rights Reserved                         *\n*                                                                              *\n* Unauthorized copying of this file, via any medium is strictly prohibited     *\n* Proprietary and confidential                                                 *\n* Written by Andreas Atakan <aca@geotales.io>, January 2022                  *\n*******************************************************************************/\n\n\"use strict\";\n\nimport { uuid, save_data, flash_map } from \"./helpers.js\";\nimport { new_scene } from \"./generate.js\";\n\n\nexport function Scenes() {\n\tthis.store = [];\n\tthis.active = \"\";\n\tthis.copiedBounds = null;\n\n\n\tthis.setup = function() {\n\t\t$(\"#scenes\").sortable({ // https://api.jqueryui.com/sortable/\n\t\t\tcursor: \"move\", handle: \"button#reorder\", items: \"> li\", containment: \"parent\", tolerance: \"pointer\", cancel: \"\", zIndex: 1003, axis: \"x\", //scroll: false,\n\t\t\tstart: (ev, ui) => {\n\t\t\t\tev.stopPropagation();\n\t\t\t\tthis.unbind();\n\t\t\t},\n\t\t\tupdate: (ev, ui) => {\n\t\t\t\tev.stopPropagation();\n\t\t\t\t//let id = $(ui.item[0]).data(\"id\"), order = $(\"#scenes\").sortable(\"toArray\");\n\t\t\t\tthis.reorder( $(\"#scenes\").sortable(\"toArray\") );\n\t\t\t},\n\t\t\tstop: (ev, ui) => {\n\t\t\t\tev.stopPropagation();\n\t\t\t\tthis.bind();\n\t\t\t}\n\t\t});\n\n\t\t$(\"#sceneRow button#delete, #sceneRow button#recapture\").prop(\"disabled\", false);\n\t};\n\n\tthis.reset = function() {\n\t\t$(\"#scenes\").sortable(\"destroy\");\n\t\t$(\"#sceneRow button#delete, #sceneRow button#recapture\").prop(\"disabled\", true);\n\t};\n\n\tthis.get = function(id) {\n\t\tfor(let i = 0; i < this.store.length; i++) {\n\t\t\tlet s = Object.assign({}, this.store[i]);\n\t\t\tif(s.id == id) { s.index = i; return s; }\n\t\t}\n\t\treturn null;\n\t};\n\n\tthis.getEl = function(el) {\n\t\tfor(let i = 0; i < this.store.length; i++) {\n\t\t\tlet s = Object.assign({}, this.store[i]);\n\t\t\tif( $(`li[data-id=\"${s.id}\"]`)[0].contains(el) ) { s.index = i; return s; }\n\t\t}\n\t\treturn null;\n\t};\n\n\tthis.getPrevScene = function(id) {\n\t\tlet s = this.get(id);\n\t\tif(!s || s.index <= 0) { return; }\n\n\t\treturn Object.assign({}, this.store[ s.index - 1 ]);\n\t};\n\n\tthis.reorder = function(order) {\n\t\tthis.store.sort((a,b) => order.indexOf(a.id) - order.indexOf(b.id));\n\t\tthis.set(this.active);\n\t};\n\n\tthis.add = function() {\n\t\tif(this.store.length <= 0) {\n\t\t\tdocument.dispatchEvent( new Event(\"_setup\") );\n\t\t}\n\n\t\tlet s = new Scene(null, this.active);\n\t\ts.capture();\n\n\t\tif(this.active) { this.store.splice(this.get(this.active).index + 1, 0, s); }\n\t\telse{ this.store.push(s); }\n\n\t\t_TEXTBOXES.addScene(s.id);\n\t\t_MAP.addScene(s.id);\n\n\t\tthis.set(s.id);\n\t\tthis.bind();\n\n\t\tsave_data();\n\t};\n\n\tthis.capture = function() {\n\t\tif(!this.active) { return; }\n\n\t\tlet s = this.store[ this.get(this.active).index ];\n\t\ts.capture();\n\t\tflash_map();\n\t\tsave_data();\n\t};\n\n\tthis.delete = function() {\n\t\tif(!this.active) { return; }\n\n\t\tlet s = this.get( this.active );\n\n\t\t_TEXTBOXES.deleteScene(s.id);\n\t\t_MAP.deleteScene(s.id);\n\n\t\tif( !this.prev() ) { this.next(); }\n\n\t\tthis.store.splice(s.index, 1);\n\n\t\t$(`li[data-id=\"${s.id}\"]`).remove();\n\n\t\tthis.setNumbering();\n\n\t\tif(this.store.length <= 0) {\n\t\t\tthis.active = \"\";\n\t\t\tdocument.dispatchEvent( new Event(\"_reset\") );\n\t\t}\n\n\t\tsave_data();\n\t};\n\n\tthis.unbind = function() {\n\t\t$(\"#scenes li button#reorder\").prop(\"disabled\", true);\n\t\t$(\"#scenes li\").off(\"click\");\n\t};\n\tthis.bind = function() {\n\t\t$(\"#scenes li button#reorder\").prop(\"disabled\", false);\n\t\t$(\"#scenes li\").off(\"click\");\n\t\t$(\"#scenes li\").click(ev => {\n\t\t\tlet s = this.getEl(ev.target);\n\t\t\tif(!s) { return; }\n\n\t\t\tlet el = $(`li[data-id=\"${s.id}\"]`);\n\t\t\tif(el.hasClass(\"active\")) { return; }\n\n\t\t\tthis.set(s.id);\n\t\t});\n\t};\n\n\tthis.prev = function() {\n\t\tlet s = this.get(this.active);\n\t\tif(!s || s.index <= 0) { return; }\n\n\t\ts = this.store[ s.index - 1 ];\n\t\tthis.set(s.id);\n\t\treturn Object.assign({}, s);\n\t};\n\n\tthis.current = function() {\n\t\tthis.set(this.active);\n\t\tthis.bind();\n\t};\n\n\tthis.next = function() {\n\t\tlet s = this.get(this.active);\n\t\tif(!s || s.index >= this.store.length - 1) { return; }\n\n\t\ts = this.store[ s.index + 1 ];\n\t\tthis.set(s.id);\n\t\treturn Object.assign({}, s);\n\t};\n\n\tthis.set = function(id) {\n\t\tif(this.active) { this.get(this.active).disable(); }\n\t\tthis.active = id;\n\n\t\tlet s = this.get(id);\n\t\ts.enable();\n\n\t\t$(`li[data-id=\"${s.id}\"]`)[0].scrollIntoView({ behavior: \"smooth\", inline: \"center\" });\n\n\t\t_TEXTBOXES.set(s.id);\n\t\t_MAP.set(s.id);\n\n\t\tthis.setNumbering();\n\t};\n\n\tthis.setWMS = function() {\n\t\tthis.store[ this.get(this.active).index ].setWMS();\n\t};\n\tthis.setBasemap = function() {\n\t\tthis.store[ this.get(this.active).index ].setBasemap();\n\t};\n\n\tthis.setBookmark = function(b) {\n\t\tif(!this.active) { return; }\n\n\t\tlet s = this.store[ this.get(this.active).index ];\n\t\ts.setBookmark(b);\n\t\tsave_data();\n\t};\n\n\tthis.setNumbering = function() {\n\t\tlet i = 1;\n\t\tfor(let n of $(\"#scenes li span#num\")) {\n\t\t\t$(n).html(i++);\n\t\t}\n\t};\n\n\tthis.copyBounds = function() {\n\t\tif(!this.active) { return; }\n\n\t\tthis.copiedBounds = this.get(this.active).bounds;\n\t};\n\n\tthis.pasteBounds = function() {\n\t\tif(!this.active) { return; }\n\n\t\tlet s = this.store[ this.get(this.active).index ];\n\t\ts.setBounds(this.copiedBounds);\n\t};\n\n\tthis.importData = function(data) {\n\t\tif(data.length <= 0) { return; }\n\n\t\tif(this.store.length <= 0 || !this.active) {\n\t\t\tthis.active = data[0].id;\n\t\t}\n\n\t\tfor(let o of data) {\n\t\t\tlet s = new Scene(o.id);\n\t\t\ts.bounds = o.bounds;\n\t\t\ts.wms = o.wms;\n\t\t\ts.basemap = o.basemap;\n\n\t\t\ts.setBookmark(o.bookmark);\n\t\t\ts.setTitle(o.title);\n\n\t\t\ts.disable();\n\n\t\t\tthis.store.push(s);\n\t\t}\n\t};\n\n\tthis.exportData = function() {\n\t\tlet r = [];\n\t\tfor(let s of this.store) { r.push( s.exportData() ); }\n\t\treturn r;\n\t};\n}\n\n\n\nfunction Scene(id, prevId) {\n\tthis.id = id || uuid();\n\n\tthis.bounds = null;\n\tthis.wms = null;\n\tthis.basemap = null;\n\n\tthis.bookmark = false;\n\tthis.title = \"\";\n\n\tnew_scene(this.id, prevId);\n\n\t$(`li[data-id=\"${this.id}\"]`).on(\"keydown keyup\", ev => { ev.stopPropagation(); });\n\t$(`li[data-id=\"${this.id}\"] input#title`).change(ev => { this.title = ev.target.value; });\n\n\n\tthis.enable = function() {\n\t\t$(`li[data-id=\"${this.id}\"]`).addClass(\"active\");\n\t\t$(`li[data-id=\"${this.id}\"] input, li[data-id=\"${this.id}\"] button`).prop(\"disabled\", false);\n\t\t$(`li[data-id=\"${this.id}\"] input, li[data-id=\"${this.id}\"] button`).click(ev => { ev.stopPropagation(); });\n\t};\n\n\tthis.disable = function() {\n\t\t$(`li[data-id=\"${this.id}\"]`).removeClass(\"active\");\n\t\t$(`li[data-id=\"${this.id}\"] input`).prop(\"disabled\", true);\n\t\t$(`li[data-id=\"${this.id}\"] input, li[data-id=\"${this.id}\"] button`).off(\"click\");\n\t};\n\n\tthis.setBounds = function(bounds) {\n\t\tthis.bounds = bounds;\n\t\t_MAP.setFlyTo( this.bounds );\n\t};\n\n\tthis.setWMS = function() { this.wms = _MAP.getWMS(); };\n\tthis.setBasemap = function() { this.basemap = _MAP.getBasemap(); };\n\n\tthis.setBookmark = function(b) {\n\t\tthis.bookmark = b;\n\t\tif(b) { $(`li[data-id=\"${this.id}\"]`).addClass(\"bookmark\"); }\n\t\telse{ $(`li[data-id=\"${this.id}\"]`).removeClass(\"bookmark\"); }\n\t};\n\n\tthis.setTitle = function(t) {\n\t\tthis.title = t;\n\t\t$(`li[data-id=\"${this.id}\"] input#title`).val(this.title);\n\t};\n\n\tthis.capture = function() {\n\t\tlet nw = _MAP.getBounds().getNorthWest(),\n\t\t\tse = _MAP.getBounds().getSouthEast();\n\t\tthis.setBounds( [[nw.lat, nw.lng], [se.lat, se.lng]] );\n\t\tthis.setBasemap();\n\t};\n\n\tthis.exportData = function() {\n\t\treturn {\n\t\t\tid: this.id,\n\t\t\tbounds: this.bounds,\n\t\t\twms: this.wms,\n\t\t\tbasemap: this.basemap,\n\t\t\tbookmark: this.bookmark,\n\t\t\ttitle: this.title\n\t\t};\n\t};\n}\n","/*******************************************************************************\n* Copyright (C) Nordfjord EDB AS - All Rights Reserved                         *\n*                                                                              *\n* Unauthorized copying of this file, via any medium is strictly prohibited     *\n* Proprietary and confidential                                                 *\n* Written by Andreas Atakan <aca@geotales.io>, January 2022                  *\n*******************************************************************************/\n\n\"use strict\";\n\nimport { uuid, save_data } from \"./helpers.js\";\n\n\nexport function Textboxes() {\n\tthis.store = [];\n\n\t$(\"input#_img_textbox\").change(function(ev) {\n\t\tlet file = $(this)[0].files[0];\n\t\tif(!file) { return; }\n\n\t\t$(\"#loadingModal\").modal(\"show\");\n\t\tlet data = new FormData();\n\t\tdata.append(\"op\", \"create\");\n\t\tdata.append(\"type\", \"image\");\n\t\tdata.append(\"image\", file);\n\t\t$.ajax({\n\t\t\ttype: \"POST\",\n\t\t\turl: \"api/upload.php\",\n\t\t\tdata: data,\n\t\t\tcontentType: false,\n\t\t\tprocessData: false,\n\t\t\tsuccess: function(result, status, xhr) {\n\t\t\t\t$(\"#textbox #content\").trumbowyg(\"execCmd\", { cmd: \"insertImage\", param: result, forceCss: false, skipTrumbowyg: true });\n\t\t\t\tsetTimeout(function() { $(\"#loadingModal\").modal(\"hide\"); }, 750);\n\t\t\t},\n\t\t\terror: function(xhr, status, error) {\n\t\t\t\tconsole.log(xhr.status, error);\n\t\t\t\tsetTimeout(function() { $(\"#loadingModal\").modal(\"hide\"); $(\"#errorModal\").modal(\"show\"); }, 750);\n\t\t\t}\n\t\t});\n\t});\n\n\t$(\"#textbox input#lock\").change(ev => {\n\t\tthis.setLock( ev.target.checked );\n\t});\n\n\t$(\"#textbox button#close\").click(ev => { this.delete(_SCENES.active); });\n\n\t$(\"#textboxOptionsModal select#bookOrientation\").change(ev => {\n\t\tthis.setOrientation( ev.target.value );\n\t});\n\n\n\tthis.setup = function() {\n\t\t$(\"#textbox\").resizable({ // https://api.jqueryui.com/resizable/\n\t\t\tcontainment: \"#mapRow\", handles: \"e\", minWidth: 100,\n\t\t\tstop: (ev, ui) => {\n\t\t\t\tlet w = ui.size.width / ($(\"#mapRow\").outerWidth() - 20),\n\t\t\t\t\tt = this.get(_SCENES.active);\n\t\t\t\tif(t) {\n\t\t\t\t\tthis.store[ t.index ].dim = [0, w];\n\t\t\t\t\t$(\"#textbox\").css({ width: `${w * 100}%` });\n\t\t\t\t\tif(t.pos == \"right\") { $(\"#textbox\").css({ left: \"auto\" }); }\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t$(\"#textbox #content\").trumbowyg({\n\t\t\tautogrow: true, semantic: false, resetCss: true, removeformatPasted: true, urlProtocol: true,\n\t\t\tdefaultLinkTarget: \"_blank\",\n\t\t\ttagsToRemove: [\"script\", \"link\"],\n\t\t\tbtnsDef: {\n\t\t\t\tformat: { dropdown: [\"bold\", \"italic\", \"underline\", \"del\"], title: \"Format\", ico: \"bold\" },\n\t\t\t\talign: {\n\t\t\t\t\tdropdown: [\"justifyLeft\", \"justifyCenter\", \"justifyRight\", \"justifyFull\", \"unorderedList\", \"orderedList\"],\n\t\t\t\t\ttitle: \"List/Align\",\n\t\t\t\t\tico: \"justifyLeft\"\n\t\t\t\t},\n\t\t\t\tuploadImg: {\n\t\t\t\t\tfn: ev => { $(\"input#_img_textbox\").click(); },\n\t\t\t\t\ttitle: \"Add image\", ico: \"insertImage\"\n\t\t\t\t},\n\t\t\t\tmakeLink: {\n\t\t\t\t\tfn: ev => {\n\t\t\t\t\t\t$(\"#textbox #content\").trumbowyg(\"saveRange\");\n\t\t\t\t\t\tlet text = $(\"#textbox #content\").trumbowyg(\"getRangeText\");\n\t\t\t\t\t\tif(text.replace(/\\s/g, \"\") == \"\") { return; }\n\n\t\t\t\t\t\tif([\"http\", \"https\"].indexOf(text.split(\"://\")[0]) < 0) { text = `https://${text}`; }\n\t\t\t\t\t\t$(\"#textbox #content\").trumbowyg(\"execCmd\", { cmd: \"insertHTML\", param: `<a href=\"${text}\" target=\"_blank\">${text}</a>`, forceCss: false });\n\t\t\t\t\t},\n\t\t\t\t\ttitle: \"Create link\", ico: \"link\"\n\t\t\t\t}\n\t\t\t},\n\t\t\tbtns: [\n\t\t\t\t[\"formatting\"], [\"format\"], [\"align\"], [\"fontfamily\"], [\"foreColor\", \"backColor\"], [\"makeLink\"], [\"uploadImg\"]\n\t\t\t],\n\t\t\tplugins: {}\n\t\t}).on(\"tbwchange\", () => {\n\t\t\tlet t = this.get(_SCENES.active);\n\t\t\tif(t) { this.store[ t.index ].content = $(\"#textbox #content\").trumbowyg(\"html\"); }\n\t\t});\n\n\t\t_MAP.setOrientation(\"right\");\n\t};\n\n\tthis.reset = function() {\n\t\t$(\"#textbox\").resizable(\"destroy\");\n\t\t$(\"#textbox #content\").trumbowyg(\"destroy\");\n\t\t_MAP.setOrientation(\"right\");\n\t};\n\n\tthis.get = function(sceneId) {\n\t\tfor(let i = 0; i < this.store.length; i++) {\n\t\t\tlet t = Object.assign({}, this.store[i]);\n\t\t\tif(t.sceneId == sceneId) { t.index = i; return t; }\n\t\t}\n\t\treturn null;\n\t};\n\n\tthis.add = function() {\n\t\tif(!_SCENES.active) { return; }\n\n\t\tlet t = new Textbox(null);\n\t\tt.sceneId = _SCENES.active;\n\t\tt.enable();\n\t\tthis.store.push(t);\n\t\tsave_data();\n\t};\n\n\tthis.addScene = function(sceneId) {\n\t\tlet prev = _SCENES.getPrevScene(sceneId);\n\t\tif(prev) {\n\t\t\tfor(let t of this.store) {\n\t\t\t\tif(t.sceneId == prev.id && t.locked) {\n\t\t\t\t\tlet tt = new Textbox(null);\n\t\t\t\t\ttt.sceneId = sceneId;\n\t\t\t\t\ttt.pos = t.pos; tt.dim = t.dim;\n\t\t\t\t\ttt.content = t.content;\n\t\t\t\t\ttt.locked = true;\n\t\t\t\t\ttt.enable();\n\t\t\t\t\tthis.store.push(tt);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.delete = function(sceneId) {\n\t\tlet t = this.get(sceneId);\n\t\tif(!t) { return; }\n\n\t\tt.disable();\n\t\tthis.store.splice(t.index, 1);\n\t\tsave_data();\n\t};\n\n\tthis.deleteScene = function(sceneId) {\n\t\tfor(let t of this.store) {\n\t\t\tif(t.sceneId == sceneId) { this.delete(t.sceneId); }\n\t\t}\n\t};\n\n\tthis.set = function(sceneId) {\n\t\tfor(let t of this.store) {\n\t\t\tif(t.sceneId == sceneId) { t.enable(); break; }\n\t\t\telse{ t.disable(); }\n\t\t}\n\t};\n\n\tthis.setLock = function(l) {\n\t\tlet t = this.get(_SCENES.active);\n\t\tif(!t) { return; }\n\n\t\tthis.store[ t.index ].setLock(l);\n\t};\n\n\tthis.setOrientation = function(pos) {\n\t\tlet t = this.get(_SCENES.active);\n\t\tif(!t) { return; }\n\n\t\tthis.store[ t.index ].pos = pos;\n\t\tthis.store[ t.index ].setOrientation();\n\t};\n\n\tthis.importData = function(data) {\n\t\tif(data.length <= 0) { return; }\n\n\t\tfor(let o of data) {\n\t\t\tlet t = new Textbox(o.id);\n\t\t\tt.sceneId = o.sceneId;\n\t\t\tt.pos = o.pos; t.dim = o.dim;\n\t\t\tt.content = o.content;\n\t\t\tt.locked = o.locked;\n\n\t\t\tt.disable();\n\n\t\t\tthis.store.push(t);\n\t\t}\n\t};\n\n\tthis.exportData = function() {\n\t\tlet r = [];\n\t\tfor(let t of this.store) { r.push( t.exportData() ); }\n\t\treturn r;\n\t};\n}\n\n\n\nfunction Textbox(id) {\n\tthis.id = id || uuid();\n\n\tthis.sceneId = \"\";\n\tthis.locked = false;\n\n\tthis.pos = \"left\";\n\tthis.dim = [0, 0.25];\n\tthis.content = \"\";\n\n\n\tthis.setOrientation = function() {\n\t\tswitch(this.pos) {\n\t\t\tcase \"left\":\n\t\t\t\t$(\"#textbox\").css({ left: \"10px\", right: \"auto\" });\n\t\t\t\t$(\"#textbox\").resizable(\"option\", { handles: \"e\" });\n\t\t\t\t_MAP.setOrientation(\"right\");\n\t\t\t\tbreak;\n\n\t\t\tcase \"right\":\n\t\t\t\t$(\"#textbox\").css({ left: \"auto\", right: \"10px\" });\n\t\t\t\t$(\"#textbox\").resizable(\"option\", { handles: \"w\" });\n\t\t\t\t_MAP.setOrientation(\"left\");\n\t\t\t\tbreak;\n\n\t\t\tdefault: break;\n\t\t}\n\t};\n\n\tthis.setLock = function(l) {\n\t\tthis.locked = l;\n\t\t$(\"#textbox input#lock\").prop(\"checked\", this.locked);\n\t};\n\n\tthis.enable = function() {\n\t\tthis.setOrientation();\n\n\t\t$(\"#textbox\").css(\"display\", \"block\");\n\t\t$(\"#textbox\").css({ width: `${this.dim[1] * 100}%` });\n\n\t\t$(\"#textbox #content\").trumbowyg(\"enable\");\n\t\t$(\"#textbox #content\").trumbowyg(\"html\", this.content);\n\n\t\t$(\"#textbox #lock\").prop({ disabled: false, checked: this.locked });\n\n\t\t_MAP.textboxButton.disable();\n\t};\n\n\tthis.disable = function() {\n\t\t$(\"#textbox\").css(\"display\", \"none\");\n\t\t$(\"#textbox #content\").trumbowyg(\"disable\");\n\t\t$(\"#textbox #lock\").prop(\"disabled\", true);\n\t\t_MAP.textboxButton.enable();\n\t};\n\n\tthis.exportData = function() {\n\t\treturn {\n\t\t\tid: this.id,\n\t\t\tsceneId: this.sceneId,\n\t\t\tlocked: this.locked,\n\t\t\tpos: this.pos,\n\t\t\tdim: this.dim,\n\t\t\tcontent: this.content\n\t\t};\n\t};\n}\n","/*******************************************************************************\n* Copyright (C) Nordfjord EDB AS - All Rights Reserved                         *\n*                                                                              *\n* Unauthorized copying of this file, via any medium is strictly prohibited     *\n* Proprietary and confidential                                                 *\n* Written by Andreas Atakan <aca@geotales.io>, January 2022                  *\n*******************************************************************************/\n\n\"use strict\";\n\nimport { uuid, save_data, get_aspect_ratio_dimentions } from \"../helpers.js\";\nimport { avatar_popup, polyline_popup, polygon_popup } from \"../generate.js\";\nimport { bind_setup } from \"./layers.js\";\n\n\nL.Map.addInitHook(function() {\n\n\t// Init map aspect ratio\n\n\tthis.setAspectRatio();\n\n\n\n\t// Plugins\n\n\t/*this.addControl( new L.Control.Fullscreen({ position: \"topright\" }) );*/\n\n\t/*this.addControl( L.control.zoom({ position: \"bottomright\" }) );*/\n\n\tthis.returnButton = L.Control.zoomHome({\n\t\tposition: \"bottomright\",\n\t\tzoomHomeIcon: \"home\",\n\t\tzoomHomeTitle: \"Return to map-extent\"\n\t});\n\tthis.addControl( this.returnButton );\n\n\tthis.basemapButton = L.easyButton({\n\t\tid: \"changeBasemap\",\n\t\tposition: \"bottomright\",\n\t\tleafletClasses: true,\n\t\tstates: [\n\t\t\t{\n\t\t\t\tstateName: \"main\",\n\t\t\t\tonClick: function(button, map) { $(\"#basemapModal\").modal(\"show\"); init_img_basemaps(); },\n\t\t\t\ttitle: \"Change basemap\",\n\t\t\t\ticon: \"fa-layer-group\"\n\t\t\t}\n\t\t]\n\t});\n\tthis.addControl( this.basemapButton );\n\tthis.basemapButton.disable();\n\n\tthis.textboxButton = L.easyButton({\n\t\tid: \"addTextbox\",\n\t\tposition: \"topleft\",\n\t\tleafletClasses: true,\n\t\tstates: [\n\t\t\t{\n\t\t\t\tstateName: \"main\",\n\t\t\t\tonClick: function(button, map) { _TEXTBOXES.add(); },\n\t\t\t\ttitle: \"Add book\",\n\t\t\t\ticon: \"fa-comment-alt\"\n\t\t\t}\n\t\t]\n\t});\n\tthis.addControl( this.textboxButton );\n\tthis.textboxButton.disable();\n\n\t/*this.addControl( L.control.locate({ position: \"topright\" }) );*/\n\n\n\n\n\n\t// Basemap\n\n\tthis.basemap = _BASEMAPS[10].tiles;\n\tthis.addLayer( this.basemap );\n\n\t// WMS\n\n\tthis.wms = {};\n\n\n\n\n\n\t// Draw and edit control\n\n\t//L.PM.setOptIn(true);\n\tthis.pm.addControls({\n\t\tposition: \"topright\",\n\t\tdrawCircleMarker: false,\n\t\tdrawText: false,\n\t\toneBlock: true\n\t});\n\tthis.pm.setPathOptions({\n\t\tweight: 3,\n\t\tcolor: \"#563d7c\",\n\t\topacity: 1,\n\t\tfillColor: \"#563d7c\",\n\t\tfillOpacity: 0.2\n\t});\n\tthis.pm.setGlobalOptions({\n\t\tmarkerStyle: {\n\t\t\ticon: L.icon({ iconUrl: \"assets/user-circle-solid.svg\", iconSize: [30, 30], popupAnchor: [0, -15], tooltipAnchor: [0, 15] })\n\t\t}\n\t});\n\tthis.pm.setLang(\"customLang\", {\n\t\ttooltips: { placeMarker: \"Click to place avatar\" },\n\t\tbuttonTitles: { drawMarkerButton: \"Draw avatar\" }\n\t}, \"en\");\n\tthis.disableDraw();\n\n\n\n\n\n\t// Object layers\n\n\tthis.objects = [];\n\tthis.fadeLayer = L.fadeLayer({ pmIgnore: true });\n\tthis.addLayer( this.fadeLayer );\n\n\tthis.on(\"pm:create\", ev => {\n\t\tlet o = ev.layer, type = ev.shape;\n\n\t\tif(type == \"Marker\") {\n\t\t\tlet zoom = this.getZoom();\n\t\t\tlet p = this.project(o.getLatLng(), zoom),\n\t\t\t\turl = o.getIcon().options.iconUrl,\n\t\t\t\tsize = o.getIcon().options.iconSize;\n\t\t\tthis.removeLayer(o);\n\t\t\to = L.imageOverlay(url, [\n\t\t\t\tthis.unproject([ p.x - size[0] / 2, p.y - size[1] / 2 ], zoom),\n\t\t\t\tthis.unproject([ p.x + size[0] / 2, p.y + size[1] / 2 ], zoom)\n\t\t\t], {\n\t\t\t\tinteractive:\t\t\ttrue,\n\t\t\t\tzIndex:\t\t\t\t\t200,\n\t\t\t\tratio:\t\t\t\t\t496 / 512, // NOTE: this is hard-coded from the pixel-width of 'user-circle-solid.svg'\n\t\t\t\trounded:\t\t\t\tfalse,\n\t\t\t\tangle:\t\t\t\t\t0,\n\t\t\t\tborderColor:\t\t\t\"#563d7c\",\n\t\t\t\tborderThickness:\t\t0,\n\t\t\t\toverlayBlur:\t\t\t0,\n\t\t\t\toverlayGrayscale:\t\t0,\n\t\t\t\toverlayBrightness:\t\t0,\n\t\t\t\toverlayTransparency:\t0\n\t\t\t});\n\t\t\tthis.addLayer(o);\n\t\t}\n\n\t\to.options.id = uuid();\n\t\to.options.sceneId = _SCENES.active;\n\n\t\tthis.fire(\"_addedlayer\", { layer: o });\n\n\t\tthis.objects.push( this.extractObject(o) );\n\t});\n\n\tthis.on(\"_addedlayer\", async ev => {\n\t\tlet o = ev.layer;\n\n\t\tlet label = o.options.label;\n\t\tif(label) {\n\t\t\to.bindTooltip(label, { direction: \"center\", permanent: true });\n\t\t\tif(o instanceof L.ImageOverlay) { this.updateTooltip(o); }\n\t\t}\n\n\t\to.on(\"moveend\", ev => { this.updateTooltip(ev.target); });\n\t\to.on(\"pm:edit\", ev => {\n\t\t\tlet o = ev.layer;\n\t\t\tthis.updateObject(o);\n\t\t\tif(o.options.label) { o.closeTooltip(); o.openTooltip(); }\n\t\t});\n\n\t\to.on(\"pm:remove\", ev => {\n\t\t\tlet o = ev.layer;\n\n\t\t\tthis.deleteObject(o);\n\n\t\t\to.closeTooltip(); o.unbindTooltip();\n\t\t\to.closePopup(); o.unbindPopup();\n\t\t\to.off(\"popupopen\"); o.off(\"mouseover\"); o.off(\"mouseout\");\n\n\t\t\to.slideCancel();\n\t\t});\n\n\t\tthis.setPopup(o);\n\n\t\to.on(\"pm:dragstart\", ev => { o.unbindPopup(); });\n\t\to.on(\"pm:dragend\", ev => { this.setPopup( ev.layer ); });\n\n\t\to.on(\"popupopen\", ev => { bind_setup(o); });\n\t\to.on(\"mouseover\", ev => { this.highlightObject(o.options.id); });\n\t\to.on(\"mouseout\", ev => { this.unhighlightObject(o.options.id); });\n\n\t\tlet contextmenu = [\n\t\t\t{ text: \"Move to front\", callback: ev => { o.bringToFront(); }, index: 0 },\n\t\t\t{ text: \"Move to back\", callback: ev => { o.bringToBack(); }, index: 1 }\n\t\t];\n\n\t\tif(o instanceof L.ImageOverlay) {\n\t\t\tcontextmenu.push( { text: \"Clone avatar\", callback: ev => { this.cloneAvatar(o.options.id, o.options.sceneId); }, index: 2 } );\n\t\t\tthis.setIcon(o);\n\t\t}\n\n\t\to.bindContextMenu({ contextmenu: true, contextmenuItems: contextmenu });\n\t});\n\n\tthis.on(\"layeradd\", ev => {\n\t\tlet o = ev.layer;\n\t\t//let opacity = o.options.opacity;\n\n\t\t/* TODO: fade in layer when added\n\t\t\tAlternatively this can be implemented in each prototypes\n\t\t\tonAdd method (in layers.js), instead of here.\n\t\t*/\n\t});\n\n\tthis.on(\"zoomend\", ev => {\n\t\tfor(let o of this.getLayers()) { this.updateTooltip(o); }\n\t});\n\tthis.on(\"zoom\", ev => { if(this._renderer) { this._renderer._reset(); } });\n\n\n\tthis.on(\"movestart\", ev => { /**/ });\n\tthis.on(\"moveend\", ev => { /**/ });\n\n});\n\n\n\n\n\nL.Map.include({\n\n\tsetup: function() {\n\t\tthis.setAspectRatio();\n\n\t\tthis.enableDraw();\n\t\tthis.basemapButton.enable();\n\t\tthis.textboxButton.enable();\n\n\t\t$(\"div.leaflet-control-attribution a\").prop(\"target\", \"_blank\");\n\t},\n\treset: function() {\n\t\tthis.clearLayers();\n\t\tthis.fadeLayer.clearLayers();\n\n\t\tthis.disableDraw();\n\t\tthis.basemapButton.disable();\n\t\tthis.textboxButton.disable();\n\t},\n\n\tenableDraw: function() {\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Marker\", false);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Line\", false);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Polygon\", false);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Rectangle\", false);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Circle\", false);\n\t\t//this.pm.Toolbar.setButtonDisabled(\"Text\", false);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Edit\", false);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Drag\", false);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Cut\", false);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Removal\", false);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Rotate\", false);\n\t},\n\tdisableDraw: function() {\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Marker\", true);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Line\", true);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Polygon\", true);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Rectangle\", true);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Circle\", true);\n\t\t//this.pm.Toolbar.setButtonDisabled(\"Text\", true);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Edit\", true);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Drag\", true);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Cut\", true);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Removal\", true);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Rotate\", true);\n\t},\n\n\tsetOrientation: function(pos) {\n\t\tswitch(pos) {\n\t\t\tcase \"left\":\n\t\t\t\tthis.returnButton.setPosition(\"bottomleft\");\n\t\t\t\tthis.basemapButton.setPosition(\"bottomleft\");\n\t\t\t\tthis.pm.Toolbar.setBlockPosition(\"draw\", \"topleft\");\n\t\t\t\tthis.pm.Toolbar.setBlockPosition(\"edit\", \"topleft\");\n\t\t\t\tthis.textboxButton.setPosition(\"topright\");\n\t\t\t\tbreak;\n\n\t\t\tcase \"right\":\n\t\t\t\tthis.returnButton.setPosition(\"bottomright\");\n\t\t\t\tthis.basemapButton.setPosition(\"bottomright\");\n\t\t\t\tthis.pm.Toolbar.setBlockPosition(\"draw\", \"topright\");\n\t\t\t\tthis.pm.Toolbar.setBlockPosition(\"edit\", \"topright\");\n\t\t\t\tthis.textboxButton.setPosition(\"topleft\");\n\t\t\t\tbreak;\n\n\t\t\tdefault: break;\n\t\t}\n\t},\n\n\tsetHomeBounds: function(bounds) {\n\t\tif(this.returnButton) {\n\t\t\tthis.returnButton.setHomeBounds(bounds, { maxZoom: this.getMaxZoom() });\n\t\t}\n\t},\n\n\tsetAspectRatio: function(ratio) {\n\t\tif(ratio) { _OPTIONS.aspectratio = ratio; }\n\t\tlet w = $(\"#mapRow\").outerWidth(),\n\t\t\th = $(\"#mapRow\").outerHeight(),\n\t\t\tr = _OPTIONS.aspectratio;\n\n\t\tlet dim = get_aspect_ratio_dimentions(w, h, r);\n\t\t$(\"#map\").css({\n\t\t\twidth: `${(dim[0]/w) * 100}%`,\n\t\t\theight: `calc(${(dim[1]/h) * 100}% - 39px - 49px)`,\n\t\t\tleft: `${(((w - dim[0]) / 2) / w) * 100}%`,\n\t\t\ttop: `calc(${(((h - dim[1]) / 2)/ h) * 100}% + 39px + 49px)`\n\t\t});\n\n\t\tthis.invalidateSize();\n\t\tif(_SCENES.active) { this.setFlyTo( _SCENES.get( _SCENES.active ).bounds ); }\n\t},\n\n\tsetFlyTo: function(bounds) {\n\t\tthis.flyToBounds(bounds, { maxZoom: this.getMaxZoom(), noMoveStart: true, duration: _OPTIONS.panningspeed || null });\n\t\tthis.setHomeBounds(bounds);\n\t},\n\n\n\n\tclearLayers: function() {\n\t\tfor(let o of this.getLayers()) {\n\t\t\tthis.removeLayer(o);\n\t\t}\n\t},\n\n\tgetLayers: function() {\n\t\treturn this.pm.getGeomanLayers();\n\t},\n\n\taddScene: function(sceneId) {\n\t\tlet prev = _SCENES.getPrevScene(sceneId);\n\t\tif(!prev || !_OPTIONS.objectOptIn) { return; }\n\t\tlet prevId = prev.id;\n\n\t\tfor(let object of this.objects) {\n\t\t\tif(object.sceneId == prevId) {\n\t\t\t\tlet o = Object.assign({}, object);\n\t\t\t\to.sceneId = sceneId;\n\t\t\t\tthis.objects.push(o);\n\t\t\t}\n\t\t}\n\n\t\t_SCENES.store[ _SCENES.get(sceneId).index ].setWMS();\n\t},\n\tdeleteScene: function(sceneId) {\n\t\tthis.objects = this.objects.filter(o => o.sceneId != sceneId);\n\t},\n\n\thighlightObject: function(id) {\n\t\tlet o = this.fadeLayer.getObject(id);\n\t\tif(!o) { return; }\n\n\t\tif(o instanceof L.ImageOverlay) { o.setOpacity( 0.8 ); }\n\t\telse{ o.setStyle({ opacity: 0.8 }); }\n\t},\n\tunhighlightObject: function(id) {\n\t\tlet o = this.fadeLayer.getObject(id);\n\t\tif(!o) { return; }\n\n\t\tif(o instanceof L.ImageOverlay) { o.setOpacity( 0.3 ); }\n\t\telse{ o.setStyle({ opacity: 0.3 }); }\n\t},\n\n\tsetObjects: function(sceneId) {\n\t\tlet prev = _SCENES.getPrevScene(sceneId);\n\t\tlet prevId = prev ? prev.id : null;\n\n\t\tthis.fadeLayer.clearLayers();\n\t\tif(prevId) {\n\t\t\tfor(let o of this.objects) {\n\t\t\t\tif(o.sceneId == prevId) { this.fadeLayer.addLayer(this.createObject(o), o.id); }\n\t\t\t}\n\t\t}\n\n\t\tlet os = this.getLayers().map(o => {\n\t\t\tlet r = this.extractObject(o); return { id: r.id, pos: r.pos, radius: r.radius, animationspeed: r.animationspeed };\n\t\t});\n\t\tthis.clearLayers();\n\t\tfor(let i = 0; i < this.objects.length; i++) {\n\t\t\tlet o = Object.assign({}, this.objects[i]);\n\t\t\tif(o.sceneId == sceneId) {\n\t\t\t\tlet pos = o.pos, rad = o.radius;\n\t\t\t\tfor(let oo of os) {\n\t\t\t\t\tif(o.id == oo.id) {\n\t\t\t\t\t\to.pos = oo.pos;\n\t\t\t\t\t\tif(o.type == \"circle\") { o.radius = oo.radius; }\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlet object = this.createObject(o);\n\t\t\t\tthis.addLayer( object );\n\t\t\t\tthis.fire(\"_addedlayer\", { layer: object });\n\n\t\t\t\tfor(let oo of os) {\n\t\t\t\t\tif(o.id == oo.id) {\n\t\t\t\t\t\tobject.slideTo( pos , { radius: rad, duration: oo.animationspeed || _OPTIONS.animationspeed });\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\tset: function(sceneId) {\n\t\tlet s = _SCENES.get(sceneId);\n\t\tthis.setBasemap(s.basemap);\n\t\tthis.setWMS(s.wms);\n\t\tthis.setObjects(sceneId);\n\t\tthis.setFlyTo(s.bounds);\n\t},\n\n\tinsertObject: function(o) {\n\t\tfor(let oo of this.getLayers()) {\n\t\t\tif(oo.options.id == o.options.id) { return; }\n\t\t}\n\n\t\tlet object;\n\t\tfor(let oo of this.objects) {\n\t\t\tif(oo.id == o.options.id\n\t\t\t&& oo.sceneId == o.options.sceneId) {\n\t\t\t\tobject = Object.assign({}, oo);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tobject.sceneId = _SCENES.active;\n\n\t\tlet oo = this.createObject(object);\n\t\tthis.addLayer( oo );\n\t\tthis.fire(\"_addedlayer\", { layer: oo });\n\t\tthis.objects.push(object);\n\t},\n\tcloneAvatar: function(id, sceneId) {\n\t\tlet object;\n\t\tfor(let o of this.objects) {\n\t\t\tif(o.id == id && o.sceneId == sceneId) {\n\t\t\t\tobject = Object.assign({}, o);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tobject.id = uuid();\n\n\t\tlet zoom = this.getZoom();\n\t\tlet nw = this.project(object.pos[0], zoom),\n\t\t\tse = this.project(object.pos[1], zoom);\n\t\tnw.x += 50; nw.y += 50;\n\t\tse.x += 50; se.y += 50;\n\t\tnw = this.unproject(nw, zoom);\n\t\tse = this.unproject(se, zoom);\n\n\t\tobject.pos = [[nw.lat, nw.lng], [se.lat, se.lng]];\n\n\t\tlet o = this.createObject(object);\n\t\tthis.addLayer(o);\n\t\tthis.fire(\"_addedlayer\", { layer: o });\n\t\tthis.objects.push(object);\n\t},\n\n\tupdateObject: function(o) {\n\t\tfor(let i = 0; i < this.objects.length; i++) {\n\t\t\tlet oo = this.objects[i];\n\t\t\tif(oo.id == o.options.id\n\t\t\t&& oo.sceneId == o.options.sceneId) {\n\t\t\t\tthis.objects[i] = this.extractObject(o);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t},\n\n\tdeleteObject: function(o) {\n\t\tfor(let i = 0; i < this.objects.length; i++) {\n\t\t\tlet oo = this.objects[i];\n\t\t\tif(oo.id == o.options.id\n\t\t\t&& oo.sceneId == o.options.sceneId) {\n\t\t\t\tthis.objects.splice(i, 1);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t},\n\n\tglobalObjectOptions: function(object) {\n\t\tlet o = this.extractObject(object);\n\t\tdelete o.id; delete o.sceneId; delete o.type; delete o.pos;\n\t\tif(object instanceof L.Circle) { delete o.radius; }\n\n\t\tfor(let i = 0; i < this.objects.length; i++) {\n\t\t\tlet oo = this.objects[i];\n\t\t\tif(oo.id == object.options.id && oo.sceneId != object.options.sceneId) {\n\t\t\t\tthis.objects[i] = Object.assign({}, oo, o);\n\t\t\t}\n\t\t}\n\n\t\tvar object = this.fadeLayer.getObject(object.options.id);\n\t\tif(object) {\n\t\t\tthis.fadeLayer.removeLayer(object);\n\n\t\t\tlet oo = Object.assign({}, this.extractObject(object), o);\n\t\t\tthis.fadeLayer.addLayer(this.createObject(oo), oo.id);\n\t\t}\n\t},\n\n\tsetIcon: function(o, size, icon) {\n\t\tif(!(o instanceof L.ImageOverlay)) { return; }\n\n\t\tif(size) {\n\t\t\tlet zoom = this.getZoom();\n\t\t\tlet c = this.project(o.getBounds().getCenter(), zoom);\n\t\t\to.setBounds([\n\t\t\t\tthis.unproject([ c.x - size[0] / 2, c.y - size[1] / 2 ], zoom),\n\t\t\t\tthis.unproject([ c.x + size[0] / 2, c.y + size[1] / 2 ], zoom)\n\t\t\t]);\n\t\t}\n\t\tif(icon) { o.setUrl(icon); }\n\n\t\t$(o._image).css(\"border-radius\", o.options.rounded ? \"50%\" : \"0\");\n\t\t//$(o._image).css(\"transform\", `rotate(${o.options.angle}deg)`);\n\t\t$(o._image).css(\"border\", `${o.options.borderThickness}px solid ${o.options.borderColor}`);\n\t\t$(o._image).css(\"filter\", `\n\t\t\tblur(${o.options.overlayBlur}px)\n\t\t\tgrayscale(${o.options.overlayGrayscale*100}%)\n\t\t\tdrop-shadow(0 0 ${o.options.overlayBrightness}px yellow)\n\t\t\topacity(${(1 - o.options.overlayTransparency)*100}%)\n\t\t`);\n\n\t\tif(o.options.label) { this.updateTooltip(o); }\n\t},\n\n\tsetPopup: function(o) {\n\t\to.unbindPopup();\n\t\tlet popup =\n\t\t\to instanceof L.ImageOverlay ? avatar_popup() :\n\t\t\to instanceof L.Rectangle\n\t\t || o instanceof L.Polygon\n\t\t || o instanceof L.Circle ? polygon_popup() :\n\t\t\to instanceof L.Polyline ? polyline_popup() : \"\";\n\t\tif(!popup) { return; }\n\t\to.bindPopup(popup, { keepInView: true, closeOnEscapeKey: false, maxWidth: 350, maxHeight: 450 });\n\t},\n\n\tupdateTooltip: function(o) {\n\t\tif(o.getTooltip()) {\n\t\t\to.closeTooltip();\n\t\t\tif(o instanceof L.ImageOverlay) {\n\t\t\t\tlet d = this.latLngToContainerPoint( o.getBounds().getNorthWest() ).distanceTo( this.latLngToContainerPoint( o.getBounds().getSouthWest() ) );\n\t\t\t\to.getTooltip().options.offset = [0, d / 2 - 10];\n\t\t\t}\n\t\t\to.openTooltip();\n\t\t}\n\t},\n\n\n\n\tgetWMS: function() {\n\t\treturn this.wms ? {\n\t\t\ttype: \"wms\",\n\t\t\turl: this.wms._url,\n\t\t\tlayers: this.wms.options.layers,\n\t\t\tformat: this.wms.options.format,\n\t\t\tversion: this.wms.options.version,\n\t\t\ttransparent: this.wms.options.transparent\n\t\t} : null;\n\t},\n\n\tsetWMS: function(source) {\n\t\tif(!source) {\n\t\t\tthis.wms = this.wms ? this.removeLayer( this.wms ) : null;\n\t\t\treturn;\n\t\t}\n\t\tif(this.wms\n\t\t&& (source.url || source._url) == this.wms._url\n\t\t&& (source.layers || source.options.layers) == this.wms.options.layers\n\t\t&& (source.format || source.options.format) == this.wms.options.format\n\t\t&& (source.version || source.options.version) == this.wms.options.version) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet layer;\n\n\t\tif(source instanceof L.TileLayer.WMS) {\n\t\t\tlayer = source;\n\t\t}else\n\t\tif(source.type == \"wms\") {\n\t\t\tlayer = L.tileLayer.wms(source.url, {\n\t\t\t\tlayers: source.layers,\n\t\t\t\tformat: source.format,\n\t\t\t\ttransparent: source.transparent,\n\t\t\t\tversion: source.version,\n\t\t\t\tminZoom: source.minZoom || 0,\n\t\t\t\tmaxZoom: source.maxZoom || 22,\n\t\t\t\tattribution: source.attribution || \"\"\n\t\t\t});\n\t\t}\n\t\telse{ return; }\n\n\t\tif(this.wms) { this.removeLayer( this.wms ); }\n\n\t\tthis.wms = layer;\n\n\t\tthis.addLayer( this.wms );\n\t\tthis.wms.bringToFront();\n\t},\n\n\tgetCenterBasemapTile: function() {\n\t\tif(this.basemap instanceof L.ImageOverlay) {\n\t\t\treturn this.basemap._url;\n\t\t}\n\n\t\tlet s = this.basemap.getTileSize(),\n\t\t\tc = this.project( this.getCenter(), this.getZoom() ),\n\t\t\tr = \"\";\n\n\t\ttry { r = this.basemap.getTileUrl({ x: Math.floor(c.x / s.x), y: Math.floor(c.y / s.y) }); }\n\t\tcatch(e) { console.error(e); }\n\n\t\treturn r;\n\t},\n\n\tgetBasemap: function() {\n\t\tif(this.basemap instanceof L.TileLayer) {\n\t\t\treturn {\n\t\t\t\ttype: \"tiles\",\n\t\t\t\turl: this.basemap._url,\n\t\t\t\tminZoom: this.basemap.options.minZoom,\n\t\t\t\tmaxZoom: this.basemap.options.maxZoom,\n\t\t\t\tattribution: this.basemap.options.attribution\n\t\t\t};\n\t\t}else\n\t\tif(this.basemap instanceof L.ImageOverlay) {\n\t\t\treturn {\n\t\t\t\ttype: \"image\",\n\t\t\t\timg: this.basemap._url\n\t\t\t};\n\t\t}\n\t\treturn null;\n\t},\n\n\tsetBasemap: async function(source) {\n\t\tlet basemap;\n\n\t\tif(source instanceof L.TileLayer) {\n\t\t\tif(this.basemap instanceof L.TileLayer\n\t\t\t&& source._url == this.basemap._url) { return; }\n\n\t\t\tbasemap = source;\n\t\t}else\n\t\tif(source.type == \"tiles\") {\n\t\t\tif(this.basemap instanceof L.TileLayer\n\t\t\t&& source.url == this.basemap._url) { return; }\n\n\t\t\tbasemap = L.tileLayer(source.url, {\n\t\t\t\tminZoom: source.minZoom || 0,\n\t\t\t\tmaxZoom: source.maxZoom || 22,\n\t\t\t\tattribution: source.attribution || `&copy; <a href=\"https://${_HOST}\" target=\"_blank\">GeoTales</a>`\n\t\t\t});\n\t\t}else\n\t\tif(source.type == \"image\") {\n\t\t\tif(this.basemap instanceof L.ImageOverlay\n\t\t\t&& source.img == this.basemap._url) { return; }\n\n\t\t\tlet img = new Image();\n\t\t\timg.src = source.img;\n\t\t\tawait img.decode();\n\n\t\t\tlet r = img.width / img.height;\n\t\t\tlet b = _SCENES.get( _SCENES.active ).bounds;\n\t\t\tlet bounds = [b[0], []];\n\t\t\tlet tlp = this.latLngToContainerPoint(b[0]),\n\t\t\t\tbrp = this.latLngToContainerPoint(b[1]);\n\t\t\tlet h = brp.y - tlp.y,\n\t\t\t\tw = brp.x - tlp.x;\n\n\t\t\tif(r >= 1) { // width >= height\n\t\t\t\tlet p = this.containerPointToLatLng([brp.x, tlp.y + w / r]);\n\t\t\t\tbounds[1][0] = p.lat;\n\t\t\t\tbounds[1][1] = p.lng;\n\t\t\t}else{ // height > width\n\t\t\t\tlet p = this.containerPointToLatLng([tlp.x + r * h, brp.y]);\n\t\t\t\tbounds[1][0] = p.lat;\n\t\t\t\tbounds[1][1] = p.lng;\n\t\t\t}\n\n\t\t\tbasemap = L.imageOverlay(source.img, bounds, {\n\t\t\t\tpmIgnore: true,\n\t\t\t\tzIndex: 0,\n\t\t\t\tminZoom: 0, maxZoom: 1000,\n\t\t\t\tattribution: `&copy; <a href=\"https://${_HOST}\" target=\"_blank\">GeoTales</a>`\n\t\t\t});\n\t\t}\n\t\telse{ return; }\n\n\t\tthis.removeLayer( this.basemap );\n\n\t\tthis.basemap = basemap;\n\n\t\tthis.presetZoom(this.basemap.options.minZoom, this.basemap.options.maxZoom);\n\n\t\tthis.addLayer( this.basemap );\n\t\tthis.basemap.bringToBack();\n\n\t\t$(\"div.leaflet-control-attribution a\").prop(\"target\", \"_blank\");\n\t\tsave_data();\n\t},\n\n\tresetBasemap: function() { this.setBasemap( _BASEMAPS[10].tiles ); },\n\n\tpresetZoom: function(min, max) {\n\t\tlet zoom = this.getZoom();\n\t\tif(zoom < min || zoom > max) {\n\t\t\tif(zoom < min) { this.setZoom(min); }\n\t\t\tif(zoom > max) { this.setZoom(max); }\n\t\t}\n\t\tthis.setMinZoom(min);\n\t\tthis.setMaxZoom(max);\n\t},\n\n\n\n\tcreateObject: function(o) {\n\t\tlet oo = null;\n\n\t\tswitch(o.type) {\n\t\t\tcase \"avatar\":\n\t\t\t\too = L.imageOverlay(o.icon, o.pos, {\n\t\t\t\t\tinteractive:\t\t\ttrue,\n\t\t\t\t\tzIndex:\t\t\t\t\t200,\n\t\t\t\t\tlabel:\t\t\t\t\to.label,\n\t\t\t\t\tratio:\t\t\t\t\to.ratio,\n\t\t\t\t\trounded:\t\t\t\to.rounded,\n\t\t\t\t\tangle:\t\t\t\t\to.angle,\n\t\t\t\t\tborderColor:\t\t\to.borderColor,\n\t\t\t\t\tborderThickness:\t\to.borderThickness,\n\t\t\t\t\toverlayBlur:\t\t\to.blur,\n\t\t\t\t\toverlayBrightness:\t\to.brightness,\n\t\t\t\t\toverlayGrayscale:\t\to.grayscale,\n\t\t\t\t\toverlayTransparency:\to.transparency,\n\t\t\t\t\tanimationspeed:\t\t\to.animationspeed\n\t\t\t\t});\n\t\t\t\tbreak;\n\n\t\t\tcase \"polyline\":\n\t\t\t\too = L.polyline(o.pos, {\n\t\t\t\t\tlabel:\t\t\to.label,\n\t\t\t\t\tdashArray:\t\to.dashed ? \"5, 10\" : \"\",\n\t\t\t\t\tcolor:\t\t\to.color,\n\t\t\t\t\tweight:\t\t\to.thickness,\n\t\t\t\t\topacity:\t\t1 - o.transparency,\n\t\t\t\t\tanimationspeed:\to.animationspeed\n\t\t\t\t});\n\t\t\t\tbreak;\n\n\t\t\tcase \"polygon\":\n\t\t\t\too = L.polygon(o.pos, {\n\t\t\t\t\tlabel:\t\t\to.label,\n\t\t\t\t\tdashArray:\t\to.dashed ? \"5, 10\" : \"\",\n\t\t\t\t\tcolor:\t\t\to.lineColor,\n\t\t\t\t\tweight:\t\t\to.lineThickness,\n\t\t\t\t\topacity:\t\t1 - o.lineTransparency,\n\t\t\t\t\tfillColor:\t\to.fillColor,\n\t\t\t\t\tfillOpacity:\t1 - o.fillTransparency,\n\t\t\t\t\tanimationspeed:\to.animationspeed\n\t\t\t\t});\n\t\t\t\tbreak;\n\n\t\t\tcase \"rectangle\":\n\t\t\t\too = L.rectangle(o.pos, {\n\t\t\t\t\tlabel:\t\t\to.label,\n\t\t\t\t\tdashArray:\t\to.dashed ? \"5, 10\" : \"\",\n\t\t\t\t\tcolor:\t\t\to.lineColor,\n\t\t\t\t\tweight:\t\t\to.lineThickness,\n\t\t\t\t\topacity:\t\t1 - o.lineTransparency,\n\t\t\t\t\tfillColor:\t\to.fillColor,\n\t\t\t\t\tfillOpacity:\t1 - o.fillTransparency,\n\t\t\t\t\tanimationspeed:\to.animationspeed\n\t\t\t\t});\n\t\t\t\tbreak;\n\n\t\t\tcase \"circle\":\n\t\t\t\too = L.circle(o.pos, {\n\t\t\t\t\tradius:\t\t\to.radius,\n\t\t\t\t\tlabel:\t\t\to.label,\n\t\t\t\t\tdashArray:\t\to.dashed ? \"5, 10\" : \"\",\n\t\t\t\t\tcolor:\t\t\to.lineColor,\n\t\t\t\t\tweight:\t\t\to.lineThickness,\n\t\t\t\t\topacity:\t\t1 - o.lineTransparency,\n\t\t\t\t\tfillColor:\t\to.fillColor,\n\t\t\t\t\tfillOpacity:\t1 - o.fillTransparency,\n\t\t\t\t\tanimationspeed:\to.animationspeed\n\t\t\t\t});\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tconsole.error(\"object type invalid\");\n\t\t\t\tbreak;\n\t\t}\n\n\t\too.options.id = o.id;\n\t\too.options.sceneId = o.sceneId;\n\n\t\treturn oo;\n\t},\n\n\textractObject: function(o) {\n\t\tlet oo = null;\n\n\t\tif(o instanceof L.ImageOverlay) {\n\t\t\tlet nw = o.getBounds().getNorthWest(), se = o.getBounds().getSouthEast();\n\t\t\too = {\n\t\t\t\tid:\t\t\t\t\to.options.id,\n\t\t\t\tsceneId:\t\t\to.options.sceneId,\n\t\t\t\ttype:\t\t\t\t\"avatar\",\n\t\t\t\tpos:\t\t\t\t[[nw.lat, nw.lng], [se.lat, se.lng]],\n\t\t\t\tlabel:\t\t\t\to.options.label,\n\t\t\t\ticon:\t\t\t\to._url,\n\t\t\t\tratio:\t\t\t\to.options.ratio,\n\t\t\t\trounded:\t\t\to.options.rounded,\n\t\t\t\tangle:\t\t\t\t0,\n\t\t\t\tborderColor:\t\to.options.borderColor,\n\t\t\t\tborderThickness:\to.options.borderThickness,\n\t\t\t\tblur:\t\t\t\to.options.overlayBlur,\n\t\t\t\tgrayscale:\t\t\to.options.overlayGrayscale,\n\t\t\t\tbrightness:\t\t\to.options.overlayBrightness,\n\t\t\t\ttransparency:\t\to.options.overlayTransparency,\n\t\t\t\tanimationspeed:\t\to.options.animationspeed\n\t\t\t};\n\t\t}else\n\t\tif(o instanceof L.Polygon) {\n\t\t\too = {\n\t\t\t\tid:\t\t\t\t\to.options.id,\n\t\t\t\tsceneId:\t\t\to.options.sceneId,\n\t\t\t\ttype:\t\t\t\to instanceof L.Rectangle ? \"rectangle\" : \"polygon\",\n\t\t\t\tpos:\t\t\t\to.getLatLngs(),\n\t\t\t\tlabel:\t\t\t\to.options.label,\n\t\t\t\tdashed:\t\t\t\t!!o.options.dashArray,\n\t\t\t\tlineColor:\t\t\to.options.color,\n\t\t\t\tlineThickness:\t\to.options.weight,\n\t\t\t\tlineTransparency:\t1 - o.options.opacity,\n\t\t\t\tfillColor:\t\t\to.options.fillColor,\n\t\t\t\tfillTransparency:\t1 - o.options.fillOpacity,\n\t\t\t\tanimationspeed:\t\to.options.animationspeed\n\t\t\t};\n\t\t}else\n\t\tif(o instanceof L.Polyline) {\n\t\t\too = {\n\t\t\t\tid:\t\t\t\to.options.id,\n\t\t\t\tsceneId:\t\to.options.sceneId,\n\t\t\t\ttype:\t\t\t\"polyline\",\n\t\t\t\tpos:\t\t\to.getLatLngs(),\n\t\t\t\tlabel:\t\t\to.options.label,\n\t\t\t\tdashed:\t\t\t!!o.options.dashArray,\n\t\t\t\tcolor:\t\t\to.options.color,\n\t\t\t\tthickness:\t\to.options.weight,\n\t\t\t\ttransparency:\t1 - o.options.opacity,\n\t\t\t\tanimationspeed:\to.options.animationspeed\n\t\t\t};\n\t\t}else\n\t\tif(o instanceof L.Circle) {\n\t\t\tlet p = o.getLatLng();\n\t\t\too = {\n\t\t\t\tid:\t\t\t\t\to.options.id,\n\t\t\t\tsceneId:\t\t\to.options.sceneId,\n\t\t\t\ttype:\t\t\t\t\"circle\",\n\t\t\t\tpos:\t\t\t\t[ p.lat, p.lng ],\n\t\t\t\tradius:\t\t\t\to.getRadius(),\n\t\t\t\tlabel:\t\t\t\to.options.label,\n\t\t\t\tdashed:\t\t\t\t!!o.options.dashArray,\n\t\t\t\tlineColor:\t\t\to.options.color,\n\t\t\t\tlineThickness:\t\to.options.weight,\n\t\t\t\tlineTransparency:\t1 - o.options.opacity,\n\t\t\t\tfillColor:\t\t\to.options.fillColor,\n\t\t\t\tfillTransparency:\t1 - o.options.fillOpacity,\n\t\t\t\tanimationspeed:\t\to.options.animationspeed\n\t\t\t};\n\t\t}else{ console.error(\"object type invalid\"); }\n\n\t\treturn oo;\n\t},\n\n\timportData: function(data) {\n\t\tfor(let i = 0; i < data.length; i++) {\n\t\t\tthis.objects.push( data[i] );\n\t\t}\n\t},\n\n\texportData: function() { return this.objects; }\n\n});\n","/*******************************************************************************\n* Copyright (C) Nordfjord EDB AS - All Rights Reserved                         *\n*                                                                              *\n* Unauthorized copying of this file, via any medium is strictly prohibited     *\n* Proprietary and confidential                                                 *\n* Written by Andreas Atakan <aca@geotales.io>, January 2022                  *\n*******************************************************************************/\n\n\"use strict\";\n\n\nL.FadeLayer = L.FeatureGroup.extend({\n\taddLayer: function(o, id) {\n\t\tL.FeatureGroup.prototype.addLayer.call(this, o);\n\t\tif(id && !o.options.id) { o.options.id = id; }\n\t\to.options.pmIgnore = true;\n\n\t\tif(o instanceof L.ImageOverlay) {\n\t\t\to.setOpacity( 0.3 );\n\t\t\t$(o._image).css(\"border-radius\", o.options.rounded ? \"50%\" : \"0\");\n\t\t\t//$(o._image).css(\"transform\", `rotate(${o.options.angle}deg)`);\n\t\t\t$(o._image).css(\"border\", `${o.options.borderThickness}px solid ${o.options.borderColor}`);\n\t\t\t$(o._image).css(\"filter\", `\n\t\t\t\tblur(${o.options.overlayBlur}px)\n\t\t\t\tgrayscale(${o.options.overlayGrayscale * 100}%)\n\t\t\t`);\n\t\t}else{\n\t\t\to.setStyle({ opacity: 0.3 });\n\t\t\to.setStyle({ fillOpacity: 0.2 });\n\t\t}\n\t\to.on(\"click\", ev => { _MAP.insertObject(o); });\n\t},\n\n\tgetObject: function(id) {\n\t\tfor(let o of this.getLayers()) {\n\t\t\tif(o.options.id == id) { return o; }\n\t\t}\n\t\treturn null;\n\t},\n\n\tremoveLayer: function(o, id) {\n\t\tvar o = o || (id ? this.getObject(id) : null);\n\t\tif(!o) { return; }\n\t\to.off(\"click\");\n\t\tL.FeatureGroup.prototype.removeLayer.call(this, o);\n\t},\n\n\tinitialize: function(options) {\n\t\tL.FeatureGroup.prototype.initialize.call(this);\n\t\tthis.options.id = \"0\";\n\t\tthis.options = Object.assign({}, this.options, options);\n\t}\n});\nL.fadeLayer = function(options) { return new L.FadeLayer(options); };\n\n\nL.ImageOverlay.include({\n\t__toGeoJSON: function() {\n\t\tif(!this._map) { return; }\n\n\t\tlet nw = this.getBounds().getNorthWest(),\n\t\t\tse = this.getBounds().getSouthEast();\n\t\tlet r = {\n\t\t\t\"type\": \"Feature\",\n\t\t\t\"properties\": {\n\t\t\t\t\"type\":\t\t\t\t\"avatar\",\n\t\t\t\t\"label\":\t\t\tthis.options.label,\n\t\t\t\t\"icon\":\t\t\t\tthis._url,\n\t\t\t\t\"ratio\":\t\t\tthis.options.ratio,\n\t\t\t\t\"rounded\":\t\t\tthis.options.rounded,\n\t\t\t\t\"angle\":\t\t\t0,\n\t\t\t\t\"borderColor\":\t\tthis.options.borderColor,\n\t\t\t\t\"borderThickness\":\tthis.options.borderThickness,\n\t\t\t\t\"blur\":\t\t\t\tthis.options.overlayBlur,\n\t\t\t\t\"grayscale\":\t\tthis.options.overlayGrayscale,\n\t\t\t\t\"brightness\":\t\tthis.options.overlayBrightness,\n\t\t\t\t\"transparency\":\t\tthis.options.overlayTransparency\n\t\t\t},\n\t\t\t\"geometry\": {\n\t\t\t\t\"type\": \"Polygon\",\n\t\t\t\t\"coordinates\": [ [nw.lat, nw.lng], [se.lat, se.lng] ]\n\t\t\t}\n\t\t};\n\t\treturn r;\n\t}\n});\n\nL.Polyline.include({\n\t__toGeoJSON: function() {\n\t\tif(!this._map) { return; }\n\n\t\tlet r = L.Polyline.prototype.toGeoJSON.call(this);\n\t\tr.properties = {\n\t\t\t\"type\":\t\t\t\"polyline\",\n\t\t\t\"label\":\t\tthis.options.label,\n\t\t\t\"dashed\":\t\t!!this.options.dashArray,\n\t\t\t\"color\":\t\tthis.options.color,\n\t\t\t\"thickness\":\tthis.options.weight,\n\t\t\t\"transparency\":\t1 - this.options.opacity\n\t\t};\n\t\treturn r;\n\t}\n});\n\nL.Polygon.include({\n\t__toGeoJSON: function() {\n\t\tif(!this._map) { return; }\n\n\t\tlet r = L.Polygon.prototype.toGeoJSON.call(this);\n\t\tr.properties = {\n\t\t\ttype:\t\t\t\tthis instanceof L.Rectangle ? \"rectangle\" : \"polygon\",\n\t\t\tlabel:\t\t\t\tthis.options.label,\n\t\t\tdashed:\t\t\t\t!!this.options.dashArray,\n\t\t\tlineColor:\t\t\tthis.options.color,\n\t\t\tlineThickness:\t\tthis.options.weight,\n\t\t\tlineTransparency:\t1 - this.options.opacity,\n\t\t\tfillColor:\t\t\tthis.options.fillColor,\n\t\t\tfillTransparency:\t1 - this.options.fillOpacity\n\t\t};\n\t\treturn r;\n\t}\n});\n\nL.Circle.include({\n\t__toGeoJSON: function() {\n\t\tif(!this._map) { return; }\n\n\t\tlet r = L.Circle.prototype.toGeoJSON.call(this);\n\t\tr.properties = {\n\t\t\t\"type\":\t\t\t\t\"circle\",\n\t\t\t\"radius\":\t\t\tthis.getRadius(),\n\t\t\t\"label\":\t\t\tthis.options.label,\n\t\t\t\"dashed\":\t\t\t!!this.options.dashArray,\n\t\t\t\"lineColor\":\t\tthis.options.color,\n\t\t\t\"lineThickness\":\tthis.options.weight,\n\t\t\t\"lineTransparency\":\t1 - this.options.opacity,\n\t\t\t\"fillColor\":\t\tthis.options.fillColor,\n\t\t\t\"fillTransparency\":\t1 - this.options.fillOpacity\n\t\t};\n\t\treturn r;\n\t}\n});\n\n\n\n\n\n\n\n\nexport function bind_setup(o) {\n\n\t$(\".objectPopup input#label\").change(function(ev) {\n\t\tlet val = $(this).val();\n\n\t\tif(val) {\n\t\t\tif(!o.getTooltip()) {\n\t\t\t\to.bindTooltip( L.tooltip({ direction: \"center\", permanent: true }, o) );\n\t\t\t\tif(o instanceof L.ImageOverlay) { _MAP.updateTooltip(o); }\n\t\t\t}\n\t\t\to.setTooltipContent(val);\n\t\t}\n\t\telse{ o.unbindTooltip(); }\n\n\t\to.options.label = val;\n\t\t_MAP.updateObject(o);\n\t});\n\t$(\".objectPopup input#label\").val(o.options.label || \"\");\n\n\tif(o instanceof L.ImageOverlay) {\n\t\t$(\"#avatarPopup #iconChoose #iconCol\").remove();\n\t\tfor(let i of _ICONS.slice().reverse()) {\n\t\t\t$(\"#avatarPopup #iconChoose\").prepend(`\n\t\t\t\t<div class=\"col\" id=\"iconCol\">\n\t\t\t\t\t<img class=\"img-fluid rounded\" id=\"icons\" src=\"${i}\" alt=\"&nbsp;\" />\n\t\t\t\t</div>\n\t\t\t`);\n\t\t}\n\n\t\t$(\"input#_img_icon\").off(\"change\");\n\t\t$(\"input#_img_icon\").change(function(ev) {\n\t\t\tlet file = $(this)[0].files[0];\n\t\t\tif(!file) { return; }\n\n\t\t\t$(\"#loadingModal\").modal(\"show\");\n\n\t\t\tlet fr = new FileReader();\n\t\t\tfr.onload = async function() {\n\t\t\t\tlet img = new Image();\n\t\t\t\timg.src = fr.result;\n\t\t\t\tawait img.decode();\n\n\t\t\t\t$(\"#avatarPopup input#rounded\").prop(\"checked\", false);\n\t\t\t\t// TODO: Also set rotation-angle input to 0\n\n\t\t\t\to.options.ratio = img.width / img.height || 1;\n\t\t\t\to.options.rounded = false;\n\t\t\t\to.options.angle = 0;\n\n\t\t\t\tlet data = new FormData();\n\t\t\t\tdata.append(\"op\", \"create\");\n\t\t\t\tdata.append(\"type\", \"icon\");\n\t\t\t\tdata.append(\"image\", file);\n\n\t\t\t\t$.ajax({\n\t\t\t\t\ttype: \"POST\",\n\t\t\t\t\turl: \"api/upload.php\",\n\t\t\t\t\tdata: data,\n\t\t\t\t\tcontentType: false,\n\t\t\t\t\tprocessData: false,\n\t\t\t\t\tsuccess: function(result, status, xhr) {\n\t\t\t\t\t\t_ICONS.unshift(result);\n\t\t\t\t\t\t_MAP.setIcon(o, [ 35, 35 / o.options.ratio ], result);\n\t\t\t\t\t\t_MAP.updateObject(o);\n\n\t\t\t\t\t\tsetTimeout(function() { $(\"#loadingModal\").modal(\"hide\"); }, 750);\n\t\t\t\t\t},\n\t\t\t\t\terror: function(xhr, status, error) {\n\t\t\t\t\t\tconsole.error(xhr.status, error);\n\t\t\t\t\t\tsetTimeout(function() { $(\"#loadingModal\").modal(\"hide\"); $(\"#errorModal\").modal(\"show\"); }, 750);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t};\n\t\t\tfr.readAsDataURL(file);\n\t\t});\n\t\t$(\"#avatarPopup #iconChoose #iconAdd\").click(ev => { $(\"input#_img_icon\").click(); });\n\n\t\t$(\"#avatarPopup #iconChoose #icons\").click(async function(ev) {\n\t\t\tlet val = $(this).prop(\"src\");\n\n\t\t\tlet img = new Image();\n\t\t\timg.src = val;\n\t\t\tawait img.decode();\n\n\t\t\to.options.ratio = img.width / img.height || 1;\n\t\t\t_MAP.setIcon(o, [ 35, 35 / o.options.ratio ], val);\n\t\t\t_MAP.updateObject(o);\n\t\t});\n\n\t\t$(\"#avatarPopup input#size\").change(function(ev) {\n\t\t\tlet val = Math.min( Math.max( $(this).prop(\"min\"), $(this).val() ), $(this).prop(\"max\") );\n\n\t\t\t_MAP.setIcon(o, [ val, val / o.options.ratio ]);\n\t\t\t_MAP.updateObject(o);\n\t\t});\n\n\t\t$(\"#avatarPopup input#rounded\").change(function(ev) {\n\t\t\to.options.rounded = this.checked;\n\n\t\t\t_MAP.updateObject(o);\n\t\t\t_MAP.setIcon(o);\n\t\t});\n\t\t$(\"#avatarPopup input#rounded\").prop(\"checked\", o.options.rounded);\n\n\t\t$(\"#avatarPopup input#color\").change(function(ev) {\n\t\t\tlet val = $(this).val();\n\n\t\t\to.options.borderColor = val;\n\t\t\t_MAP.updateObject(o);\n\t\t\t_MAP.setIcon(o);\n\t\t});\n\t\t$(\"#avatarPopup input#color\").val(o.options.borderColor || \"#563d7c\");\n\n\t\t$(\"#avatarPopup input#thickness\").change(function(ev) {\n\t\t\tlet val = Math.min( Math.max( $(this).prop(\"min\"), $(this).val() ), $(this).prop(\"max\") );\n\n\t\t\to.options.borderThickness = val;\n\t\t\t_MAP.updateObject(o);\n\t\t\t_MAP.setIcon(o);\n\t\t});\n\n\t\t$(\"#avatarPopup input#blur\").change(function(ev) {\n\t\t\tlet val = Math.min( Math.max( $(this).prop(\"min\"), $(this).val() ), $(this).prop(\"max\") );\n\n\t\t\to.options.overlayBlur = val;\n\t\t\t_MAP.updateObject(o);\n\t\t\t_MAP.setIcon(o);\n\t\t});\n\n\t\t$(\"#avatarPopup input#grayscale\").change(function(ev) {\n\t\t\tlet val = Math.min( Math.max( $(this).prop(\"min\"), $(this).val() ), $(this).prop(\"max\") );\n\n\t\t\to.options.overlayGrayscale = val;\n\t\t\t_MAP.updateObject(o);\n\t\t\t_MAP.setIcon(o);\n\t\t});\n\n\t\t$(\"#avatarPopup input#brightness\").change(function(ev) {\n\t\t\tlet val = Math.min( Math.max( $(this).prop(\"min\"), $(this).val() ), $(this).prop(\"max\") );\n\n\t\t\to.options.overlayBrightness = val;\n\t\t\t_MAP.updateObject(o);\n\t\t\t_MAP.setIcon(o);\n\t\t});\n\n\t\t$(\"#avatarPopup input#transparency\").change(function(ev) {\n\t\t\tlet val = Math.min( Math.max( $(this).prop(\"min\"), $(this).val() ), $(this).prop(\"max\") );\n\n\t\t\to.options.overlayTransparency = val;\n\t\t\t_MAP.updateObject(o);\n\t\t\t_MAP.setIcon(o);\n\t\t});\n\t}else\n\tif(o instanceof L.Path) {\n\t\t$(\"#shapePopup input#dashed\").change(function(ev) {\n\t\t\to.setStyle({ dashArray: this.checked ? \"5, 10\" : \"\" });\n\t\t\t_MAP.updateObject(o);\n\t\t});\n\t\t$(\"#shapePopup input#dashed\").prop(\"checked\", !!o.options.dashArray);\n\n\t\t$(\"#shapePopup input#lineColor\").change(function(ev) {\n\t\t\to.setStyle({ color: $(this).val() });\n\t\t\t_MAP.updateObject(o);\n\t\t});\n\t\t$(\"#shapePopup input#lineColor\").val(o.options.color || \"#563d7c\");\n\n\t\t$(\"#shapePopup input#lineThickness\").change(function(ev) {\n\t\t\to.setStyle({\n\t\t\t\tweight: Math.min( Math.max( $(this).prop(\"min\"), $(this).val() ), $(this).prop(\"max\") )\n\t\t\t});\n\t\t\t_MAP.updateObject(o);\n\t\t});\n\n\t\t$(\"#shapePopup input#lineTransparency\").change(function(ev) {\n\t\t\to.setStyle({\n\t\t\t\topacity: 1 - Math.min( Math.max( $(this).prop(\"min\"), $(this).val() ), $(this).prop(\"max\") )\n\t\t\t});\n\t\t\t_MAP.updateObject(o);\n\t\t});\n\n\t\tif(o instanceof L.Rectangle\n\t\t|| o instanceof L.Polygon\n\t\t|| o instanceof L.Circle) {\n\t\t\t$(\"#shapePopup input#fillColor\").change(function(ev) {\n\t\t\t\to.setStyle({ fillColor: $(this).val() });\n\t\t\t\t_MAP.updateObject(o);\n\t\t\t});\n\t\t\t$(\"#shapePopup input#fillColor\").val(o.options.fillColor || \"#563d7c\");\n\n\t\t\t$(\"#shapePopup input#fillTransparency\").change(function(ev) {\n\t\t\t\to.setStyle({\n\t\t\t\t\tfillOpacity: 1 - Math.min( Math.max( $(this).prop(\"min\"), $(this).val() ), $(this).prop(\"max\") )\n\t\t\t\t});\n\t\t\t\t_MAP.updateObject(o);\n\t\t\t});\n\t\t}\n\t}else{ console.error(\"object type invalid\"); }\n\n\t$(\".objectPopup input#animationSpeed\").change(function(ev) {\n\t\to.options.animationspeed = Math.min( Math.max( $(this).prop(\"min\"), $(this).val() ), $(this).prop(\"max\") ) * 1000;\n\t\t_MAP.updateObject(o);\n\t});\n\n\t$(\".objectPopup #makeGlobal\").click(function(ev) {\n\t\t_MAP.globalObjectOptions(o);\n\t});\n}\n"],"names":["$aykGt","parcelRequire","window","onload","ev","document","addEventListener","scale","preventDefault","resizeTimer","$","on","trigger","clearTimeout","setTimeout","_MAP","setAspectRatio","_SCENES","$gUPg4","Scenes","keydown","indexOf","code","keyup","keycode","prev","next","click","add","capture","delete","modal","_TEXTBOXES","$aDjZZ","Textboxes","L","map","center","zoom","innerWidth","zoomControl","maxZoom","doubleClickZoom","zoomAnimationThreshold","wheelPxPerZoomLevel","keyboard","tap","boxZoom","contextmenu","contextmenuItems","text","callback","navigator","clipboard","writeText","latlng","lat","lng","panTo","icon","zoomIn","zoomOut","setup","reset","change","_OPTIONS","animationspeed","this","val","panningspeed","eval","value","objectOptIn","checked","init_basemaps","file","target","files","data","FormData","append","ajax","type","url","contentType","processData","success","async","result","status","xhr","setBasemap","img","_BASEMAPS","push","name","tiles","preview","error","console","split","username","styleID","key","layers","format","version","setWMS","transparent","fr","FileReader","import_data","JSON","parse","readAsText","options","lineColor","lineThickness","lineTransparency","fillColor","fillTransparency","export_data","save_data","setInterval","op","id","_ID","password","dataType","unsaved_changes","r","_ICONS","unshift","ref","$4XDZb","$7aed1fc953746074$export$31b40729666a4ae0","a","Math","random","toString","replace","$7aed1fc953746074$export$3b2ba0326b56a54c","prop","scenes","length","store","dispatchEvent","Event","importData","textboxes","objects","current","$7aed1fc953746074$var$import_project","f","features","o","t","Array","isArray","v","reverse","pos","geometry","coordinates","properties","sceneId","active","label","ratio","rounded","angle","borderColor","borderThickness","blur","overlayBlur","grayscale","overlayGrayscale","brightness","overlayBrightness","transparency","overlayTransparency","dashed","color","thickness","radius","getMaxZoom","getZoom","object","createObject","addLayer","fire","layer","extractObject","$7aed1fc953746074$var$import_geojson","$7aed1fc953746074$var$export_project","stringify","exportData","$7aed1fc953746074$var$running","$7aed1fc953746074$export$b9e8c15d1f8b68a8","el","createElement","date","Date","y","getFullYear","m","getMonth","d","getDate","H","getHours","M","getMinutes","S","getSeconds","filename","_TITLE","encodeURIComponent","getLayers","__toGeoJSON","$7aed1fc953746074$var$export_geojson","setAttribute","style","display","body","appendChild","ready","removeChild","$7aed1fc953746074$export$8915d34f81494a91","getCenterBasemapTile","off","$7aed1fc953746074$export$d36ebd2686ed6eb9","returnValue","$7aed1fc953746074$export$6c9368fbe350f308","addClass","removeClass","$7aed1fc953746074$var$bind_basemaps","index","$7aed1fc953746074$export$4c0c65daf5a0e159","generate_basemaps","$7aed1fc953746074$export$827cb160439a2d7c","w","h","_w","$39cbb0745d491746$export$28821553ef8d960f","prevId","cont","after","$39cbb0745d491746$export$d3ba155dc3b68019","isUpload","html","i","b","$39cbb0745d491746$export$d4a4f44bb1d49f04","$39cbb0745d491746$export$3d6e93c41a574db9","$39cbb0745d491746$export$b06e432f08e15d50","$c509a32349fb613e$export$b4dfb75ee92ddb88","copiedBounds","sortable","cursor","handle","items","containment","tolerance","cancel","zIndex","axis","start","ui","stopPropagation","unbind","update","reorder","stop","bind","get","s","Object","assign","getEl","contains","getPrevScene","order","sort","set","$c509a32349fb613e$var$Scene","splice","addScene","flash_map","deleteScene","remove","setNumbering","hasClass","disable","enable","scrollIntoView","behavior","inline","setBookmark","n","copyBounds","bounds","pasteBounds","setBounds","wms","basemap","bookmark","setTitle","title","uuid","new_scene","setFlyTo","getWMS","getBasemap","nw","getBounds","getNorthWest","se","getSouthEast","$7bdd0f4539e9845d$export$1148a9c69cac2f12","trumbowyg","cmd","param","forceCss","skipTrumbowyg","log","setLock","setOrientation","resizable","handles","minWidth","size","width","outerWidth","dim","css","left","autogrow","semantic","resetCss","removeformatPasted","urlProtocol","defaultLinkTarget","tagsToRemove","btnsDef","dropdown","ico","align","uploadImg","fn","makeLink","btns","plugins","content","$7bdd0f4539e9845d$var$Textbox","locked","tt","l","right","disabled","textboxButton","Map","addInitHook","returnButton","Control","zoomHome","position","zoomHomeIcon","zoomHomeTitle","addControl","basemapButton","easyButton","leafletClasses","states","stateName","onClick","button","init_img_basemaps","pm","addControls","drawCircleMarker","drawText","oneBlock","setPathOptions","weight","opacity","fillOpacity","setGlobalOptions","markerStyle","iconUrl","iconSize","popupAnchor","tooltipAnchor","setLang","tooltips","placeMarker","buttonTitles","drawMarkerButton","disableDraw","fadeLayer","pmIgnore","shape","p","project","getLatLng","getIcon","removeLayer","imageOverlay","unproject","x","interactive","bindTooltip","direction","permanent","ImageOverlay","updateTooltip","updateObject","closeTooltip","openTooltip","deleteObject","unbindTooltip","closePopup","unbindPopup","slideCancel","setPopup","$5WMrM","bind_setup","highlightObject","unhighlightObject","bringToFront","bringToBack","cloneAvatar","setIcon","bindContextMenu","_renderer","_reset","include","enableDraw","clearLayers","Toolbar","setButtonDisabled","setPosition","setBlockPosition","setHomeBounds","aspectratio","outerHeight","get_aspect_ratio_dimentions","height","top","invalidateSize","flyToBounds","noMoveStart","duration","getGeomanLayers","filter","getObject","setOpacity","setStyle","setObjects","os","o1","rad","oo","oo1","slideTo","insertObject","oo2","globalObjectOptions","Circle","c","getCenter","setUrl","_image","popup","avatar_popup","Rectangle","Polygon","polygon_popup","Polyline","polyline_popup","bindPopup","keepInView","closeOnEscapeKey","maxWidth","maxHeight","getTooltip","latLngToContainerPoint","distanceTo","getSouthWest","offset","_url","source","TileLayer","WMS","tileLayer","minZoom","attribution","getTileSize","getTileUrl","floor","e","_HOST","Image","src","decode","tlp","brp","containerPointToLatLng","p1","presetZoom","resetBasemap","min","max","setZoom","setMinZoom","setMaxZoom","polyline","dashArray","polygon","rectangle","circle","getLatLngs","getRadius","$4547f3162a1b3a07$export$27a752e5ac5fffb5","tooltip","setTooltipContent","slice","prepend","readAsDataURL","Path","FadeLayer","FeatureGroup","extend","prototype","call","initialize","_map","toGeoJSON"],"version":3,"file":"main.js.map"}