{"mappings":"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","sources":["edit/js/main.js","edit/js/helpers.js","edit/js/generate.js","edit/js/scenes.js","edit/js/textboxes.js","edit/js/map/map.js","edit/js/map/layers.js"],"sourcesContent":["/*******************************************************************************\n* Copyright (C) Nordfjord EDB AS - All Rights Reserved                         *\n*                                                                              *\n* Unauthorized copying of this file, via any medium is strictly prohibited     *\n* Proprietary and confidential                                                 *\n* Written by Andreas Atakan <aca@geotales.io>, January 2022                  *\n*******************************************************************************/\n\n\"use strict\";\n\nimport {\n\timport_data,\n\texport_data,\n\tsave_data,\n\tunsaved_changes,\n\tinit_basemaps\n} from \"./helpers.js\";\n\nimport { Scenes } from \"./scenes.js\";\nimport { Textboxes } from \"./textboxes.js\";\n\nimport \"./map/map.js\";\n\n\nwindow.onload = function(ev) {\n\n\t// Disable mobile pinch-zoom\n\tdocument.addEventListener(\"touchmove\", function(ev) {\n\t\tif(ev.scale !== 1) { ev.preventDefault(); }\n\t}, false);\n\n\t// Set up window resize start/end events\n\tlet resizeTimer = false;\n\t$(window).on(\"resize\", function(ev) {\n\t\tif( !resizeTimer ) { $(window).trigger(\"resizestart\"); }\n\t\tclearTimeout(resizeTimer);\n\t\tresizeTimer = setTimeout(function() {\n\t\t\tresizeTimer = false;\n\t\t\t$(window).trigger(\"resizeend\");\n\t\t}, 250);\n\t}).on(\"resizeend\", function() { _MAP.setAspectRatio(); });\n\n\n\n\t_SCENES = new Scenes();\n\n\t$(\"#sceneRow\").keydown(ev => { if([\"ArrowUp\", \"ArrowDown\", \"ArrowRight\", \"ArrowLeft\", \"Space\"].indexOf(ev.code) > -1) { ev.preventDefault(); } });\n\t$(\"#sceneRow\").keyup(ev => {\n\t\tlet keycode = ev.code;\n\t\tif(keycode == \"ArrowLeft\") { ev.preventDefault(); _SCENES.prev(); }\n\t\tif(keycode == \"ArrowRight\") { ev.preventDefault(); _SCENES.next(); }\n\t\tif([\"ArrowUp\", \"ArrowDown\", \"ArrowRight\", \"ArrowLeft\", \"Space\"].indexOf(keycode) > -1) { ev.preventDefault(); }\n\t});\n\n\t$(\"#sceneRow button#add\").click(ev => { _SCENES.add(); });\n\t$(\"#sceneRow button#recapture\").click(ev => { _SCENES.capture(); });\n\t$(\"#sceneWarningModal button#delete\").click(ev => { _SCENES.delete(); $(\"#sceneWarningModal\").modal(\"hide\"); });\n\n\n\t_TEXTBOXES = new Textboxes();\n\n\n\t_MAP = L.map(\"map\", {\n\t\tcenter: [ 49, 14 ],\n\t\tzoom: window.innerWidth < 575.98 ? 3 : 5,\n\t\tzoomControl: false,\n\t\tmaxZoom: 18,\n\t\tdoubleClickZoom: false,\n\t\tzoomAnimationThreshold: 100,\n\t\twheelPxPerZoomLevel: 1500,\n\t\tkeyboard: false,\n\t\ttap: false,\n\t\tboxZoom: false,\n\t\t//touchZoom: false,\n\t\t//worldCopyJump: true\n\n\t\tcontextmenu: true,\n\t\tcontextmenuItems: [\n\t\t\t{ text: \"Copy coordinates\", callback: ev => { navigator.clipboard.writeText( `${ev.latlng.lat}, ${ev.latlng.lng}` ); } },\n\t\t\t{ text: \"Center map here\", callback: ev => { _MAP.panTo(ev.latlng); } },\n\t\t\t\"-\",\n\t\t\t{ text: \"Zoom in\", icon: \"assets/zoom-in.png\", callback: ev => { _MAP.zoomIn(); } },\n\t\t\t{ text: \"Zoom out\", icon: \"assets/zoom-out.png\", callback: ev => { _MAP.zoomOut(); } }\n\t\t]\n\t});\n\n\tdocument.addEventListener(\"_setup\", ev => {\n\t\t_MAP.setup(); _TEXTBOXES.setup(); _SCENES.setup();\n\t});\n\tdocument.addEventListener(\"_reset\", ev => {\n\t\t_SCENES.reset(); _TEXTBOXES.reset(); _MAP.reset();\n\t});\n\n\n\n\t$(\"#optionsModal input#animationSpeed\").change(function(ev) { _OPTIONS.animationspeed = $(this).val() * 1000; });\n\t$(\"#optionsModal input#panningSpeed\").change(function(ev) { _OPTIONS.panningspeed = $(this).val() || null; });\n\t$(\"#optionsModal select#aspectRatio\").change(function(ev) { _MAP.setAspectRatio( eval( this.value ) ); });\n\t$(\"#optionsModal input#objectsOptIn\").change(function(ev) { _OPTIONS.objectOptIn = this.checked; });\n\n\n\n\tinit_basemaps();\n\n\t$(\"#basemapModal input#basemapFile\").change(ev => {\n\t\tlet file = $(ev.target)[0].files[0];\n\t\tif(!file) { return; }\n\n\t\t$(\"#loadingModal\").modal(\"show\");\n\n\t\tlet data = new FormData();\n\t\tdata.append(\"type\", \"basemap\");\n\t\tdata.append(\"image\", file);\n\n\t\t$.ajax({\n\t\t\ttype: \"POST\",\n\t\t\turl: \"api/upload_create.php\",\n\t\t\tdata: data,\n\t\t\tcontentType: false,\n\t\t\tprocessData: false,\n\t\t\tsuccess: async function(result, status, xhr) {\n\t\t\t\tawait _MAP.setBasemap({ type: \"image\", img: result });\n\t\t\t\t_SCENES.setBasemap();\n\t\t\t\t_BASEMAPS.push({\n\t\t\t\t\tname: \"\",\n\t\t\t\t\ttiles: { type: \"image\", img: result },\n\t\t\t\t\tpreview: result\n\t\t\t\t});\n\t\t\t\tsetTimeout(function() { $(\"#loadingModal\").modal(\"hide\"); }, 750);\n\t\t\t},\n\t\t\terror: function(xhr, status, error) {\n\t\t\t\tconsole.error(xhr.status, error);\n\t\t\t\tsetTimeout(function() { $(\"#loadingModal\").modal(\"hide\"); $(\"#errorModal\").modal(\"show\"); }, 750);\n\t\t\t}\n\t\t});\n\t});\n\n\t$(\"#basemapModal button#basemapFetch\").click(ev => {\n\t\tlet url = $(\"#basemapModal input#basemapLink\").val();\n\t\tif(!url) { return; }\n\n\t\tlet protocol = url.split(/\\:/ig)[0];\n\t\tif(protocol == \"mapbox\") {\n\t\t\tlet username = url.split(/mapbox\\:\\/\\/styles\\//ig)[1].split(/\\//ig)[0], styleID = url.split(/mapbox\\:\\/\\/styles\\//ig)[1].split(/\\//ig)[1],\n\t\t\t\tkey = $(\"#basemapModal input#basemapKey\").val();\n\t\t\tif(!key) { return; }\n\n\t\t\turl = `https://api.mapbox.com/styles/v1/${username}/${styleID}/tiles/256/{z}/{x}/{y}?access_token=${key}`;\n\t\t}\n\n\t\t_MAP.setBasemap({ type: \"tiles\", url: url });\n\t\t_SCENES.setBasemap();\n\t});\n\n\t$(\"#basemapModal button#wmsAdd\").click(ev => {\n\t\tlet url = $(\"#basemapModal input#wmsLink\").val(),\n\t\t\tlayers = $(\"#basemapModal input#wmsLayer\").val(),\n\t\t\tformat = $(\"#basemapModal select#wmsFormat\").val(),\n\t\t\tversion = $(\"#basemapModal select#wmsVersion\").val();\n\t\tif(!url || !layers) { return; }\n\n\t\t_MAP.setWMS({\n\t\t\ttype: \"wms\",\n\t\t\turl: url,\n\t\t\tlayers: layers,\n\t\t\tformat: format,\n\t\t\tversion: version,\n\t\t\ttransparent: format == \"image/png\"\n\t\t});\n\t\t_SCENES.setWMS();\n\t});\n\t$(\"#basemapModal button#wmsRemove\").click(ev => {\n\t\t_MAP.setWMS(null);\n\t\t_SCENES.setWMS();\n\t});\n\n\n\n\t$(\"#projectFileInput\").change(ev => {\n\t\tlet file = $(ev.target)[0].files[0];\n\t\tif(!file) { return; }\n\n\t\tlet fr = new FileReader();\n\t\tfr.onload = function() { import_data( \"project\", JSON.parse( fr.result ) ); };\n\t\tfr.readAsText(file);\n\t});\n\t$(\"#geojsonImportModal button#import\").click(ev => {\n\t\t$(\"#geojsonImportModal\").modal(\"hide\");\n\n\t\tlet file = $(\"#geojsonImportModal input#fileInput\")[0].files[0];\n\t\tif(!file) { return; }\n\n\t\tlet options = {\n\t\t\tlineColor: $(\"#geojsonImportModal #lineColor\").val(),\n\t\t\tlineThickness: $(\"#geojsonImportModal #lineThickness\").val() || 3,\n\t\t\tlineTransparency: $(\"#geojsonImportModal #lineTransparency\").val(),\n\t\t\tfillColor: $(\"#geojsonImportModal #fillColor\").val(),\n\t\t\tfillTransparency: $(\"#geojsonImportModal #fillTransparency\").val() || 0.8\n\t\t};\n\n\t\tlet fr = new FileReader();\n\t\tfr.onload = function() { import_data( \"geojson\", JSON.parse( fr.result ), options ); };\n\t\tfr.readAsText(file);\n\t});\n\t$(\"#gedcomImportModal button#import\").click(ev => {\n\t\t$(\"#gedcomImportModal\").modal(\"hide\");\n\n\t\tlet file = $(\"#gedcomImportModal input#fileInput\")[0].files[0];\n\t\tif(!file) { return; }\n\n\t\tlet options = {};\n\n\t\tlet fr = new FileReader();\n\t\tfr.onload = function() { import_data( \"gedcom\", fr.result, options ); };\n\t\tfr.readAsText(file);\n\t});\n\n\n\t$(\"button#export\").click(ev => {\n\t\texport_data( $(ev.target).data(\"type\") || null );\n\t});\n\n\t$(\"a#save\").click(ev => {\n\t\t$(\"#loadingModal\").modal(\"show\");\n\t\tsave_data(function() { $(\"#loadingModal\").modal(\"hide\"); });\n\t});\n\tsetInterval(save_data, 5 * 60 * 1000);\n\n\n\t$(\"#loadingModal\").modal(\"show\");\n\t$.ajax({\n\t\ttype: \"GET\",\n\t\turl: \"api/map_read.php\",\n\t\tdata: { \"id\": _ID, \"password\": \"\" },\n\t\tdataType: \"json\",\n\t\tsuccess: function(result, status, xhr) {\n\t\t\tif(result.data) { import_data( \"project\", JSON.parse(result.data) ); }\n\t\t\t$(`div#sceneRow,\n\t\t\t   div#mapRow,\n\t\t\t   .navbar .navbarContent li`).click(ev => { unsaved_changes(); });\n\n\t\t\tsetTimeout(function() { $(\"#loadingModal\").modal(\"hide\"); }, 750);\n\t\t},\n\t\terror: function(xhr, status, error) {\n\t\t\tconsole.error(xhr.status, error);\n\t\t\tsetTimeout(function() { $(\"#loadingModal\").modal(\"hide\"); $(\"#errorModal\").modal(\"show\"); }, 750);\n\t\t}\n\t});\n\n\t$.ajax({\n\t\ttype: \"GET\",\n\t\turl: \"api/upload_get.php\",\n\t\t//data: {},\n\t\tdataType: \"json\",\n\t\tsuccess: function(result, status, xhr) {\n\t\t\tfor(let r of result) {\n\t\t\t\tif(r.type == \"icon\") { _ICONS.unshift(r.ref); }\n\t\t\t\telse\n\t\t\t\tif(r.type == \"basemap\") {\n\t\t\t\t\t_BASEMAPS.push({\n\t\t\t\t\t\tname: \"\",\n\t\t\t\t\t\ttiles: { type: \"image\", img: r.ref },\n\t\t\t\t\t\tpreview: r.ref\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\terror: function(xhr, status, error) {\n\t\t\tconsole.error(xhr.status, error);\n\t\t}\n\t});\n\n};\n","/*******************************************************************************\n* Copyright (C) Nordfjord EDB AS - All Rights Reserved                         *\n*                                                                              *\n* Unauthorized copying of this file, via any medium is strictly prohibited     *\n* Proprietary and confidential                                                 *\n* Written by Andreas Atakan <aca@geotales.io>, January 2022                  *\n*******************************************************************************/\n\n\"use strict\";\n\nimport { generate_basemaps } from \"./generate.js\";\n\n\nexport function uuid(a) {\n\treturn a ? (a^Math.random()*16>>a/4).toString(16) : ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, uuid);\n}\n\n\n\nexport function sanitize(str) {\n\tlet map = {\n\t\t\"\\&\": \"&amp;\",\n\t\t\"\\<\": \"&lt;\",\n\t\t\"\\>\": \"&gt;\",\n\t\t\"\\\"\": \"&quot;\",\n\t\t\"\\'\": \"&#x27;\",\n\t\t\"\\/\": \"&#x2F;\"\n\t};\n\tlet reg = /[&<>\"'/]/ig;\n\treturn str.replace(reg, match => (map[match]));\n}\n\n\n\nfunction import_project(data) {\n\t_OPTIONS = data.options;\n\t$(\"#optionsModal input#animationSpeed\").val(_OPTIONS.animationspeed / 1000);\n\t$(\"#optionsModal input#panningSpeed\").val(_OPTIONS.panningspeed || null);\n\t$(\"#optionsModal input#objectsOptIn\").prop(\"checked\", _OPTIONS.objectOptIn);\n\n\tif(data.scenes.length <= 0) { return; }\n\n\tif(_SCENES.store.length <= 0) { document.dispatchEvent( new Event(\"_setup\") ); }\n\n\t_SCENES.importData(data.scenes);\n\t_TEXTBOXES.importData(data.textboxes);\n\t_MAP.importData(data.objects);\n\n\t_SCENES.current();\n}\nfunction import_geojson(data, options) {\n\tfor(let f of data.features) {\n\t\tlet o;\n\t\tlet t = a => {\n\t\t\tif(Array.isArray(a[0])) { for(let v of a) { t(v); } }\n\t\t\telse{ a.reverse(); }\n\t\t};\n\t\tlet pos = f.geometry.coordinates; t(pos);\n\n\t\tif(f.properties.type == \"avatar\") {\n\t\t\to = {\n\t\t\t\tid:\t\t\t\t\tuuid(),\n\t\t\t\tsceneId:\t\t\t_SCENES.active,\n\t\t\t\ttype:\t\t\t\t\"avatar\",\n\t\t\t\tpos:\t\t\t\tpos,\n\t\t\t\tlabel:\t\t\t\tf.properties.label,\n\t\t\t\ticon:\t\t\t\tf.properties.icon,\n\t\t\t\tratio:\t\t\t\tf.properties.ratio,\n\t\t\t\trounded:\t\t\tf.properties.rounded,\n\t\t\t\tangle:\t\t\t\tf.properties.angle,\n\t\t\t\tborderColor:\t\tf.properties.borderColor,\n\t\t\t\tborderThickness:\tf.properties.borderThickness,\n\t\t\t\tblur:\t\t\t\tf.properties.overlayBlur,\n\t\t\t\tgrayscale:\t\t\tf.properties.overlayGrayscale,\n\t\t\t\tbrightness:\t\t\tf.properties.overlayBrightness,\n\t\t\t\ttransparency:\t\tf.properties.overlayTransparency\n\t\t\t};\n\t\t}else\n\t\tif(f.properties.type == \"polyline\"\n\t\t|| f.geometry.type == \"LineString\"\n\t\t|| f.geometry.type == \"MultiLineString\") {\n\t\t\to = {\n\t\t\t\tid:\t\t\t\tuuid(),\n\t\t\t\tsceneId:\t\t_SCENES.active,\n\t\t\t\ttype:\t\t\t\"polyline\",\n\t\t\t\tpos:\t\t\tpos,\n\t\t\t\tlabel:\t\t\tf.properties.label,\n\t\t\t\tdashed:\t\t\tf.properties.dashed,\n\t\t\t\tcolor:\t\t\tf.properties.color || options.lineColor,\n\t\t\t\tthickness:\t\tf.properties.thickness || options.lineThickness,\n\t\t\t\ttransparency:\tf.properties.transparency || options.lineTransparency\n\t\t\t};\n\t\t}else\n\t\tif(f.properties.type == \"polygon\"\n\t\t|| f.properties.type == \"rectangle\"\n\t\t|| f.geometry.type == \"Polygon\"\n\t\t|| f.geometry.type == \"MultiPolygon\") {\n\t\t\to = {\n\t\t\t\tid:\t\t\t\t\tuuid(),\n\t\t\t\tsceneId:\t\t\t_SCENES.active,\n\t\t\t\ttype:\t\t\t\t\"polygon\",\n\t\t\t\tpos:\t\t\t\tpos,\n\t\t\t\tlabel:\t\t\t\tf.properties.label,\n\t\t\t\tdashed:\t\t\t\tf.properties.dashed,\n\t\t\t\tlineColor:\t\t\tf.properties.lineColor || options.lineColor,\n\t\t\t\tlineThickness:\t\tf.properties.lineThickness || options.lineThickness,\n\t\t\t\tlineTransparency:\tf.properties.lineTransparency || options.lineTransparency,\n\t\t\t\tfillColor:\t\t\tf.properties.fillColor || options.fillColor,\n\t\t\t\tfillTransparency:\tf.properties.fillTransparency || options.fillTransparency\n\t\t\t};\n\t\t}else\n\t\tif(f.properties.type == \"circle\"\n\t\t|| f.geometry.type == \"Point\") {\n\t\t\to = {\n\t\t\t\tid:\t\t\t\t\tuuid(),\n\t\t\t\tsceneId:\t\t\t_SCENES.active,\n\t\t\t\ttype:\t\t\t\t\"circle\",\n\t\t\t\tpos:\t\t\t\tpos,\n\t\t\t\tradius:\t\t\t\tf.properties.radius || 4000 * (_MAP.getMaxZoom() - _MAP.getZoom()),\n\t\t\t\tlabel:\t\t\t\tf.properties.label,\n\t\t\t\tdashed:\t\t\t\tf.properties.dashed,\n\t\t\t\tlineColor:\t\t\tf.properties.lineColor || options.lineColor,\n\t\t\t\tlineThickness:\t\tf.properties.lineThickness || options.lineThickness,\n\t\t\t\tlineTransparency:\tf.properties.lineTransparency || options.lineTransparency,\n\t\t\t\tfillColor:\t\t\tf.properties.fillColor || options.fillColor,\n\t\t\t\tfillTransparency:\tf.properties.fillTransparency || options.fillTransparency\n\t\t\t};\n\t\t}\n\t\telse{ continue; }\n\n\t\tlet object = _MAP.createObject(o);\n\t\t_MAP.addLayer( object );\n\t\t_MAP.fire(\"_addedlayer\", { layer: object });\n\t\t_MAP.objects.push( _MAP.extractObject(object) );\n\t}\n}\nfunction import_gedcom(data, options) {\n\t//\n}\nexport function import_data(type, data, options) {\n\tswitch(type) {\n\t\tcase \"project\": import_project(data); break;\n\t\tcase \"geojson\": import_geojson(data, options); break;\n\t\tcase \"gedcom\": import_gedcom(data, options); break;\n\t\tdefault: console.error(\"data-import type invalid\"); break;\n\t}\n}\n\n\nfunction export_project() {\n\treturn JSON.stringify({\n\t\toptions: _OPTIONS,\n\t\tscenes: _SCENES.exportData(),\n\t\ttextboxes: _TEXTBOXES.exportData(),\n\t\tobjects: _MAP.exportData()\n\t});\n}\nfunction export_geojson() {\n\tlet r = [];\n\tfor(let o of _MAP.getLayers()) { r.push( o.__toGeoJSON() ); }\n\treturn JSON.stringify({\n\t\t\"type\": \"FeatureCollection\",\n\t\t\"features\": r\n\t});\n}\nlet running = false;\nexport function export_data(type) {\n\tif(running) { return; } running = true;\n\n\tlet el = document.createElement(\"a\");\n\n\tlet f = v => v < 10 && v >= 0 ? `0${v}` : `${v}`;\n\tlet date = new Date();\n\tlet y = date.getFullYear(), m = f(date.getMonth() + 1), d = f(date.getDate()), H = f(date.getHours()), M = f(date.getMinutes()), S = f(date.getSeconds());\n\tlet filename = `${_TITLE} - ${y}.${m}.${d} - ${H}.${M}.${S}`;\n\n\tlet data;\n\tswitch(type) {\n\t\tcase \"project\":\n\t\t\tfilename += \".geotales\";\n\t\t\tdata = \"data:application/json;charset=utf-8,\" + encodeURIComponent( export_project() );\n\t\t\tbreak;\n\n\t\tcase \"geojson\":\n\t\t\tfilename += \".geojson\";\n\t\t\tdata = \"data:application/geo+json;charset=utf-8,\" + encodeURIComponent( export_geojson() );\n\t\t\tbreak;\n\n\t\tdefault: return;\n\t}\n\n\tel.setAttribute(\"href\", data);\n\tel.setAttribute(\"download\", filename);\n\tel.style.display = \"none\";\n\n\tdocument.body.appendChild(el);\n\t$(el).ready(() => { el.click(); document.body.removeChild(el); running = false; });\n}\n\nexport function save_data(callback) {\n\t$.ajax({\n\t\ttype: \"POST\",\n\t\turl: \"api/map_write.php\",\n\t\tdata: {\n\t\t\t\"id\": _ID,\n\t\t\t\"data\": export_project(),\n\t\t\t\"preview\": _MAP.getCenterBasemapTile()\n\t\t},\n\t\tdataType: \"json\",\n\t\tsuccess: function(result, status, xhr) {\n\t\t\tsaved_changes();\n\t\t\tsetTimeout(function() { if(callback) { callback(); } }, 750);\n\t\t},\n\t\terror: function(xhr, status, error) {\n\t\t\tconsole.error(xhr.status, error);\n\t\t\tsetTimeout(function() { $(\"#loadingModal\").modal(\"hide\"); $(\"#errorModal\").modal(\"show\"); }, 750);\n\t\t}\n\t});\n}\n\n\n\nexport function unsaved_changes() {\n\t$(window).off(\"beforeunload\");\n\t$(window).on(\"beforeunload\", ev => {\n\t\tev.preventDefault();\n\n\t\tlet m = \"Unsaved changes could be lost. Are you sure you want to close?\";\n\t\tev.returnValue = m;\n\t\treturn m;\n\t});\n}\n\nexport function saved_changes() {\n\t$(window).off(\"beforeunload\");\n}\n\n\n\nexport function flash_map() {\n\t$(\"div#map\").addClass(\"snapshot\");\n\tsetTimeout(function() { $(\"div#map\").removeClass(\"snapshot\"); }, 240);\n}\n\n\n\nexport function get_basemap(url) {\n\tfor(let b of _BASEMAPS) {\n\t\tif(b.tiles._url == url) { return b; }\n\t}\n\treturn null;\n}\n\nfunction bind_basemaps() {\n\t$(\"#basemapModal #basemaps\").off(\"click\");\n\t$(\"#basemapModal #basemaps\").click(async function(ev) {\n\t\tlet index = $(ev.target).data(\"basemap\");\n\t\tif(!index && index !== 0) { return; }\n\n\t\tawait _MAP.setBasemap( _BASEMAPS[index].tiles );\n\t\t_SCENES.setBasemap();\n\t});\n\n\t$(\"#basemapModal button#uploadBasemap\").click(function(ev) {\n\t\t$(\"#basemapModal input#basemapFile\").click();\n\t});\n}\nexport function init_basemaps() {\n\tgenerate_basemaps(false); bind_basemaps();\n}\nexport function init_img_basemaps() {\n\tgenerate_basemaps(true); bind_basemaps();\n}\n\n\n\nexport function get_aspect_ratio_dimentions(w, h, r) {\n\tlet _w = r * h;\n\tif(_w <= w) {\n\t\treturn [_w, h];\n\t}else{\n\t\treturn [w, w / r];\n\t}\n}\n","/*******************************************************************************\n* Copyright (C) Nordfjord EDB AS - All Rights Reserved                         *\n*                                                                              *\n* Unauthorized copying of this file, via any medium is strictly prohibited     *\n* Proprietary and confidential                                                 *\n* Written by Andreas Atakan <aca@geotales.io>, January 2022                  *\n*******************************************************************************/\n\n\"use strict\";\n\n\nexport function new_scene(id, prevId) {\n\n\tlet cont = `\n\t\t<li class=\"list-group-item p-1 my-1\" id=\"${id}\" data-id=\"${id}\">\n\t\t\t<div class=\"input-group input-group-sm\">\n\t\t\t\t<button type=\"button\" class=\"btn btn-outline-light\" id=\"reorder\" title=\"Change ordering\">\n\t\t\t\t\t<i class=\"fas fa-bars\"></i>\n\t\t\t\t</button>\n\t\t\t\t<input type=\"text\" class=\"form-control\" id=\"title\" aria-label=\"Title\" aria-describedby=\"num\" />\n\t\t\t\t<span class=\"input-group-text\" id=\"num\"></span>\n\t\t\t</div>\n\t\t</li>\n\t`;\n\n\tif(prevId) { $(`li[data-id=\"${prevId}\"]`).after(cont); }\n\telse{ $(\"ul#scenes\").append(cont); }\n\n}\n\n\n\nexport function generate_basemaps(isUpload) {\n\tlet html = ``;\n\n\tfor(let i = 0; i < _BASEMAPS.length; i++) {\n\t\tlet b = _BASEMAPS[i];\n\t\tif(b.name !== \"\" && isUpload) { continue; }\n\t\thtml += `\n\t\t\t<div class=\"col\">\n\t\t\t\t<div class=\"card mt-2\">\n\t\t\t\t\t<div class=\"card-body\">\n\t\t\t\t\t\t<h6 class=\"card-title mb-0\">${b.name}</h6>\n\t\t\t\t\t</div>\n\t\t\t\t\t<img class=\"card-img-bottom\" id=\"basemaps\" src=\"${b.preview}\" alt=\"${b.name}\" data-basemap=\"${i}\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\tif(isUpload) {\n\t\thtml += `\n\t\t\t<div class=\"col\">\n\t\t\t\t<div class=\"card mt-2\">\n\t\t\t\t\t<div class=\"card-body\">\n\t\t\t\t\t\t<div class=\"d-grid\">\n\t\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-outline-secondary\" id=\"uploadBasemap\" ${!_USER_PAID ? \"disabled\" : \"\"}>+</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t$(isUpload ?\n\t\t\"#basemapModal #imgBasemapChoose\" :\n\t\t\"#basemapModal #basemapChoose\").html(html);\n}\n\n\n\nexport function avatar_popup() {\n\n\treturn `\n\t\t<form class=\"container-fluid objectPopup\" id=\"avatarPopup\">\n\t\t\t<div class=\"row\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<input type=\"text\" class=\"form-control form-control-sm\" id=\"label\" aria-label=\"label\" placeholder=\"Label\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"row my-3\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<div class=\"input-group input-group-sm\">\n\t\t\t\t\t\t<div class=\"input-group-text\">\n\t\t\t\t\t\t\t<input type=\"checkbox\" class=\"form-check-input mt-0\" id=\"rounded\" value=\"\" aria-label=\"Rounded\" title=\"Rounded\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<input type=\"number\" min=\"10\" max=\"500\" step=\"1\" class=\"form-control\" id=\"size\" placeholder=\"Size\" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"row my-3\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<div class=\"accordion\" id=\"iconAccordion\">\n\t\t\t\t\t\t<div class=\"accordion-item\">\n\t\t\t\t\t\t\t<h2 class=\"accordion-header\" id=\"iconAccordionHeading\">\n\t\t\t\t\t\t\t\t<button class=\"accordion-button collapsed py-1 px-2\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#iconAccordionCollapse\" aria-expanded=\"false\" aria-controls=\"iconAccordionCollapse\">\n\t\t\t\t\t\t\t\t\tIcon\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</h2>\n\t\t\t\t\t\t\t<div id=\"iconAccordionCollapse\" class=\"accordion-collapse collapse\" aria-labelledby=\"iconAccordionHeading\" data-bs-parent=\"#iconAccordion\">\n\t\t\t\t\t\t\t\t<div class=\"accordion-body py-1\" style=\"max-height: 80px; overflow-y: auto;\">\n\t\t\t\t\t\t\t\t\t<div class=\"row row-cols-5\" id=\"iconChoose\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"col\">\n\t\t\t\t\t\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-sm btn-outline-secondary\" id=\"iconAdd\" title=\"Add icon\">+</button>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t  </div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"row my-3\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<div class=\"input-group input-group-sm\">\n\t\t\t\t\t\t<input type=\"color\" class=\"form-control form-control-color\" id=\"color\" value=\"#563d7c\" title=\"Choose color\" />\n\t\t\t\t\t\t<input type=\"number\" min=\"0\" max=\"10\" class=\"form-control\" id=\"thickness\" placeholder=\"Thickness\" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"row my-3\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<div class=\"input-group input-group-sm\">\n\t\t\t\t\t\t<input type=\"number\" min=\"0\" max=\"3\" step=\"0.1\" class=\"form-control\" id=\"blur\" placeholder=\"Blur\" />\n\t\t\t\t\t\t<input type=\"number\" min=\"0\" max=\"1\" step=\"0.1\" class=\"form-control\" id=\"grayscale\" placeholder=\"Grayscale\" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"input-group input-group-sm\">\n\t\t\t\t\t\t<input type=\"number\" min=\"0\" max=\"6\" step=\"1\" class=\"form-control\" id=\"brightness\" placeholder=\"Brightness\" />\n\t\t\t\t\t\t<input type=\"number\" min=\"0\" max=\"0.9\" step=\"0.1\" class=\"form-control\" id=\"transparency\" placeholder=\"Transparency\" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"row mb-2\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<input type=\"number\" class=\"form-control form-control-sm\" id=\"animationSpeed\" min=\"0.1\" max=\"10\" step=\"0.1\" aria-label=\"Animation speed\" placeholder=\"Animation speed (sec.)\" title=\"This objects animation speed to next scene\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"row\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<button type=\"button\" class=\"btn btn-sm btn-outline-secondary py-0\" id=\"makeGlobal\" title=\"Save options globally\">\n\t\t\t\t\t\t<i class=\"fas fa-save\"></i> <strong>*</strong>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</form>\n\t`;\n\n}\n\nexport function polyline_popup() {\n\n\treturn `\n\t\t<form class=\"container-fluid objectPopup\" id=\"shapePopup\">\n\t\t\t<div class=\"row\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<input type=\"text\" class=\"form-control form-control-sm\" id=\"label\" aria-label=\"label\" placeholder=\"Label\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"row my-3\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<div class=\"input-group input-group-sm\">\n\t\t\t\t\t\t<input type=\"color\" class=\"form-control form-control-color\" id=\"lineColor\" value=\"#563d7c\" title=\"Choose color\" />\n\t\t\t\t\t\t<input type=\"number\" min=\"2\" max=\"10\" class=\"form-control\" id=\"lineThickness\" placeholder=\"Thickness\" />\n\t\t\t\t\t\t<input type=\"number\" min=\"0\" max=\"0.9\" step=\"0.1\" class=\"form-control\" id=\"lineTransparency\" placeholder=\"Transparency\" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"form-check mt-1\">\n\t\t\t\t\t\t<input class=\"form-check-input\" type=\"checkbox\" value=\"\" id=\"dashed\">\n\t\t\t\t\t\t<label class=\"form-check-label\" for=\"dashed\">Dashed</label>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"row mb-2\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<input type=\"number\" class=\"form-control form-control-sm\" id=\"animationSpeed\" min=\"0.1\" max=\"10\" step=\"0.1\" aria-label=\"Animation speed\" placeholder=\"Animation speed (sec.)\" title=\"This objects animation speed to next scene\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"row\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<button type=\"button\" class=\"btn btn-sm btn-outline-secondary py-0\" id=\"makeGlobal\" title=\"Save options globally\">\n\t\t\t\t\t\t<i class=\"fas fa-save\"></i> <strong>*</strong>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</form>\n\t`;\n\n}\n\nexport function polygon_popup() {\n\n\treturn `\n\t\t<form class=\"container-fluid objectPopup\" id=\"shapePopup\">\n\t\t\t<div class=\"row\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<input type=\"text\" class=\"form-control form-control-sm\" id=\"label\" aria-label=\"label\" placeholder=\"Label\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"row my-3\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<div class=\"input-group input-group-sm\">\n\t\t\t\t\t\t<input type=\"color\" class=\"form-control form-control-color\" id=\"lineColor\" value=\"#563d7c\" title=\"Choose color\" />\n\t\t\t\t\t\t<input type=\"number\" min=\"2\" max=\"10\" class=\"form-control\" id=\"lineThickness\" placeholder=\"Thickness\" />\n\t\t\t\t\t\t<input type=\"number\" min=\"0\" max=\"0.9\" step=\"0.1\" class=\"form-control\" id=\"lineTransparency\" placeholder=\"Transparency\" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"form-check mt-1\">\n\t\t\t\t\t\t<input class=\"form-check-input\" type=\"checkbox\" value=\"\" id=\"dashed\">\n\t\t\t\t\t\t<label class=\"form-check-label\" for=\"dashed\">Dashed</label>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"row my-3\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<div class=\"input-group input-group-sm\">\n\t\t\t\t\t\t<input type=\"color\" class=\"form-control form-control-color\" id=\"fillColor\" value=\"#563d7c\" title=\"Choose color\" />\n\t\t\t\t\t\t<input type=\"number\" min=\"0\" max=\"1\" step=\"0.1\" class=\"form-control\" id=\"fillTransparency\" placeholder=\"Transparency\" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"row mb-2\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<input type=\"number\" class=\"form-control form-control-sm\" id=\"animationSpeed\" min=\"0.1\" max=\"10\" step=\"0.1\" aria-label=\"Animation speed\" placeholder=\"Animation speed (sec.)\" title=\"This objects animation speed to next scene\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"row\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<button type=\"button\" class=\"btn btn-sm btn-outline-secondary py-0\" id=\"makeGlobal\" title=\"Save options globally\">\n\t\t\t\t\t\t<i class=\"fas fa-save\"></i> <strong>*</strong>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</form>\n\t`;\n\n}\n","/*******************************************************************************\n* Copyright (C) Nordfjord EDB AS - All Rights Reserved                         *\n*                                                                              *\n* Unauthorized copying of this file, via any medium is strictly prohibited     *\n* Proprietary and confidential                                                 *\n* Written by Andreas Atakan <aca@geotales.io>, January 2022                  *\n*******************************************************************************/\n\n\"use strict\";\n\nimport { uuid, save_data, flash_map } from \"./helpers.js\";\nimport { new_scene } from \"./generate.js\";\n\n\nexport function Scenes() {\n\tthis.store = [];\n\tthis.active = \"\";\n\tthis.copiedBounds = null;\n\n\n\tthis.setup = function() {\n\t\t$(\"#scenes\").sortable({ // https://api.jqueryui.com/sortable/\n\t\t\tcursor: \"move\", handle: \"button#reorder\", items: \"> li\", containment: \"parent\", tolerance: \"pointer\", cancel: \"\", zIndex: 1003, axis: \"x\", //scroll: false,\n\t\t\tstart: (ev, ui) => {\n\t\t\t\tev.stopPropagation();\n\t\t\t\tthis.unbind();\n\t\t\t},\n\t\t\tupdate: (ev, ui) => {\n\t\t\t\tev.stopPropagation();\n\t\t\t\t//let id = $(ui.item[0]).data(\"id\"), order = $(\"#scenes\").sortable(\"toArray\");\n\t\t\t\tthis.reorder( $(\"#scenes\").sortable(\"toArray\") );\n\t\t\t},\n\t\t\tstop: (ev, ui) => {\n\t\t\t\tev.stopPropagation();\n\t\t\t\tthis.bind();\n\t\t\t}\n\t\t});\n\n\t\t$(\"#sceneRow button#delete, #sceneRow button#recapture\").prop(\"disabled\", false);\n\t};\n\n\tthis.reset = function() {\n\t\t$(\"#scenes\").sortable(\"destroy\");\n\t\t$(\"#sceneRow button#delete, #sceneRow button#recapture\").prop(\"disabled\", true);\n\t};\n\n\tthis.get = function(id) {\n\t\tfor(let i = 0; i < this.store.length; i++) {\n\t\t\tlet s = Object.assign({}, this.store[i]);\n\t\t\tif(s.id == id) { s.index = i; return s; }\n\t\t}\n\t\treturn null;\n\t};\n\n\tthis.getEl = function(el) {\n\t\tfor(let i = 0; i < this.store.length; i++) {\n\t\t\tlet s = Object.assign({}, this.store[i]);\n\t\t\tif( $(`li[data-id=\"${s.id}\"]`)[0].contains(el) ) { s.index = i; return s; }\n\t\t}\n\t\treturn null;\n\t};\n\n\tthis.getPrevScene = function(id) {\n\t\tlet s = this.get(id);\n\t\tif(!s || s.index <= 0) { return; }\n\n\t\treturn Object.assign({}, this.store[ s.index - 1 ]);\n\t};\n\n\tthis.reorder = function(order) {\n\t\tthis.store.sort((a,b) => order.indexOf(a.id) - order.indexOf(b.id));\n\t\tthis.set(this.active);\n\t};\n\n\tthis.add = function() {\n\t\tif(this.store.length <= 0) {\n\t\t\tdocument.dispatchEvent( new Event(\"_setup\") );\n\t\t}\n\n\t\tlet s = new Scene(null, this.active);\n\t\ts.capture();\n\n\t\tif(this.active) { this.store.splice(this.get(this.active).index + 1, 0, s); }\n\t\telse{ this.store.push(s); }\n\n\t\t_TEXTBOXES.addScene(s.id);\n\t\t_MAP.addScene(s.id);\n\n\t\tthis.set(s.id);\n\t\tthis.bind();\n\n\t\tsave_data();\n\t};\n\n\tthis.capture = function() {\n\t\tif(!this.active) { return; }\n\n\t\tlet s = this.store[ this.get(this.active).index ];\n\t\ts.capture();\n\t\tflash_map();\n\t\tsave_data();\n\t};\n\n\tthis.delete = function() {\n\t\tif(!this.active) { return; }\n\n\t\tlet s = this.get( this.active );\n\n\t\t_TEXTBOXES.deleteScene(s.id);\n\t\t_MAP.deleteScene(s.id);\n\n\t\tif( !this.prev() ) { this.next(); }\n\n\t\tthis.store.splice(s.index, 1);\n\n\t\t$(`li[data-id=\"${s.id}\"]`).remove();\n\n\t\tthis.setNumbering();\n\n\t\tif(this.store.length <= 0) {\n\t\t\tthis.active = \"\";\n\t\t\tdocument.dispatchEvent( new Event(\"_reset\") );\n\t\t}\n\n\t\tsave_data();\n\t};\n\n\tthis.unbind = function() {\n\t\t$(\"#scenes li button#reorder\").prop(\"disabled\", true);\n\t\t$(\"#scenes li\").off(\"click\");\n\t};\n\tthis.bind = function() {\n\t\t$(\"#scenes li button#reorder\").prop(\"disabled\", false);\n\t\t$(\"#scenes li\").off(\"click\");\n\t\t$(\"#scenes li\").click(ev => {\n\t\t\tlet s = this.getEl(ev.target);\n\t\t\tif(!s) { return; }\n\n\t\t\tlet el = $(`li[data-id=\"${s.id}\"]`);\n\t\t\tif(el.hasClass(\"active\")) { return; }\n\n\t\t\tthis.set(s.id);\n\t\t});\n\t};\n\n\tthis.prev = function() {\n\t\tlet s = this.get(this.active);\n\t\tif(!s || s.index <= 0) { return; }\n\n\t\ts = this.store[ s.index - 1 ];\n\t\tthis.set(s.id);\n\t\treturn Object.assign({}, s);\n\t};\n\n\tthis.current = function() {\n\t\tthis.set(this.active);\n\t\tthis.bind();\n\t};\n\n\tthis.next = function() {\n\t\tlet s = this.get(this.active);\n\t\tif(!s || s.index >= this.store.length - 1) { return; }\n\n\t\ts = this.store[ s.index + 1 ];\n\t\tthis.set(s.id);\n\t\treturn Object.assign({}, s);\n\t};\n\n\tthis.set = function(id) {\n\t\tif(this.active) { this.get(this.active).disable(); }\n\t\tthis.active = id;\n\n\t\tlet s = this.get(id);\n\t\ts.enable();\n\n\t\t$(`li[data-id=\"${s.id}\"]`)[0].scrollIntoView({ behavior: \"smooth\", inline: \"center\" });\n\n\t\t_TEXTBOXES.set(s.id);\n\t\t_MAP.set(s.id);\n\n\t\tthis.setNumbering();\n\t};\n\n\tthis.setWMS = function() {\n\t\tthis.store[ this.get(this.active).index ].setWMS();\n\t};\n\tthis.setBasemap = function() {\n\t\tthis.store[ this.get(this.active).index ].setBasemap();\n\t};\n\n\tthis.setBookmark = function(b) {\n\t\tif(!this.active) { return; }\n\n\t\tlet s = this.store[ this.get(this.active).index ];\n\t\ts.setBookmark(b);\n\t\tsave_data();\n\t};\n\n\tthis.setNumbering = function() {\n\t\tlet i = 1;\n\t\tfor(let n of $(\"#scenes li span#num\")) {\n\t\t\t$(n).html(i++);\n\t\t}\n\t};\n\n\tthis.copyBounds = function() {\n\t\tif(!this.active) { return; }\n\n\t\tthis.copiedBounds = this.get(this.active).bounds;\n\t};\n\n\tthis.pasteBounds = function() {\n\t\tif(!this.active) { return; }\n\n\t\tlet s = this.store[ this.get(this.active).index ];\n\t\ts.setBounds(this.copiedBounds);\n\t};\n\n\tthis.importData = function(data) {\n\t\tif(data.length <= 0) { return; }\n\n\t\tif(this.store.length <= 0 || !this.active) {\n\t\t\tthis.active = data[0].id;\n\t\t}\n\n\t\tfor(let o of data) {\n\t\t\tlet s = new Scene(o.id);\n\t\t\ts.bounds = o.bounds;\n\t\t\ts.wms = o.wms;\n\t\t\ts.basemap = o.basemap;\n\n\t\t\ts.setBookmark(o.bookmark);\n\t\t\ts.setTitle(o.title);\n\n\t\t\ts.disable();\n\n\t\t\tthis.store.push(s);\n\t\t}\n\t};\n\n\tthis.exportData = function() {\n\t\tlet r = [];\n\t\tfor(let s of this.store) { r.push( s.exportData() ); }\n\t\treturn r;\n\t};\n}\n\n\n\nfunction Scene(id, prevId) {\n\tthis.id = id || uuid();\n\n\tthis.bounds = null;\n\tthis.wms = null;\n\tthis.basemap = null;\n\n\tthis.bookmark = false;\n\tthis.title = \"\";\n\n\tnew_scene(this.id, prevId);\n\n\t$(`li[data-id=\"${this.id}\"]`).on(\"keydown keyup\", ev => { ev.stopPropagation(); });\n\t$(`li[data-id=\"${this.id}\"] input#title`).change(ev => { this.title = ev.target.value; });\n\n\n\tthis.enable = function() {\n\t\t$(`li[data-id=\"${this.id}\"]`).addClass(\"active\");\n\t\t$(`li[data-id=\"${this.id}\"] input, li[data-id=\"${this.id}\"] button`).prop(\"disabled\", false);\n\t\t$(`li[data-id=\"${this.id}\"] input, li[data-id=\"${this.id}\"] button`).click(ev => { ev.stopPropagation(); });\n\t};\n\n\tthis.disable = function() {\n\t\t$(`li[data-id=\"${this.id}\"]`).removeClass(\"active\");\n\t\t$(`li[data-id=\"${this.id}\"] input`).prop(\"disabled\", true);\n\t\t$(`li[data-id=\"${this.id}\"] input, li[data-id=\"${this.id}\"] button`).off(\"click\");\n\t};\n\n\tthis.setBounds = function(bounds) {\n\t\tthis.bounds = bounds;\n\t\t_MAP.setFlyTo( this.bounds );\n\t};\n\n\tthis.setWMS = function() { this.wms = _MAP.getWMS(); };\n\tthis.setBasemap = function() { this.basemap = _MAP.getBasemap(); };\n\n\tthis.setBookmark = function(b) {\n\t\tthis.bookmark = b;\n\t\tif(b) { $(`li[data-id=\"${this.id}\"]`).addClass(\"bookmark\"); }\n\t\telse{ $(`li[data-id=\"${this.id}\"]`).removeClass(\"bookmark\"); }\n\t};\n\n\tthis.setTitle = function(t) {\n\t\tthis.title = t;\n\t\t$(`li[data-id=\"${this.id}\"] input#title`).val(this.title);\n\t};\n\n\tthis.capture = function() {\n\t\tlet nw = _MAP.getBounds().getNorthWest(),\n\t\t\tse = _MAP.getBounds().getSouthEast();\n\t\tthis.setBounds( [[nw.lat, nw.lng], [se.lat, se.lng]] );\n\t\tthis.setBasemap();\n\t};\n\n\tthis.exportData = function() {\n\t\treturn {\n\t\t\tid: this.id,\n\t\t\tbounds: this.bounds,\n\t\t\twms: this.wms,\n\t\t\tbasemap: this.basemap,\n\t\t\tbookmark: this.bookmark,\n\t\t\ttitle: this.title\n\t\t};\n\t};\n}\n","/*******************************************************************************\n* Copyright (C) Nordfjord EDB AS - All Rights Reserved                         *\n*                                                                              *\n* Unauthorized copying of this file, via any medium is strictly prohibited     *\n* Proprietary and confidential                                                 *\n* Written by Andreas Atakan <aca@geotales.io>, January 2022                  *\n*******************************************************************************/\n\n\"use strict\";\n\nimport { uuid, save_data } from \"./helpers.js\";\n\n\nexport function Textboxes() {\n\tthis.store = [];\n\n\t$(\"input#_img_textbox\").change(function(ev) {\n\t\tlet file = $(this)[0].files[0];\n\t\tif(!file) { return; }\n\n\t\t$(\"#loadingModal\").modal(\"show\");\n\t\tlet data = new FormData();\n\t\tdata.append(\"type\", \"image\");\n\t\tdata.append(\"image\", file);\n\t\t$.ajax({\n\t\t\ttype: \"POST\",\n\t\t\turl: \"api/upload_create.php\",\n\t\t\tdata: data,\n\t\t\tcontentType: false,\n\t\t\tprocessData: false,\n\t\t\tsuccess: function(result, status, xhr) {\n\t\t\t\t$(\"#textbox #content\").trumbowyg(\"execCmd\", { cmd: \"insertImage\", param: result, forceCss: false, skipTrumbowyg: true });\n\t\t\t\tsetTimeout(function() { $(\"#loadingModal\").modal(\"hide\"); }, 750);\n\t\t\t},\n\t\t\terror: function(xhr, status, error) {\n\t\t\t\tconsole.log(xhr.status, error);\n\t\t\t\tsetTimeout(function() { $(\"#loadingModal\").modal(\"hide\"); $(\"#errorModal\").modal(\"show\"); }, 750);\n\t\t\t}\n\t\t});\n\t});\n\n\t$(\"#textbox input#lock\").change(ev => {\n\t\tthis.setLock( ev.target.checked );\n\t});\n\n\t$(\"#textbox button#close\").click(ev => { this.delete(_SCENES.active); });\n\n\t$(\"#textboxOptionsModal select#bookOrientation\").change(ev => {\n\t\tthis.setOrientation( ev.target.value );\n\t});\n\n\n\tthis.setup = function() {\n\t\t$(\"#textbox\").resizable({ // https://api.jqueryui.com/resizable/\n\t\t\tcontainment: \"#mapRow\", handles: \"e\", minWidth: 100,\n\t\t\tstop: (ev, ui) => {\n\t\t\t\tlet w = ui.size.width / ($(\"#mapRow\").outerWidth() - 20),\n\t\t\t\t\tt = this.get(_SCENES.active);\n\t\t\t\tif(t) {\n\t\t\t\t\tthis.store[ t.index ].dim = [0, w];\n\t\t\t\t\t$(\"#textbox\").css({ width: `${w * 100}%` });\n\t\t\t\t\tif(t.pos == \"right\") { $(\"#textbox\").css({ left: \"auto\" }); }\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t$(\"#textbox #content\").trumbowyg({\n\t\t\tautogrow: true, semantic: false, resetCss: true, removeformatPasted: true, urlProtocol: true,\n\t\t\tdefaultLinkTarget: \"_blank\",\n\t\t\ttagsToRemove: [\"script\", \"link\"],\n\t\t\tbtnsDef: {\n\t\t\t\tformat: { dropdown: [\"bold\", \"italic\", \"underline\", \"del\"], title: \"Format\", ico: \"bold\" },\n\t\t\t\talign: {\n\t\t\t\t\tdropdown: [\"justifyLeft\", \"justifyCenter\", \"justifyRight\", \"justifyFull\", \"unorderedList\", \"orderedList\"],\n\t\t\t\t\ttitle: \"List/Align\",\n\t\t\t\t\tico: \"justifyLeft\"\n\t\t\t\t},\n\t\t\t\tuploadImg: {\n\t\t\t\t\tfn: ev => { $(\"input#_img_textbox\").click(); },\n\t\t\t\t\ttitle: \"Add image\", ico: \"insertImage\"\n\t\t\t\t},\n\t\t\t\tmakeLink: {\n\t\t\t\t\tfn: ev => {\n\t\t\t\t\t\t$(\"#textbox #content\").trumbowyg(\"saveRange\");\n\t\t\t\t\t\tlet text = $(\"#textbox #content\").trumbowyg(\"getRangeText\");\n\t\t\t\t\t\tif(text.replace(/\\s/g, \"\") == \"\") { return; }\n\n\t\t\t\t\t\tif([\"http\", \"https\"].indexOf(text.split(\"://\")[0]) < 0) { text = `https://${text}`; }\n\t\t\t\t\t\t$(\"#textbox #content\").trumbowyg(\"execCmd\", { cmd: \"insertHTML\", param: `<a href=\"${text}\" target=\"_blank\">${text}</a>`, forceCss: false });\n\t\t\t\t\t},\n\t\t\t\t\ttitle: \"Create link\", ico: \"link\"\n\t\t\t\t}\n\t\t\t},\n\t\t\tbtns: [\n\t\t\t\t[\"formatting\"], [\"format\"], [\"align\"], [\"fontfamily\"], [\"foreColor\", \"backColor\"], [\"makeLink\"], [\"uploadImg\"]\n\t\t\t],\n\t\t\tplugins: {}\n\t\t}).on(\"tbwchange\", () => {\n\t\t\tlet t = this.get(_SCENES.active);\n\t\t\tif(t) { this.store[ t.index ].content = $(\"#textbox #content\").trumbowyg(\"html\"); }\n\t\t});\n\n\t\t_MAP.setOrientation(\"right\");\n\t};\n\n\tthis.reset = function() {\n\t\t$(\"#textbox\").resizable(\"destroy\");\n\t\t$(\"#textbox #content\").trumbowyg(\"destroy\");\n\t\t_MAP.setOrientation(\"right\");\n\t};\n\n\tthis.get = function(sceneId) {\n\t\tfor(let i = 0; i < this.store.length; i++) {\n\t\t\tlet t = Object.assign({}, this.store[i]);\n\t\t\tif(t.sceneId == sceneId) { t.index = i; return t; }\n\t\t}\n\t\treturn null;\n\t};\n\n\tthis.add = function() {\n\t\tif(!_SCENES.active) { return; }\n\n\t\tlet t = new Textbox(null);\n\t\tt.sceneId = _SCENES.active;\n\t\tt.enable();\n\t\tthis.store.push(t);\n\t\tsave_data();\n\t};\n\n\tthis.addScene = function(sceneId) {\n\t\tlet prev = _SCENES.getPrevScene(sceneId);\n\t\tif(prev) {\n\t\t\tfor(let t of this.store) {\n\t\t\t\tif(t.sceneId == prev.id && t.locked) {\n\t\t\t\t\tlet tt = new Textbox(null);\n\t\t\t\t\ttt.sceneId = sceneId;\n\t\t\t\t\ttt.pos = t.pos; tt.dim = t.dim;\n\t\t\t\t\ttt.content = t.content;\n\t\t\t\t\ttt.locked = true;\n\t\t\t\t\ttt.enable();\n\t\t\t\t\tthis.store.push(tt);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.delete = function(sceneId) {\n\t\tlet t = this.get(sceneId);\n\t\tif(!t) { return; }\n\n\t\tt.disable();\n\t\tthis.store.splice(t.index, 1);\n\t\tsave_data();\n\t};\n\n\tthis.deleteScene = function(sceneId) {\n\t\tfor(let t of this.store) {\n\t\t\tif(t.sceneId == sceneId) { this.delete(t.sceneId); }\n\t\t}\n\t};\n\n\tthis.set = function(sceneId) {\n\t\tfor(let t of this.store) {\n\t\t\tif(t.sceneId == sceneId) { t.enable(); break; }\n\t\t\telse{ t.disable(); }\n\t\t}\n\t};\n\n\tthis.setLock = function(l) {\n\t\tlet t = this.get(_SCENES.active);\n\t\tif(!t) { return; }\n\n\t\tthis.store[ t.index ].setLock(l);\n\t};\n\n\tthis.setOrientation = function(pos) {\n\t\tlet t = this.get(_SCENES.active);\n\t\tif(!t) { return; }\n\n\t\tthis.store[ t.index ].pos = pos;\n\t\tthis.store[ t.index ].setOrientation();\n\t};\n\n\tthis.importData = function(data) {\n\t\tif(data.length <= 0) { return; }\n\n\t\tfor(let o of data) {\n\t\t\tlet t = new Textbox(o.id);\n\t\t\tt.sceneId = o.sceneId;\n\t\t\tif(o.pos) { t.pos = o.pos; }\n\t\t\tif(o.dim) { t.dim = o.dim; }\n\t\t\tt.content = o.content;\n\t\t\tt.locked = o.locked;\n\n\t\t\tt.disable();\n\n\t\t\tthis.store.push(t);\n\t\t}\n\t};\n\n\tthis.exportData = function() {\n\t\tlet r = [];\n\t\tfor(let t of this.store) { r.push( t.exportData() ); }\n\t\treturn r;\n\t};\n}\n\n\n\nfunction Textbox(id) {\n\tthis.id = id || uuid();\n\n\tthis.sceneId = \"\";\n\tthis.locked = false;\n\n\tthis.pos = \"left\";\n\tthis.dim = [0, 0.25];\n\tthis.content = \"\";\n\n\n\tthis.setOrientation = function() {\n\t\tswitch(this.pos) {\n\t\t\tcase \"left\":\n\t\t\t\t$(\"#textbox\").css({ left: \"10px\", right: \"auto\" });\n\t\t\t\t$(\"#textbox\").resizable(\"option\", { handles: \"e\" });\n\t\t\t\t_MAP.setOrientation(\"right\");\n\t\t\t\tbreak;\n\n\t\t\tcase \"right\":\n\t\t\t\t$(\"#textbox\").css({ left: \"auto\", right: \"10px\" });\n\t\t\t\t$(\"#textbox\").resizable(\"option\", { handles: \"w\" });\n\t\t\t\t_MAP.setOrientation(\"left\");\n\t\t\t\tbreak;\n\n\t\t\tdefault: break;\n\t\t}\n\t};\n\n\tthis.setLock = function(l) {\n\t\tthis.locked = l;\n\t\t$(\"#textbox input#lock\").prop(\"checked\", this.locked);\n\t};\n\n\tthis.enable = function() {\n\t\tthis.setOrientation();\n\n\t\t$(\"#textbox\").css(\"display\", \"block\");\n\t\t$(\"#textbox\").css({ width: `${this.dim[1] * 100}%` });\n\n\t\t$(\"#textbox #content\").trumbowyg(\"enable\");\n\t\t$(\"#textbox #content\").trumbowyg(\"html\", this.content);\n\n\t\t$(\"#textbox #lock\").prop({ disabled: false, checked: this.locked });\n\n\t\t_MAP.textboxButton.disable();\n\t};\n\n\tthis.disable = function() {\n\t\t$(\"#textbox\").css(\"display\", \"none\");\n\t\t$(\"#textbox #content\").trumbowyg(\"disable\");\n\t\t$(\"#textbox #lock\").prop(\"disabled\", true);\n\t\t_MAP.textboxButton.enable();\n\t};\n\n\tthis.exportData = function() {\n\t\treturn {\n\t\t\tid: this.id,\n\t\t\tsceneId: this.sceneId,\n\t\t\tlocked: this.locked,\n\t\t\tpos: this.pos,\n\t\t\tdim: this.dim,\n\t\t\tcontent: this.content\n\t\t};\n\t};\n}\n","/*******************************************************************************\n* Copyright (C) Nordfjord EDB AS - All Rights Reserved                         *\n*                                                                              *\n* Unauthorized copying of this file, via any medium is strictly prohibited     *\n* Proprietary and confidential                                                 *\n* Written by Andreas Atakan <aca@geotales.io>, January 2022                  *\n*******************************************************************************/\n\n\"use strict\";\n\nimport { uuid, save_data, get_aspect_ratio_dimentions, init_img_basemaps } from \"../helpers.js\";\nimport { avatar_popup, polyline_popup, polygon_popup } from \"../generate.js\";\nimport { bind_setup } from \"./layers.js\";\n\n\nL.Map.addInitHook(function() {\n\n\t// Init map aspect ratio\n\n\tthis.setAspectRatio();\n\n\n\n\t// Plugins\n\n\t/*this.addControl( new L.Control.Fullscreen({ position: \"topright\" }) );*/\n\n\t/*this.addControl( L.control.zoom({ position: \"bottomright\" }) );*/\n\n\tthis.returnButton = L.Control.zoomHome({\n\t\tposition: \"bottomright\",\n\t\tzoomHomeIcon: \"home\",\n\t\tzoomHomeTitle: \"Return to map-extent\"\n\t});\n\tthis.addControl( this.returnButton );\n\n\tthis.basemapButton = L.easyButton({\n\t\tid: \"changeBasemap\",\n\t\tposition: \"bottomright\",\n\t\tleafletClasses: true,\n\t\tstates: [\n\t\t\t{\n\t\t\t\tstateName: \"main\",\n\t\t\t\tonClick: function(button, map) { $(\"#basemapModal\").modal(\"show\"); init_img_basemaps(); },\n\t\t\t\ttitle: \"Change basemap\",\n\t\t\t\ticon: \"fa-layer-group\"\n\t\t\t}\n\t\t]\n\t});\n\tthis.addControl( this.basemapButton );\n\tthis.basemapButton.disable();\n\n\tthis.textboxButton = L.easyButton({\n\t\tid: \"addTextbox\",\n\t\tposition: \"topleft\",\n\t\tleafletClasses: true,\n\t\tstates: [\n\t\t\t{\n\t\t\t\tstateName: \"main\",\n\t\t\t\tonClick: function(button, map) { _TEXTBOXES.add(); },\n\t\t\t\ttitle: \"Add book\",\n\t\t\t\ticon: \"fa-comment-alt\"\n\t\t\t}\n\t\t]\n\t});\n\tthis.addControl( this.textboxButton );\n\tthis.textboxButton.disable();\n\n\t/*this.addControl( L.control.locate({ position: \"topright\" }) );*/\n\n\n\n\n\n\t// Basemap\n\n\tthis.basemap = _BASEMAPS[10].tiles;\n\tthis.addLayer( this.basemap );\n\n\t// WMS\n\n\tthis.wms = {};\n\n\n\n\n\n\t// Draw and edit control\n\n\t//L.PM.setOptIn(true);\n\tthis.pm.addControls({\n\t\tposition: \"topright\",\n\t\tdrawCircleMarker: false,\n\t\tdrawText: false,\n\t\toneBlock: true\n\t});\n\tthis.pm.setPathOptions({\n\t\tweight: 3,\n\t\tcolor: \"#563d7c\",\n\t\topacity: 1,\n\t\tfillColor: \"#563d7c\",\n\t\tfillOpacity: 0.2\n\t});\n\tthis.pm.setGlobalOptions({\n\t\tmarkerStyle: {\n\t\t\ticon: L.icon({ iconUrl: \"assets/user-circle-solid.svg\", iconSize: [30, 30], popupAnchor: [0, -15], tooltipAnchor: [0, 15] })\n\t\t}\n\t});\n\tthis.pm.setLang(\"customLang\", {\n\t\ttooltips: { placeMarker: \"Click to place avatar\" },\n\t\tbuttonTitles: { drawMarkerButton: \"Draw avatar\" }\n\t}, \"en\");\n\tthis.disableDraw();\n\n\n\n\n\n\t// Object layers\n\n\tthis.objects = [];\n\tthis.fadeLayer = L.fadeLayer({ pmIgnore: true });\n\tthis.addLayer( this.fadeLayer );\n\n\tthis.on(\"pm:create\", ev => {\n\t\tlet o = ev.layer, type = ev.shape;\n\n\t\tif(type == \"Marker\") {\n\t\t\tlet zoom = this.getZoom();\n\t\t\tlet p = this.project(o.getLatLng(), zoom),\n\t\t\t\turl = o.getIcon().options.iconUrl,\n\t\t\t\tsize = o.getIcon().options.iconSize;\n\t\t\tthis.removeLayer(o);\n\t\t\to = L.imageOverlay(url, [\n\t\t\t\tthis.unproject([ p.x - size[0] / 2, p.y - size[1] / 2 ], zoom),\n\t\t\t\tthis.unproject([ p.x + size[0] / 2, p.y + size[1] / 2 ], zoom)\n\t\t\t], {\n\t\t\t\tinteractive:\t\t\ttrue,\n\t\t\t\tzIndex:\t\t\t\t\t200,\n\t\t\t\tratio:\t\t\t\t\t496 / 512, // NOTE: this is hard-coded from the pixel-width of 'user-circle-solid.svg'\n\t\t\t\trounded:\t\t\t\tfalse,\n\t\t\t\tangle:\t\t\t\t\t0,\n\t\t\t\tborderColor:\t\t\t\"#563d7c\",\n\t\t\t\tborderThickness:\t\t0,\n\t\t\t\toverlayBlur:\t\t\t0,\n\t\t\t\toverlayGrayscale:\t\t0,\n\t\t\t\toverlayBrightness:\t\t0,\n\t\t\t\toverlayTransparency:\t0\n\t\t\t});\n\t\t\tthis.addLayer(o);\n\t\t}\n\n\t\to.options.id = uuid();\n\t\to.options.sceneId = _SCENES.active;\n\n\t\tthis.fire(\"_addedlayer\", { layer: o });\n\n\t\tthis.objects.push( this.extractObject(o) );\n\t});\n\n\tthis.on(\"_addedlayer\", async ev => {\n\t\tlet o = ev.layer;\n\n\t\tlet label = o.options.label;\n\t\tif(label) {\n\t\t\to.bindTooltip(label, { direction: \"center\", permanent: true });\n\t\t\tif(o instanceof L.ImageOverlay) { this.updateTooltip(o); }\n\t\t}\n\n\t\to.on(\"moveend\", ev => { this.updateTooltip(ev.target); });\n\t\to.on(\"pm:edit\", ev => {\n\t\t\tlet o = ev.layer;\n\t\t\tthis.updateObject(o);\n\t\t\tif(o.options.label) { o.closeTooltip(); o.openTooltip(); }\n\t\t});\n\n\t\to.on(\"pm:remove\", ev => {\n\t\t\tlet o = ev.layer;\n\n\t\t\tthis.deleteObject(o);\n\n\t\t\to.closeTooltip(); o.unbindTooltip();\n\t\t\to.closePopup(); o.unbindPopup();\n\t\t\to.off(\"popupopen\"); o.off(\"mouseover\"); o.off(\"mouseout\");\n\n\t\t\to.slideCancel();\n\t\t});\n\n\t\tthis.setPopup(o);\n\n\t\to.on(\"pm:dragstart\", ev => { o.unbindPopup(); });\n\t\to.on(\"pm:dragend\", ev => { this.setPopup( ev.layer ); });\n\n\t\to.on(\"popupopen\", ev => { bind_setup(o); });\n\t\to.on(\"mouseover\", ev => { this.highlightObject(o.options.id); });\n\t\to.on(\"mouseout\", ev => { this.unhighlightObject(o.options.id); });\n\n\t\tlet contextmenu = [\n\t\t\t{ text: \"Move to front\", callback: ev => { o.bringToFront(); }, index: 0 },\n\t\t\t{ text: \"Move to back\", callback: ev => { o.bringToBack(); }, index: 1 }\n\t\t];\n\n\t\tif(o instanceof L.ImageOverlay) {\n\t\t\tcontextmenu.push( { text: \"Clone avatar\", callback: ev => { this.cloneAvatar(o.options.id, o.options.sceneId); }, index: 2 } );\n\t\t\tthis.setIcon(o);\n\t\t}\n\n\t\to.bindContextMenu({ contextmenu: true, contextmenuItems: contextmenu });\n\t});\n\n\tthis.on(\"layeradd\", ev => {\n\t\tlet o = ev.layer;\n\t\t//let opacity = o.options.opacity;\n\n\t\t/* TODO: fade in layer when added\n\t\t\tAlternatively this can be implemented in each prototypes\n\t\t\tonAdd method (in layers.js), instead of here.\n\t\t*/\n\t});\n\n\tthis.on(\"zoomend\", ev => {\n\t\tfor(let o of this.getLayers()) { this.updateTooltip(o); }\n\t});\n\tthis.on(\"zoom\", ev => { if(this._renderer) { this._renderer._reset(); } });\n\n\n\tthis.on(\"movestart\", ev => { /**/ });\n\tthis.on(\"moveend\", ev => { /**/ });\n\n});\n\n\n\n\n\nL.Map.include({\n\n\tsetup: function() {\n\t\tthis.setAspectRatio();\n\n\t\tthis.enableDraw();\n\t\tthis.basemapButton.enable();\n\t\tthis.textboxButton.enable();\n\n\t\t$(\".leaflet-control-attribution>span\").before(\"<span aria-hidden=\\\"true\\\">|</span> <a href=\\\"https://geotales.io\\\">GeoTales</a> \");\n\t\t$(\".leaflet-control-attribution a\").prop(\"target\", \"_blank\");\n\t},\n\treset: function() {\n\t\tthis.clearLayers();\n\t\tthis.fadeLayer.clearLayers();\n\n\t\tthis.disableDraw();\n\t\tthis.basemapButton.disable();\n\t\tthis.textboxButton.disable();\n\t},\n\n\tenableDraw: function() {\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Marker\", false);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Line\", false);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Polygon\", false);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Rectangle\", false);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Circle\", false);\n\t\t//this.pm.Toolbar.setButtonDisabled(\"Text\", false);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Edit\", false);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Drag\", false);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Cut\", false);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Removal\", false);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Rotate\", false);\n\t},\n\tdisableDraw: function() {\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Marker\", true);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Line\", true);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Polygon\", true);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Rectangle\", true);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Circle\", true);\n\t\t//this.pm.Toolbar.setButtonDisabled(\"Text\", true);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Edit\", true);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Drag\", true);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Cut\", true);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Removal\", true);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Rotate\", true);\n\t},\n\n\tsetOrientation: function(pos) {\n\t\tswitch(pos) {\n\t\t\tcase \"left\":\n\t\t\t\tthis.returnButton.setPosition(\"bottomleft\");\n\t\t\t\tthis.basemapButton.setPosition(\"bottomleft\");\n\t\t\t\tthis.pm.Toolbar.setBlockPosition(\"draw\", \"topleft\");\n\t\t\t\tthis.pm.Toolbar.setBlockPosition(\"edit\", \"topleft\");\n\t\t\t\tthis.textboxButton.setPosition(\"topright\");\n\t\t\t\tbreak;\n\n\t\t\tcase \"right\":\n\t\t\t\tthis.returnButton.setPosition(\"bottomright\");\n\t\t\t\tthis.basemapButton.setPosition(\"bottomright\");\n\t\t\t\tthis.pm.Toolbar.setBlockPosition(\"draw\", \"topright\");\n\t\t\t\tthis.pm.Toolbar.setBlockPosition(\"edit\", \"topright\");\n\t\t\t\tthis.textboxButton.setPosition(\"topleft\");\n\t\t\t\tbreak;\n\n\t\t\tdefault: break;\n\t\t}\n\t},\n\n\tsetHomeBounds: function(bounds) {\n\t\tif(this.returnButton) {\n\t\t\tthis.returnButton.setHomeBounds(bounds, { maxZoom: this.getMaxZoom() });\n\t\t}\n\t},\n\n\tsetAspectRatio: function(ratio) {\n\t\tif(ratio) { _OPTIONS.aspectratio = ratio; }\n\t\tlet w = $(\"#mapRow\").outerWidth(),\n\t\t\th = $(\"#mapRow\").outerHeight(),\n\t\t\tr = _OPTIONS.aspectratio;\n\n\t\tlet dim = get_aspect_ratio_dimentions(w, h, r);\n\t\t$(\"#map\").css({\n\t\t\twidth: `${(dim[0]/w) * 100}%`,\n\t\t\theight: `calc(${(dim[1]/h) * 100}% - 39px - 49px)`,\n\t\t\tleft: `${(((w - dim[0]) / 2) / w) * 100}%`,\n\t\t\ttop: `calc(${(((h - dim[1]) / 2)/ h) * 100}% + 39px + 49px)`\n\t\t});\n\n\t\tthis.invalidateSize();\n\t\tif(_SCENES.active) { this.setFlyTo( _SCENES.get( _SCENES.active ).bounds ); }\n\t},\n\n\tsetFlyTo: function(bounds) {\n\t\tthis.flyToBounds(bounds, { maxZoom: this.getMaxZoom(), noMoveStart: true, duration: _OPTIONS.panningspeed || null });\n\t\tthis.setHomeBounds(bounds);\n\t},\n\n\n\n\tclearLayers: function() {\n\t\tfor(let o of this.getLayers()) {\n\t\t\tthis.removeLayer(o);\n\t\t}\n\t},\n\n\tgetLayers: function() {\n\t\treturn this.pm.getGeomanLayers();\n\t},\n\n\taddScene: function(sceneId) {\n\t\tlet prev = _SCENES.getPrevScene(sceneId);\n\t\tif(!prev || !_OPTIONS.objectOptIn) { return; }\n\t\tlet prevId = prev.id;\n\n\t\tfor(let object of this.objects) {\n\t\t\tif(object.sceneId == prevId) {\n\t\t\t\tlet o = Object.assign({}, object);\n\t\t\t\to.sceneId = sceneId;\n\t\t\t\tthis.objects.push(o);\n\t\t\t}\n\t\t}\n\n\t\t_SCENES.store[ _SCENES.get(sceneId).index ].setWMS();\n\t},\n\tdeleteScene: function(sceneId) {\n\t\tthis.objects = this.objects.filter(o => o.sceneId != sceneId);\n\t},\n\n\thighlightObject: function(id) {\n\t\tlet o = this.fadeLayer.getObject(id);\n\t\tif(!o) { return; }\n\n\t\tif(o instanceof L.ImageOverlay) { o.setOpacity( 0.8 ); }\n\t\telse{ o.setStyle({ opacity: 0.8 }); }\n\t},\n\tunhighlightObject: function(id) {\n\t\tlet o = this.fadeLayer.getObject(id);\n\t\tif(!o) { return; }\n\n\t\tif(o instanceof L.ImageOverlay) { o.setOpacity( 0.3 ); }\n\t\telse{ o.setStyle({ opacity: 0.3 }); }\n\t},\n\n\tsetObjects: function(sceneId) {\n\t\tlet prev = _SCENES.getPrevScene(sceneId);\n\t\tlet prevId = prev ? prev.id : null;\n\n\t\tthis.fadeLayer.clearLayers();\n\t\tif(prevId) {\n\t\t\tfor(let o of this.objects) {\n\t\t\t\tif(o.sceneId == prevId) { this.fadeLayer.addLayer(this.createObject(o), o.id); }\n\t\t\t}\n\t\t}\n\n\t\tlet os = this.getLayers().map(o => {\n\t\t\tlet r = this.extractObject(o); return { id: r.id, pos: r.pos, radius: r.radius, animationspeed: r.animationspeed };\n\t\t});\n\t\tthis.clearLayers();\n\t\tfor(let i = 0; i < this.objects.length; i++) {\n\t\t\tlet o = Object.assign({}, this.objects[i]);\n\t\t\tif(o.sceneId == sceneId) {\n\t\t\t\tlet pos = o.pos, rad = o.radius;\n\t\t\t\tfor(let oo of os) {\n\t\t\t\t\tif(o.id == oo.id) {\n\t\t\t\t\t\to.pos = oo.pos;\n\t\t\t\t\t\tif(o.type == \"circle\") { o.radius = oo.radius; }\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlet object = this.createObject(o);\n\t\t\t\tthis.addLayer( object );\n\t\t\t\tthis.fire(\"_addedlayer\", { layer: object });\n\n\t\t\t\tfor(let oo of os) {\n\t\t\t\t\tif(o.id == oo.id) {\n\t\t\t\t\t\tobject.slideTo( pos , { radius: rad, duration: oo.animationspeed || _OPTIONS.animationspeed });\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\tset: function(sceneId) {\n\t\tlet s = _SCENES.get(sceneId);\n\t\tthis.setBasemap(s.basemap);\n\t\tthis.setWMS(s.wms);\n\t\tthis.setObjects(sceneId);\n\t\tthis.setFlyTo(s.bounds);\n\t},\n\n\tinsertObject: function(o) {\n\t\tfor(let oo of this.getLayers()) {\n\t\t\tif(oo.options.id == o.options.id) { return; }\n\t\t}\n\n\t\tlet object;\n\t\tfor(let oo of this.objects) {\n\t\t\tif(oo.id == o.options.id\n\t\t\t&& oo.sceneId == o.options.sceneId) {\n\t\t\t\tobject = Object.assign({}, oo);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tobject.sceneId = _SCENES.active;\n\n\t\tlet oo = this.createObject(object);\n\t\tthis.addLayer( oo );\n\t\tthis.fire(\"_addedlayer\", { layer: oo });\n\t\tthis.objects.push(object);\n\t},\n\tcloneAvatar: function(id, sceneId) {\n\t\tlet object;\n\t\tfor(let o of this.objects) {\n\t\t\tif(o.id == id && o.sceneId == sceneId) {\n\t\t\t\tobject = Object.assign({}, o);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tobject.id = uuid();\n\n\t\tlet zoom = this.getZoom();\n\t\tlet nw = this.project(object.pos[0], zoom),\n\t\t\tse = this.project(object.pos[1], zoom);\n\t\tnw.x += 50; nw.y += 50;\n\t\tse.x += 50; se.y += 50;\n\t\tnw = this.unproject(nw, zoom);\n\t\tse = this.unproject(se, zoom);\n\n\t\tobject.pos = [[nw.lat, nw.lng], [se.lat, se.lng]];\n\n\t\tlet o = this.createObject(object);\n\t\tthis.addLayer(o);\n\t\tthis.fire(\"_addedlayer\", { layer: o });\n\t\tthis.objects.push(object);\n\t},\n\n\tupdateObject: function(o) {\n\t\tfor(let i = 0; i < this.objects.length; i++) {\n\t\t\tlet oo = this.objects[i];\n\t\t\tif(oo.id == o.options.id\n\t\t\t&& oo.sceneId == o.options.sceneId) {\n\t\t\t\tthis.objects[i] = this.extractObject(o);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t},\n\n\tdeleteObject: function(o) {\n\t\tfor(let i = 0; i < this.objects.length; i++) {\n\t\t\tlet oo = this.objects[i];\n\t\t\tif(oo.id == o.options.id\n\t\t\t&& oo.sceneId == o.options.sceneId) {\n\t\t\t\tthis.objects.splice(i, 1);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t},\n\n\tglobalObjectOptions: function(object) {\n\t\tlet o = this.extractObject(object);\n\t\tdelete o.id; delete o.sceneId; delete o.type; delete o.pos;\n\t\tif(object instanceof L.Circle) { delete o.radius; }\n\n\t\tfor(let i = 0; i < this.objects.length; i++) {\n\t\t\tlet oo = this.objects[i];\n\t\t\tif(oo.id == object.options.id && oo.sceneId != object.options.sceneId) {\n\t\t\t\tthis.objects[i] = Object.assign({}, oo, o);\n\t\t\t}\n\t\t}\n\n\t\tvar object = this.fadeLayer.getObject(object.options.id);\n\t\tif(object) {\n\t\t\tthis.fadeLayer.removeLayer(object);\n\n\t\t\tlet oo = Object.assign({}, this.extractObject(object), o);\n\t\t\tthis.fadeLayer.addLayer(this.createObject(oo), oo.id);\n\t\t}\n\t},\n\n\tsetIcon: function(o, size, icon) {\n\t\tif(!(o instanceof L.ImageOverlay)) { return; }\n\n\t\tif(size) {\n\t\t\tlet zoom = this.getZoom();\n\t\t\tlet c = this.project(o.getBounds().getCenter(), zoom);\n\t\t\to.setBounds([\n\t\t\t\tthis.unproject([ c.x - size[0] / 2, c.y - size[1] / 2 ], zoom),\n\t\t\t\tthis.unproject([ c.x + size[0] / 2, c.y + size[1] / 2 ], zoom)\n\t\t\t]);\n\t\t}\n\t\tif(icon) { o.setUrl(icon); }\n\n\t\t$(o._image).css(\"border-radius\", o.options.rounded ? \"50%\" : \"0\");\n\t\t//$(o._image).css(\"transform\", `rotate(${o.options.angle}deg)`);\n\t\t$(o._image).css(\"border\", `${o.options.borderThickness}px solid ${o.options.borderColor}`);\n\t\t$(o._image).css(\"filter\", `\n\t\t\tblur(${o.options.overlayBlur}px)\n\t\t\tgrayscale(${o.options.overlayGrayscale*100}%)\n\t\t\tdrop-shadow(0 0 ${o.options.overlayBrightness}px yellow)\n\t\t\topacity(${(1 - o.options.overlayTransparency)*100}%)\n\t\t`);\n\n\t\tif(o.options.label) { this.updateTooltip(o); }\n\t},\n\n\tsetPopup: function(o) {\n\t\to.unbindPopup();\n\t\tlet popup =\n\t\t\to instanceof L.ImageOverlay ? avatar_popup() :\n\t\t\to instanceof L.Rectangle\n\t\t || o instanceof L.Polygon\n\t\t || o instanceof L.Circle ? polygon_popup() :\n\t\t\to instanceof L.Polyline ? polyline_popup() : \"\";\n\t\tif(!popup) { return; }\n\t\to.bindPopup(popup, { keepInView: true, closeOnEscapeKey: false, maxWidth: 350, maxHeight: 450 });\n\t},\n\n\tupdateTooltip: function(o) {\n\t\tif(o.getTooltip()) {\n\t\t\to.closeTooltip();\n\t\t\tif(o instanceof L.ImageOverlay) {\n\t\t\t\tlet d = this.latLngToContainerPoint( o.getBounds().getNorthWest() ).distanceTo( this.latLngToContainerPoint( o.getBounds().getSouthWest() ) );\n\t\t\t\to.getTooltip().options.offset = [0, d / 2 - 10];\n\t\t\t}\n\t\t\to.openTooltip();\n\t\t}\n\t},\n\n\n\n\tgetWMS: function() {\n\t\treturn this.wms ? {\n\t\t\ttype: \"wms\",\n\t\t\turl: this.wms._url,\n\t\t\tlayers: this.wms.options.layers,\n\t\t\tformat: this.wms.options.format,\n\t\t\tversion: this.wms.options.version,\n\t\t\ttransparent: this.wms.options.transparent\n\t\t} : null;\n\t},\n\n\tsetWMS: function(source) {\n\t\tif(!source) {\n\t\t\tthis.wms = this.wms ? this.removeLayer( this.wms ) : null;\n\t\t\treturn;\n\t\t}\n\t\tif(this.wms\n\t\t&& (source.url || source._url) == this.wms._url\n\t\t&& (source.layers || source.options.layers) == this.wms.options.layers\n\t\t&& (source.format || source.options.format) == this.wms.options.format\n\t\t&& (source.version || source.options.version) == this.wms.options.version) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet layer;\n\n\t\tif(source instanceof L.TileLayer.WMS) {\n\t\t\tlayer = source;\n\t\t}else\n\t\tif(source.type == \"wms\") {\n\t\t\tlayer = L.tileLayer.wms(source.url, {\n\t\t\t\tlayers: source.layers,\n\t\t\t\tformat: source.format,\n\t\t\t\ttransparent: source.transparent,\n\t\t\t\tversion: source.version,\n\t\t\t\tminZoom: source.minZoom || 0,\n\t\t\t\tmaxZoom: source.maxZoom || 22,\n\t\t\t\tattribution: source.attribution || \"\"\n\t\t\t});\n\t\t}\n\t\telse{ return; }\n\n\t\tif(this.wms) { this.removeLayer( this.wms ); }\n\n\t\tthis.wms = layer;\n\n\t\tthis.addLayer( this.wms );\n\t\tthis.wms.bringToFront();\n\t},\n\n\tgetCenterBasemapTile: function() {\n\t\tif(this.basemap instanceof L.ImageOverlay) {\n\t\t\treturn this.basemap._url;\n\t\t}\n\n\t\tlet s = this.basemap.getTileSize(),\n\t\t\tc = this.project( this.getCenter(), this.getZoom() ),\n\t\t\tr = \"\";\n\n\t\ttry { r = this.basemap.getTileUrl({ x: Math.floor(c.x / s.x), y: Math.floor(c.y / s.y) }); }\n\t\tcatch(e) { console.error(e); }\n\n\t\treturn r;\n\t},\n\n\tgetBasemap: function() {\n\t\tif(this.basemap instanceof L.TileLayer) {\n\t\t\treturn {\n\t\t\t\ttype: \"tiles\",\n\t\t\t\turl: this.basemap._url,\n\t\t\t\tminZoom: this.basemap.options.minZoom,\n\t\t\t\tmaxZoom: this.basemap.options.maxZoom,\n\t\t\t\tattribution: this.basemap.options.attribution\n\t\t\t};\n\t\t}else\n\t\tif(this.basemap instanceof L.ImageOverlay) {\n\t\t\treturn {\n\t\t\t\ttype: \"image\",\n\t\t\t\timg: this.basemap._url\n\t\t\t};\n\t\t}\n\t\treturn null;\n\t},\n\n\tsetBasemap: async function(source) {\n\t\tlet basemap;\n\n\t\tif(source instanceof L.TileLayer) {\n\t\t\tif(this.basemap instanceof L.TileLayer\n\t\t\t&& source._url == this.basemap._url) { return; }\n\n\t\t\tbasemap = source;\n\t\t}else\n\t\tif(source.type == \"tiles\") {\n\t\t\tif(this.basemap instanceof L.TileLayer\n\t\t\t&& source.url == this.basemap._url) { return; }\n\n\t\t\tbasemap = L.tileLayer(source.url, {\n\t\t\t\tminZoom: source.minZoom || 0,\n\t\t\t\tmaxZoom: source.maxZoom || 22,\n\t\t\t\tattribution: source.attribution || \"&copy;\"\n\t\t\t});\n\t\t}else\n\t\tif(source.type == \"image\") {\n\t\t\tif(this.basemap instanceof L.ImageOverlay\n\t\t\t&& source.img == this.basemap._url) { return; }\n\n\t\t\tlet img = new Image();\n\t\t\timg.src = source.img;\n\t\t\tawait img.decode();\n\n\t\t\tlet r = img.width / img.height;\n\t\t\tlet b = _SCENES.get( _SCENES.active ).bounds;\n\t\t\tlet bounds = [b[0], []];\n\t\t\tlet tlp = this.latLngToContainerPoint(b[0]),\n\t\t\t\tbrp = this.latLngToContainerPoint(b[1]);\n\t\t\tlet h = brp.y - tlp.y,\n\t\t\t\tw = brp.x - tlp.x;\n\n\t\t\tif(r >= 1) { // width >= height\n\t\t\t\tlet p = this.containerPointToLatLng([brp.x, tlp.y + w / r]);\n\t\t\t\tbounds[1][0] = p.lat;\n\t\t\t\tbounds[1][1] = p.lng;\n\t\t\t}else{ // height > width\n\t\t\t\tlet p = this.containerPointToLatLng([tlp.x + r * h, brp.y]);\n\t\t\t\tbounds[1][0] = p.lat;\n\t\t\t\tbounds[1][1] = p.lng;\n\t\t\t}\n\n\t\t\tbasemap = L.imageOverlay(source.img, bounds, {\n\t\t\t\tpmIgnore: true,\n\t\t\t\tzIndex: 0,\n\t\t\t\tminZoom: 0, maxZoom: 1000,\n\t\t\t\tattribution: \"&copy;\"\n\t\t\t});\n\t\t}\n\t\telse{ return; }\n\n\t\tthis.removeLayer( this.basemap );\n\n\t\tthis.basemap = basemap;\n\n\t\tthis.presetZoom(this.basemap.options.minZoom, this.basemap.options.maxZoom);\n\n\t\tthis.addLayer( this.basemap );\n\t\tthis.basemap.bringToBack();\n\n\t\t$(\"div.leaflet-control-attribution a\").prop(\"target\", \"_blank\");\n\t\tsave_data();\n\t},\n\n\tresetBasemap: function() { this.setBasemap( _BASEMAPS[10].tiles ); },\n\n\tpresetZoom: function(min, max) {\n\t\tlet zoom = this.getZoom();\n\t\tif(zoom < min || zoom > max) {\n\t\t\tif(zoom < min) { this.setZoom(min); }\n\t\t\tif(zoom > max) { this.setZoom(max); }\n\t\t}\n\t\tthis.setMinZoom(min);\n\t\tthis.setMaxZoom(max);\n\t},\n\n\n\n\tcreateObject: function(o) {\n\t\tlet oo = null;\n\n\t\tswitch(o.type) {\n\t\t\tcase \"avatar\":\n\t\t\t\too = L.imageOverlay(o.icon, o.pos, {\n\t\t\t\t\tinteractive:\t\t\ttrue,\n\t\t\t\t\tzIndex:\t\t\t\t\t200,\n\t\t\t\t\tlabel:\t\t\t\t\to.label,\n\t\t\t\t\tratio:\t\t\t\t\to.ratio,\n\t\t\t\t\trounded:\t\t\t\to.rounded,\n\t\t\t\t\tangle:\t\t\t\t\to.angle,\n\t\t\t\t\tborderColor:\t\t\to.borderColor,\n\t\t\t\t\tborderThickness:\t\to.borderThickness,\n\t\t\t\t\toverlayBlur:\t\t\to.blur,\n\t\t\t\t\toverlayBrightness:\t\to.brightness,\n\t\t\t\t\toverlayGrayscale:\t\to.grayscale,\n\t\t\t\t\toverlayTransparency:\to.transparency,\n\t\t\t\t\tanimationspeed:\t\t\to.animationspeed\n\t\t\t\t});\n\t\t\t\tbreak;\n\n\t\t\tcase \"polyline\":\n\t\t\t\too = L.polyline(o.pos, {\n\t\t\t\t\tlabel:\t\t\to.label,\n\t\t\t\t\tdashArray:\t\to.dashed ? \"5, 10\" : \"\",\n\t\t\t\t\tcolor:\t\t\to.color,\n\t\t\t\t\tweight:\t\t\to.thickness,\n\t\t\t\t\topacity:\t\t1 - o.transparency,\n\t\t\t\t\tanimationspeed:\to.animationspeed\n\t\t\t\t});\n\t\t\t\tbreak;\n\n\t\t\tcase \"polygon\":\n\t\t\t\too = L.polygon(o.pos, {\n\t\t\t\t\tlabel:\t\t\to.label,\n\t\t\t\t\tdashArray:\t\to.dashed ? \"5, 10\" : \"\",\n\t\t\t\t\tcolor:\t\t\to.lineColor,\n\t\t\t\t\tweight:\t\t\to.lineThickness,\n\t\t\t\t\topacity:\t\t1 - o.lineTransparency,\n\t\t\t\t\tfillColor:\t\to.fillColor,\n\t\t\t\t\tfillOpacity:\t1 - o.fillTransparency,\n\t\t\t\t\tanimationspeed:\to.animationspeed\n\t\t\t\t});\n\t\t\t\tbreak;\n\n\t\t\tcase \"rectangle\":\n\t\t\t\too = L.rectangle(o.pos, {\n\t\t\t\t\tlabel:\t\t\to.label,\n\t\t\t\t\tdashArray:\t\to.dashed ? \"5, 10\" : \"\",\n\t\t\t\t\tcolor:\t\t\to.lineColor,\n\t\t\t\t\tweight:\t\t\to.lineThickness,\n\t\t\t\t\topacity:\t\t1 - o.lineTransparency,\n\t\t\t\t\tfillColor:\t\to.fillColor,\n\t\t\t\t\tfillOpacity:\t1 - o.fillTransparency,\n\t\t\t\t\tanimationspeed:\to.animationspeed\n\t\t\t\t});\n\t\t\t\tbreak;\n\n\t\t\tcase \"circle\":\n\t\t\t\too = L.circle(o.pos, {\n\t\t\t\t\tradius:\t\t\to.radius,\n\t\t\t\t\tlabel:\t\t\to.label,\n\t\t\t\t\tdashArray:\t\to.dashed ? \"5, 10\" : \"\",\n\t\t\t\t\tcolor:\t\t\to.lineColor,\n\t\t\t\t\tweight:\t\t\to.lineThickness,\n\t\t\t\t\topacity:\t\t1 - o.lineTransparency,\n\t\t\t\t\tfillColor:\t\to.fillColor,\n\t\t\t\t\tfillOpacity:\t1 - o.fillTransparency,\n\t\t\t\t\tanimationspeed:\to.animationspeed\n\t\t\t\t});\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tconsole.error(\"object type invalid\");\n\t\t\t\tbreak;\n\t\t}\n\n\t\too.options.id = o.id;\n\t\too.options.sceneId = o.sceneId;\n\n\t\treturn oo;\n\t},\n\n\textractObject: function(o) {\n\t\tlet oo = null;\n\n\t\tif(o instanceof L.ImageOverlay) {\n\t\t\tlet nw = o.getBounds().getNorthWest(), se = o.getBounds().getSouthEast();\n\t\t\too = {\n\t\t\t\tid:\t\t\t\t\to.options.id,\n\t\t\t\tsceneId:\t\t\to.options.sceneId,\n\t\t\t\ttype:\t\t\t\t\"avatar\",\n\t\t\t\tpos:\t\t\t\t[[nw.lat, nw.lng], [se.lat, se.lng]],\n\t\t\t\tlabel:\t\t\t\to.options.label,\n\t\t\t\ticon:\t\t\t\to._url,\n\t\t\t\tratio:\t\t\t\to.options.ratio,\n\t\t\t\trounded:\t\t\to.options.rounded,\n\t\t\t\tangle:\t\t\t\t0,\n\t\t\t\tborderColor:\t\to.options.borderColor,\n\t\t\t\tborderThickness:\to.options.borderThickness,\n\t\t\t\tblur:\t\t\t\to.options.overlayBlur,\n\t\t\t\tgrayscale:\t\t\to.options.overlayGrayscale,\n\t\t\t\tbrightness:\t\t\to.options.overlayBrightness,\n\t\t\t\ttransparency:\t\to.options.overlayTransparency,\n\t\t\t\tanimationspeed:\t\to.options.animationspeed\n\t\t\t};\n\t\t}else\n\t\tif(o instanceof L.Polygon) {\n\t\t\too = {\n\t\t\t\tid:\t\t\t\t\to.options.id,\n\t\t\t\tsceneId:\t\t\to.options.sceneId,\n\t\t\t\ttype:\t\t\t\to instanceof L.Rectangle ? \"rectangle\" : \"polygon\",\n\t\t\t\tpos:\t\t\t\to.getLatLngs(),\n\t\t\t\tlabel:\t\t\t\to.options.label,\n\t\t\t\tdashed:\t\t\t\t!!o.options.dashArray,\n\t\t\t\tlineColor:\t\t\to.options.color,\n\t\t\t\tlineThickness:\t\to.options.weight,\n\t\t\t\tlineTransparency:\t1 - o.options.opacity,\n\t\t\t\tfillColor:\t\t\to.options.fillColor,\n\t\t\t\tfillTransparency:\t1 - o.options.fillOpacity,\n\t\t\t\tanimationspeed:\t\to.options.animationspeed\n\t\t\t};\n\t\t}else\n\t\tif(o instanceof L.Polyline) {\n\t\t\too = {\n\t\t\t\tid:\t\t\t\to.options.id,\n\t\t\t\tsceneId:\t\to.options.sceneId,\n\t\t\t\ttype:\t\t\t\"polyline\",\n\t\t\t\tpos:\t\t\to.getLatLngs(),\n\t\t\t\tlabel:\t\t\to.options.label,\n\t\t\t\tdashed:\t\t\t!!o.options.dashArray,\n\t\t\t\tcolor:\t\t\to.options.color,\n\t\t\t\tthickness:\t\to.options.weight,\n\t\t\t\ttransparency:\t1 - o.options.opacity,\n\t\t\t\tanimationspeed:\to.options.animationspeed\n\t\t\t};\n\t\t}else\n\t\tif(o instanceof L.Circle) {\n\t\t\tlet p = o.getLatLng();\n\t\t\too = {\n\t\t\t\tid:\t\t\t\t\to.options.id,\n\t\t\t\tsceneId:\t\t\to.options.sceneId,\n\t\t\t\ttype:\t\t\t\t\"circle\",\n\t\t\t\tpos:\t\t\t\t[ p.lat, p.lng ],\n\t\t\t\tradius:\t\t\t\to.getRadius(),\n\t\t\t\tlabel:\t\t\t\to.options.label,\n\t\t\t\tdashed:\t\t\t\t!!o.options.dashArray,\n\t\t\t\tlineColor:\t\t\to.options.color,\n\t\t\t\tlineThickness:\t\to.options.weight,\n\t\t\t\tlineTransparency:\t1 - o.options.opacity,\n\t\t\t\tfillColor:\t\t\to.options.fillColor,\n\t\t\t\tfillTransparency:\t1 - o.options.fillOpacity,\n\t\t\t\tanimationspeed:\t\to.options.animationspeed\n\t\t\t};\n\t\t}else{ console.error(\"object type invalid\"); }\n\n\t\treturn oo;\n\t},\n\n\timportData: function(data) {\n\t\tfor(let i = 0; i < data.length; i++) {\n\t\t\tthis.objects.push( data[i] );\n\t\t}\n\t},\n\n\texportData: function() { return this.objects; }\n\n});\n","/*******************************************************************************\n* Copyright (C) Nordfjord EDB AS - All Rights Reserved                         *\n*                                                                              *\n* Unauthorized copying of this file, via any medium is strictly prohibited     *\n* Proprietary and confidential                                                 *\n* Written by Andreas Atakan <aca@geotales.io>, January 2022                  *\n*******************************************************************************/\n\n\"use strict\";\n\n\nL.FadeLayer = L.FeatureGroup.extend({\n\taddLayer: function(o, id) {\n\t\tL.FeatureGroup.prototype.addLayer.call(this, o);\n\t\tif(id && !o.options.id) { o.options.id = id; }\n\t\to.options.pmIgnore = true;\n\n\t\tif(o instanceof L.ImageOverlay) {\n\t\t\to.setOpacity( 0.3 );\n\t\t\t$(o._image).css(\"border-radius\", o.options.rounded ? \"50%\" : \"0\");\n\t\t\t//$(o._image).css(\"transform\", `rotate(${o.options.angle}deg)`);\n\t\t\t$(o._image).css(\"border\", `${o.options.borderThickness}px solid ${o.options.borderColor}`);\n\t\t\t$(o._image).css(\"filter\", `\n\t\t\t\tblur(${o.options.overlayBlur}px)\n\t\t\t\tgrayscale(${o.options.overlayGrayscale * 100}%)\n\t\t\t`);\n\t\t}else{\n\t\t\to.setStyle({ opacity: 0.3 });\n\t\t\to.setStyle({ fillOpacity: 0.2 });\n\t\t}\n\t\to.on(\"click\", ev => { _MAP.insertObject(o); });\n\t},\n\n\tgetObject: function(id) {\n\t\tfor(let o of this.getLayers()) {\n\t\t\tif(o.options.id == id) { return o; }\n\t\t}\n\t\treturn null;\n\t},\n\n\tremoveLayer: function(o, id) {\n\t\tvar o = o || (id ? this.getObject(id) : null);\n\t\tif(!o) { return; }\n\t\to.off(\"click\");\n\t\tL.FeatureGroup.prototype.removeLayer.call(this, o);\n\t},\n\n\tinitialize: function(options) {\n\t\tL.FeatureGroup.prototype.initialize.call(this);\n\t\tthis.options.id = \"0\";\n\t\tthis.options = Object.assign({}, this.options, options);\n\t}\n});\nL.fadeLayer = function(options) { return new L.FadeLayer(options); };\n\n\nL.ImageOverlay.include({\n\t__toGeoJSON: function() {\n\t\tif(!this._map) { return; }\n\n\t\tlet nw = this.getBounds().getNorthWest(),\n\t\t\tse = this.getBounds().getSouthEast();\n\t\tlet r = {\n\t\t\t\"type\": \"Feature\",\n\t\t\t\"properties\": {\n\t\t\t\t\"type\":\t\t\t\t\"avatar\",\n\t\t\t\t\"label\":\t\t\tthis.options.label,\n\t\t\t\t\"icon\":\t\t\t\tthis._url,\n\t\t\t\t\"ratio\":\t\t\tthis.options.ratio,\n\t\t\t\t\"rounded\":\t\t\tthis.options.rounded,\n\t\t\t\t\"angle\":\t\t\t0,\n\t\t\t\t\"borderColor\":\t\tthis.options.borderColor,\n\t\t\t\t\"borderThickness\":\tthis.options.borderThickness,\n\t\t\t\t\"blur\":\t\t\t\tthis.options.overlayBlur,\n\t\t\t\t\"grayscale\":\t\tthis.options.overlayGrayscale,\n\t\t\t\t\"brightness\":\t\tthis.options.overlayBrightness,\n\t\t\t\t\"transparency\":\t\tthis.options.overlayTransparency\n\t\t\t},\n\t\t\t\"geometry\": {\n\t\t\t\t\"type\": \"Polygon\",\n\t\t\t\t\"coordinates\": [ [nw.lat, nw.lng], [se.lat, se.lng] ]\n\t\t\t}\n\t\t};\n\t\treturn r;\n\t}\n});\n\nL.Polyline.include({\n\t__toGeoJSON: function() {\n\t\tif(!this._map) { return; }\n\n\t\tlet r = L.Polyline.prototype.toGeoJSON.call(this);\n\t\tr.properties = {\n\t\t\t\"type\":\t\t\t\"polyline\",\n\t\t\t\"label\":\t\tthis.options.label,\n\t\t\t\"dashed\":\t\t!!this.options.dashArray,\n\t\t\t\"color\":\t\tthis.options.color,\n\t\t\t\"thickness\":\tthis.options.weight,\n\t\t\t\"transparency\":\t1 - this.options.opacity\n\t\t};\n\t\treturn r;\n\t}\n});\n\nL.Polygon.include({\n\t__toGeoJSON: function() {\n\t\tif(!this._map) { return; }\n\n\t\tlet r = L.Polygon.prototype.toGeoJSON.call(this);\n\t\tr.properties = {\n\t\t\ttype:\t\t\t\tthis instanceof L.Rectangle ? \"rectangle\" : \"polygon\",\n\t\t\tlabel:\t\t\t\tthis.options.label,\n\t\t\tdashed:\t\t\t\t!!this.options.dashArray,\n\t\t\tlineColor:\t\t\tthis.options.color,\n\t\t\tlineThickness:\t\tthis.options.weight,\n\t\t\tlineTransparency:\t1 - this.options.opacity,\n\t\t\tfillColor:\t\t\tthis.options.fillColor,\n\t\t\tfillTransparency:\t1 - this.options.fillOpacity\n\t\t};\n\t\treturn r;\n\t}\n});\n\nL.Circle.include({\n\t__toGeoJSON: function() {\n\t\tif(!this._map) { return; }\n\n\t\tlet r = L.Circle.prototype.toGeoJSON.call(this);\n\t\tr.properties = {\n\t\t\t\"type\":\t\t\t\t\"circle\",\n\t\t\t\"radius\":\t\t\tthis.getRadius(),\n\t\t\t\"label\":\t\t\tthis.options.label,\n\t\t\t\"dashed\":\t\t\t!!this.options.dashArray,\n\t\t\t\"lineColor\":\t\tthis.options.color,\n\t\t\t\"lineThickness\":\tthis.options.weight,\n\t\t\t\"lineTransparency\":\t1 - this.options.opacity,\n\t\t\t\"fillColor\":\t\tthis.options.fillColor,\n\t\t\t\"fillTransparency\":\t1 - this.options.fillOpacity\n\t\t};\n\t\treturn r;\n\t}\n});\n\n\n\n\n\n\n\n\nexport function bind_setup(o) {\n\n\t$(\".objectPopup input#label\").change(function(ev) {\n\t\tlet val = $(this).val();\n\n\t\tif(val) {\n\t\t\tif(!o.getTooltip()) {\n\t\t\t\to.bindTooltip( L.tooltip({ direction: \"center\", permanent: true }, o) );\n\t\t\t\tif(o instanceof L.ImageOverlay) { _MAP.updateTooltip(o); }\n\t\t\t}\n\t\t\to.setTooltipContent(val);\n\t\t}\n\t\telse{ o.unbindTooltip(); }\n\n\t\to.options.label = val;\n\t\t_MAP.updateObject(o);\n\t});\n\t$(\".objectPopup input#label\").val(o.options.label || \"\");\n\n\tif(o instanceof L.ImageOverlay) {\n\t\t$(\"#avatarPopup #iconChoose #iconCol\").remove();\n\t\tfor(let i of _ICONS.slice().reverse()) {\n\t\t\t$(\"#avatarPopup #iconChoose\").prepend(`\n\t\t\t\t<div class=\"col\" id=\"iconCol\">\n\t\t\t\t\t<img class=\"img-fluid rounded\" id=\"icons\" src=\"${i}\" alt=\"&nbsp;\" />\n\t\t\t\t</div>\n\t\t\t`);\n\t\t}\n\n\t\t$(\"input#_img_icon\").off(\"change\");\n\t\t$(\"input#_img_icon\").change(function(ev) {\n\t\t\tlet file = $(this)[0].files[0];\n\t\t\tif(!file) { return; }\n\n\t\t\t$(\"#loadingModal\").modal(\"show\");\n\n\t\t\tlet fr = new FileReader();\n\t\t\tfr.onload = async function() {\n\t\t\t\tlet img = new Image();\n\t\t\t\timg.src = fr.result;\n\t\t\t\tawait img.decode();\n\n\t\t\t\t$(\"#avatarPopup input#rounded\").prop(\"checked\", false);\n\t\t\t\t// TODO: Also set rotation-angle input to 0\n\n\t\t\t\to.options.ratio = img.width / img.height || 1;\n\t\t\t\to.options.rounded = false;\n\t\t\t\to.options.angle = 0;\n\n\t\t\t\tlet data = new FormData();\n\t\t\t\tdata.append(\"type\", \"icon\");\n\t\t\t\tdata.append(\"image\", file);\n\n\t\t\t\t$.ajax({\n\t\t\t\t\ttype: \"POST\",\n\t\t\t\t\turl: \"api/upload_create.php\",\n\t\t\t\t\tdata: data,\n\t\t\t\t\tcontentType: false,\n\t\t\t\t\tprocessData: false,\n\t\t\t\t\tsuccess: function(result, status, xhr) {\n\t\t\t\t\t\t_ICONS.unshift(result);\n\t\t\t\t\t\t_MAP.setIcon(o, [ 35, 35 / o.options.ratio ], result);\n\t\t\t\t\t\t_MAP.updateObject(o);\n\n\t\t\t\t\t\tsetTimeout(function() { $(\"#loadingModal\").modal(\"hide\"); }, 750);\n\t\t\t\t\t},\n\t\t\t\t\terror: function(xhr, status, error) {\n\t\t\t\t\t\tconsole.error(xhr.status, error);\n\t\t\t\t\t\tsetTimeout(function() { $(\"#loadingModal\").modal(\"hide\"); $(\"#errorModal\").modal(\"show\"); }, 750);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t};\n\t\t\tfr.readAsDataURL(file);\n\t\t});\n\t\t$(\"#avatarPopup #iconChoose #iconAdd\").click(ev => { $(\"input#_img_icon\").click(); });\n\n\t\t$(\"#avatarPopup #iconChoose #icons\").click(async function(ev) {\n\t\t\tlet val = $(this).prop(\"src\");\n\n\t\t\tlet img = new Image();\n\t\t\timg.src = val;\n\t\t\tawait img.decode();\n\n\t\t\to.options.ratio = img.width / img.height || 1;\n\t\t\t_MAP.setIcon(o, [ 35, 35 / o.options.ratio ], val);\n\t\t\t_MAP.updateObject(o);\n\t\t});\n\n\t\t$(\"#avatarPopup input#size\").change(function(ev) {\n\t\t\tlet val = Math.min( Math.max( $(this).prop(\"min\"), $(this).val() ), $(this).prop(\"max\") );\n\n\t\t\t_MAP.setIcon(o, [ val, val / o.options.ratio ]);\n\t\t\t_MAP.updateObject(o);\n\t\t});\n\n\t\t$(\"#avatarPopup input#rounded\").change(function(ev) {\n\t\t\to.options.rounded = this.checked;\n\n\t\t\t_MAP.updateObject(o);\n\t\t\t_MAP.setIcon(o);\n\t\t});\n\t\t$(\"#avatarPopup input#rounded\").prop(\"checked\", o.options.rounded);\n\n\t\t$(\"#avatarPopup input#color\").change(function(ev) {\n\t\t\tlet val = $(this).val();\n\n\t\t\to.options.borderColor = val;\n\t\t\t_MAP.updateObject(o);\n\t\t\t_MAP.setIcon(o);\n\t\t});\n\t\t$(\"#avatarPopup input#color\").val(o.options.borderColor || \"#563d7c\");\n\n\t\t$(\"#avatarPopup input#thickness\").change(function(ev) {\n\t\t\tlet val = Math.min( Math.max( $(this).prop(\"min\"), $(this).val() ), $(this).prop(\"max\") );\n\n\t\t\to.options.borderThickness = val;\n\t\t\t_MAP.updateObject(o);\n\t\t\t_MAP.setIcon(o);\n\t\t});\n\n\t\t$(\"#avatarPopup input#blur\").change(function(ev) {\n\t\t\tlet val = Math.min( Math.max( $(this).prop(\"min\"), $(this).val() ), $(this).prop(\"max\") );\n\n\t\t\to.options.overlayBlur = val;\n\t\t\t_MAP.updateObject(o);\n\t\t\t_MAP.setIcon(o);\n\t\t});\n\n\t\t$(\"#avatarPopup input#grayscale\").change(function(ev) {\n\t\t\tlet val = Math.min( Math.max( $(this).prop(\"min\"), $(this).val() ), $(this).prop(\"max\") );\n\n\t\t\to.options.overlayGrayscale = val;\n\t\t\t_MAP.updateObject(o);\n\t\t\t_MAP.setIcon(o);\n\t\t});\n\n\t\t$(\"#avatarPopup input#brightness\").change(function(ev) {\n\t\t\tlet val = Math.min( Math.max( $(this).prop(\"min\"), $(this).val() ), $(this).prop(\"max\") );\n\n\t\t\to.options.overlayBrightness = val;\n\t\t\t_MAP.updateObject(o);\n\t\t\t_MAP.setIcon(o);\n\t\t});\n\n\t\t$(\"#avatarPopup input#transparency\").change(function(ev) {\n\t\t\tlet val = Math.min( Math.max( $(this).prop(\"min\"), $(this).val() ), $(this).prop(\"max\") );\n\n\t\t\to.options.overlayTransparency = val;\n\t\t\t_MAP.updateObject(o);\n\t\t\t_MAP.setIcon(o);\n\t\t});\n\t}else\n\tif(o instanceof L.Path) {\n\t\t$(\"#shapePopup input#dashed\").change(function(ev) {\n\t\t\to.setStyle({ dashArray: this.checked ? \"5, 10\" : \"\" });\n\t\t\t_MAP.updateObject(o);\n\t\t});\n\t\t$(\"#shapePopup input#dashed\").prop(\"checked\", !!o.options.dashArray);\n\n\t\t$(\"#shapePopup input#lineColor\").change(function(ev) {\n\t\t\to.setStyle({ color: $(this).val() });\n\t\t\t_MAP.updateObject(o);\n\t\t});\n\t\t$(\"#shapePopup input#lineColor\").val(o.options.color || \"#563d7c\");\n\n\t\t$(\"#shapePopup input#lineThickness\").change(function(ev) {\n\t\t\to.setStyle({\n\t\t\t\tweight: Math.min( Math.max( $(this).prop(\"min\"), $(this).val() ), $(this).prop(\"max\") )\n\t\t\t});\n\t\t\t_MAP.updateObject(o);\n\t\t});\n\n\t\t$(\"#shapePopup input#lineTransparency\").change(function(ev) {\n\t\t\to.setStyle({\n\t\t\t\topacity: 1 - Math.min( Math.max( $(this).prop(\"min\"), $(this).val() ), $(this).prop(\"max\") )\n\t\t\t});\n\t\t\t_MAP.updateObject(o);\n\t\t});\n\n\t\tif(o instanceof L.Rectangle\n\t\t|| o instanceof L.Polygon\n\t\t|| o instanceof L.Circle) {\n\t\t\t$(\"#shapePopup input#fillColor\").change(function(ev) {\n\t\t\t\to.setStyle({ fillColor: $(this).val() });\n\t\t\t\t_MAP.updateObject(o);\n\t\t\t});\n\t\t\t$(\"#shapePopup input#fillColor\").val(o.options.fillColor || \"#563d7c\");\n\n\t\t\t$(\"#shapePopup input#fillTransparency\").change(function(ev) {\n\t\t\t\to.setStyle({\n\t\t\t\t\tfillOpacity: 1 - Math.min( Math.max( $(this).prop(\"min\"), $(this).val() ), $(this).prop(\"max\") )\n\t\t\t\t});\n\t\t\t\t_MAP.updateObject(o);\n\t\t\t});\n\t\t}\n\t}else{ console.error(\"object type invalid\"); }\n\n\t$(\".objectPopup input#animationSpeed\").change(function(ev) {\n\t\to.options.animationspeed = Math.min( Math.max( $(this).prop(\"min\"), $(this).val() ), $(this).prop(\"max\") ) * 1000;\n\t\t_MAP.updateObject(o);\n\t});\n\n\t$(\".objectPopup #makeGlobal\").click(function(ev) {\n\t\t_MAP.globalObjectOptions(o);\n\t});\n}\n"],"names":["$aykGt","parcelRequire","window","onload","ev","document","addEventListener","scale","preventDefault","resizeTimer","$","on","trigger","clearTimeout","setTimeout","_MAP","setAspectRatio","_SCENES","$gUPg4","Scenes","keydown","indexOf","code","keyup","keycode","prev","next","click","add","capture","delete","modal","_TEXTBOXES","$aDjZZ","Textboxes","L","map","center","zoom","innerWidth","zoomControl","maxZoom","doubleClickZoom","zoomAnimationThreshold","wheelPxPerZoomLevel","keyboard","tap","boxZoom","contextmenu","contextmenuItems","text","callback","navigator","clipboard","writeText","latlng","lat","lng","panTo","icon","zoomIn","zoomOut","setup","reset","change","_OPTIONS","animationspeed","this","val","panningspeed","eval","value","objectOptIn","checked","init_basemaps","file","target","files","data","FormData","append","ajax","type","url","contentType","processData","success","async","result","status","xhr","setBasemap","img","_BASEMAPS","push","name","tiles","preview","error","console","split","username","styleID","key","layers","format","version","setWMS","transparent","fr","FileReader","import_data","JSON","parse","readAsText","options","lineColor","lineThickness","lineTransparency","fillColor","fillTransparency","export_data","save_data","setInterval","id","_ID","password","dataType","unsaved_changes","r","_ICONS","unshift","ref","$4XDZb","$7aed1fc953746074$export$31b40729666a4ae0","a","Math","random","toString","replace","$7aed1fc953746074$export$3b2ba0326b56a54c","prop","scenes","length","store","dispatchEvent","Event","importData","textboxes","objects","current","$7aed1fc953746074$var$import_project","f","features","o","t","Array","isArray","v","reverse","pos","geometry","coordinates","properties","sceneId","active","label","ratio","rounded","angle","borderColor","borderThickness","blur","overlayBlur","grayscale","overlayGrayscale","brightness","overlayBrightness","transparency","overlayTransparency","dashed","color","thickness","radius","getMaxZoom","getZoom","object","createObject","addLayer","fire","layer","extractObject","$7aed1fc953746074$var$import_geojson","$7aed1fc953746074$var$export_project","stringify","exportData","$7aed1fc953746074$var$running","$7aed1fc953746074$export$b9e8c15d1f8b68a8","el","createElement","date","Date","y","getFullYear","m","getMonth","d","getDate","H","getHours","M","getMinutes","S","getSeconds","filename","_TITLE","encodeURIComponent","getLayers","__toGeoJSON","$7aed1fc953746074$var$export_geojson","setAttribute","style","display","body","appendChild","ready","removeChild","$7aed1fc953746074$export$8915d34f81494a91","getCenterBasemapTile","off","$7aed1fc953746074$export$d36ebd2686ed6eb9","returnValue","$7aed1fc953746074$export$6c9368fbe350f308","addClass","removeClass","$7aed1fc953746074$var$bind_basemaps","index","$7aed1fc953746074$export$4c0c65daf5a0e159","generate_basemaps","$7aed1fc953746074$export$cce986394ab9e86d","$7aed1fc953746074$export$827cb160439a2d7c","w","h","_w","$39cbb0745d491746$export$28821553ef8d960f","prevId","cont","after","$39cbb0745d491746$export$d3ba155dc3b68019","isUpload","html","i","b","_USER_PAID","$39cbb0745d491746$export$d4a4f44bb1d49f04","$39cbb0745d491746$export$3d6e93c41a574db9","$39cbb0745d491746$export$b06e432f08e15d50","$c509a32349fb613e$export$b4dfb75ee92ddb88","copiedBounds","sortable","cursor","handle","items","containment","tolerance","cancel","zIndex","axis","start","ui","stopPropagation","unbind","update","reorder","stop","bind","get","s","Object","assign","getEl","contains","getPrevScene","order","sort","set","$c509a32349fb613e$var$Scene","splice","addScene","flash_map","deleteScene","remove","setNumbering","hasClass","disable","enable","scrollIntoView","behavior","inline","setBookmark","n","copyBounds","bounds","pasteBounds","setBounds","wms","basemap","bookmark","setTitle","title","uuid","new_scene","setFlyTo","getWMS","getBasemap","nw","getBounds","getNorthWest","se","getSouthEast","$7bdd0f4539e9845d$export$1148a9c69cac2f12","trumbowyg","cmd","param","forceCss","skipTrumbowyg","log","setLock","setOrientation","resizable","handles","minWidth","size","width","outerWidth","dim","css","left","autogrow","semantic","resetCss","removeformatPasted","urlProtocol","defaultLinkTarget","tagsToRemove","btnsDef","dropdown","ico","align","uploadImg","fn","makeLink","btns","plugins","content","$7bdd0f4539e9845d$var$Textbox","locked","tt","l","right","disabled","textboxButton","Map","addInitHook","returnButton","Control","zoomHome","position","zoomHomeIcon","zoomHomeTitle","addControl","basemapButton","easyButton","leafletClasses","states","stateName","onClick","button","init_img_basemaps","pm","addControls","drawCircleMarker","drawText","oneBlock","setPathOptions","weight","opacity","fillOpacity","setGlobalOptions","markerStyle","iconUrl","iconSize","popupAnchor","tooltipAnchor","setLang","tooltips","placeMarker","buttonTitles","drawMarkerButton","disableDraw","fadeLayer","pmIgnore","shape","p","project","getLatLng","getIcon","removeLayer","imageOverlay","unproject","x","interactive","bindTooltip","direction","permanent","ImageOverlay","updateTooltip","updateObject","closeTooltip","openTooltip","deleteObject","unbindTooltip","closePopup","unbindPopup","slideCancel","setPopup","$5WMrM","bind_setup","highlightObject","unhighlightObject","bringToFront","bringToBack","cloneAvatar","setIcon","bindContextMenu","_renderer","_reset","include","enableDraw","before","clearLayers","Toolbar","setButtonDisabled","setPosition","setBlockPosition","setHomeBounds","aspectratio","outerHeight","get_aspect_ratio_dimentions","height","top","invalidateSize","flyToBounds","noMoveStart","duration","getGeomanLayers","filter","getObject","setOpacity","setStyle","setObjects","os","o1","rad","oo","oo1","slideTo","insertObject","oo2","globalObjectOptions","Circle","c","getCenter","setUrl","_image","popup","avatar_popup","Rectangle","Polygon","polygon_popup","Polyline","polyline_popup","bindPopup","keepInView","closeOnEscapeKey","maxWidth","maxHeight","getTooltip","latLngToContainerPoint","distanceTo","getSouthWest","offset","_url","source","TileLayer","WMS","tileLayer","minZoom","attribution","getTileSize","getTileUrl","floor","e","Image","src","decode","tlp","brp","containerPointToLatLng","p1","presetZoom","resetBasemap","min","max","setZoom","setMinZoom","setMaxZoom","polyline","dashArray","polygon","rectangle","circle","getLatLngs","getRadius","$4547f3162a1b3a07$export$27a752e5ac5fffb5","tooltip","setTooltipContent","slice","prepend","readAsDataURL","Path","FadeLayer","FeatureGroup","extend","prototype","call","initialize","_map","toGeoJSON"],"version":3,"file":"main.js.map"}